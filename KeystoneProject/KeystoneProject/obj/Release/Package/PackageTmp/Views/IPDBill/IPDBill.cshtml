@model KeystoneProject.Models.Patient.IPDBill

@{
    ViewBag.Title = "Patient";
    Layout = "~/Views/Shared/_Layout.cshtml";

}
<link rel="stylesheet" type="text/css" href="@Url.Content("~/Vendor/theme/tAutocomplete/tautocomplete.css")" />
<!-- tautocomplete js -->
<script src="@Url.Content("~/Vendor/theme/tAutocomplete/tautocomplete.js")" type="text/javascript"></script>
@if (TempData["Msg"] != null)
{
    <script type="text/javascript">
        alert(@Html.Raw(Json.Encode(TempData["Msg"])));
        window.onload(true);
        //Restor();
    </script>
}
@*<!DOCTYPE html>
    <html>
    <head>*@
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<style>
    .ui-menu{
            z-index: 10;
            COLOR: #2f6bd8;
    }
    #datatable-responsive1 {
        border: 1px solid #bddff7;
    }

        #datatable-responsive1 td {
            border-left: 1px solid #bddff7;
            border-top: 1px solid #bddff7;
            text-align: center;
        }

            #datatable-responsive1 td:hover {
                background-color: #f6f6f6;
            }
</style>

<style>
    input {
        border: 1px solid #cccccc;
        border-radius: 4px;
        padding-left: 2px;
    }

    table.dataTable tbody th, table.dataTable tbody td {
        padding: 8px 10px;
        border-right: 1px solid #bddff7;
        border-top: 1px solid #bddff7;
        padding-left: 20px !important;
    }

    .table-bordered > tbody > tr > td {
        border: 0px solid #e1eff9;
    }



    table.dataTable tbody tr:hover {
        background-color: #ebf1f6;
        cursor: pointer !important;
    }

    @@media screen and (max-width: 867px) {

        .paddingleft {
            padding-left: 15px !important;
        }
    }


    th:nth-child(1) {
        width: 270px !important;
        text-align: left;
        padding-left: 10px !important;
    }

    th:nth-child(2) {
        width: 80px !important;
        text-align: left;
        padding-left: 10px !important;
    }

    th:nth-child(3) {
        width: 70px !important;
        text-align: left;
        padding-left: 10px !important;
    }



    th:nth-child(4) {
        width: 130px !important;
        text-align: left;
        padding-left: 10px !important;
    }

    th:nth-child(5) {
        width: 80px !important;
        text-align: left;
        padding-left: 10px !important;
    }

    th:nth-child(6) {
        width: 110px !important;
        text-align: left;
        padding-left: 10px !important;
    }

    th:nth-child(3) {
        width: 70px !important;
        text-align: left;
        padding-left: 10px !important;
    }

    #deptID_wrapper {
        overflow: auto;
        width: 100%;
    }

    .exportExcel {
        padding: 4px !important;
        font-family: roboto !important;
    }

    select {
        border: 1px solid #d9d8d8 !important;
        border-radius: 3px !important;
        padding: 2px;
    }


    table.dataTable.no-footer {
        border-bottom: 1px solid #111;
        border: 1px solid #bddff7 !important;
    }

    .dataTables_wrapper .dataTables_filter input {
        margin-left: 0.5em;
        border: 1px solid #d9d8d8 !important;
        border-radius: 3px !important;
    }

    label:not(.form-check-label):not(.custom-file-label) {
        font-weight: 500 !important;
        font-family: roboto;
    }

    .dataTables_info {
        padding: 4.5px !important;
        border: 2px solid white !important;
        font-family: roboto;
        border-right: 0px solid red !important;
    }

    .dataTables_wrapper .dataTables_paginate {
        display: table;
        font-family: roboto;
        border-left: 0px solid red !important;
        border: 1px solid rgba(0,0,0,.125) !important;
        border-radius: .25rem;
        padding-top: 0em !important;
        margin-top: 5px;
    }

    element.style {
        width: 383px;
    }

    .table > caption + thead > tr:first-child > td, .table > caption + thead > tr:first-child > th, .table > colgroup + thead > tr:first-child > td, .table > colgroup + thead > tr:first-child > th, .table > thead:first-child > tr:first-child > td, .table > thead:first-child > tr:first-child > th {
        border-top: 0;
    }

    .table > caption + thead > tr:first-child > td, .table > caption + thead > tr:first-child > th, .table > colgroup + thead > tr:first-child > td, .table > colgroup + thead > tr:first-child > th, .table > thead:first-child > tr:first-child > td, .table > thead:first-child > tr:first-child > th {
        border-top: 0;
    }

    table.dataTable thead .sorting_asc {
        background-image: url(../images/sort_asc.png);
    }

    table.dataTable thead .sorting, table.dataTable thead .sorting_asc, table.dataTable thead .sorting_desc, table.dataTable thead .sorting_asc_disabled, table.dataTable thead .sorting_desc_disabled {
        cursor: pointer;
        *cursor: hand;
        background-repeat: no-repeat;
        background-position: center right;
    }

    table.dataTable thead th, table.dataTable thead td {
        padding: 10px 18px;
        border-bottom: 1px solid #111;
    }

    table.dataTable thead th, table.dataTable tfoot th {
        font-weight: bold;
    }

    table.dataTable thead th, table.dataTable thead td {
        padding: 10px 18px;
        border-bottom: 1px solid #fff !important;
    }

    .table > thead > tr > th {
        vertical-align: bottom;
        border-bottom: 2px solid #ddd;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        padding: 8px;
        line-height: 1.42857143;
        vertical-align: top;
        border-top: 1px solid #ddd;
    }

    .table > thead > tr > th {
        vertical-align: bottom;
        border-bottom: 2px solid #ddd;
        background: #bddff7;
        font-size: 16px;
        font-weight: 500 !important;
    }


    .dataTables_wrapper {
        border: 1px solid #d0e6f6;
        padding: 5px;
        text-align: left;
    }

    @@media screen and (max-width: 767px) {

        .dataTables_wrapper {
            width: max-content;
        }
    }

    @@media screen and (max-width: 767px) {

        .dataTables_wrapper .dataTables_filter {
            text-align: left !important;
        }
    }

    @@media screen and (max-width: 767px) {

        .dataTables_wrapper .dataTables_info, .dataTables_wrapper .dataTables_paginate {
            text-align: left !important;
        }
    }

    @@media screen and (max-width: 767px) {

        div.dt-buttons {
            text-align: left !important;
        }
    }

    table .dataTable.no-footer {
        border-bottom: 1px solid #111;
        border: 1px solid #bddff7 !important;
    }

    table.dataTable thead th, table.dataTable thead td {
        padding: 10px 18px;
        border-bottom: 1px solid #fff !important;
    }

    table .dataTable.no-footer {
        border-bottom: 1px solid #111;
        border: 1px solid #bddff7;
    }

    table.dataTable tbody th, table.dataTable tbody td {
        padding: 8px 10px;
        border-right: 1px solid #bddff7;
        border-top: 1px solid #bddff7;
        padding-left: 20px !important;
    }

    .table > tbody + tbody {
        border-top: 2px solid #ddd;
        display: none;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
        box-sizing: border-box;
        display: inline-block;
        min-width: 1.5em;
        padding: 8px 8px 8px 8px !important;
        margin-left: 0px !important;
        text-align: center;
        text-decoration: none !important;
        cursor: pointer;
        *cursor: hand;
        color: #333 !important;
        border: 1px solid transparent;
        border-radius: 0px !important;
        float: left;
        text-decoration: none;
        transition: background-color .3s !important;
        font-size: 14px !important;
        border-radius: 4px !important;
        line-height: 21px !important;
        border-right: 1px solid #dfdfdf !important;
        border-radius: 0px !important;
    }

    .paginate_button current {
        color: #ffffff !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
        background: #35a4f1 !important;
        color: #ffffff !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
        color: #ffffff !important;
    }




    .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 0.3em .9em !important;
    }

    .paginate_button last {
        border-right: 0px solid red !important;
    }
</style>
<style>
    input[type=file] {
        display: block;
        background: #ffffff;
        padding: 0px 2px 0px 0px;
        color: #868f95 !important;
        font-family: roboto;
    }

    .btn-group {
        margin-bottom: 4px;
    }

    .btn {
        padding: 0px;
    }

    .padding0 {
        padding: 0px;
    }

    .btndivcss:hover {
        color: #fff;
        background-color: #03578e;
        border-color: #106dca;
    }

    .btndivcss {
        height: 30px;
        border: 0px solid white;
        padding: 0px 6px 0px 0px !important;
        font-family: roboto;
        border-color: #35a4f1;
        box-shadow: 0 1px 1px rgba(0,0,0,.075);
        color: #ffffff;
        background-color: #35a4f1;
        border-radius: 4px;
    }

    .buttoniconcss {
        background: #106dca;
        padding: 8px;
        border-radius: 4px 0px 0px 4px;
        margin-right: 5px;
    }

    .scrollbar::-webkit-scrollbar {
        width: 6px;
    }

    .scrollbar::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .scrollbar::-webkit-scrollbar-thumb {
        background: #35a4f1;
        border-radius: 23px;
    }

        .scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

    .pagination {
        margin: 0px 0;
    }

    .pagination {
        display: inline-block;
        border-radius: 4px;
    }

        .pagination a {
            color: #35a4f1;
            float: left;
            padding: 1px 8px;
            text-decoration: none;
            transition: background-color .3s;
            font-size: 14px;
            border-radius: 4px;
            line-height: 21px;
        }

            .pagination a.active {
                background-color: #35a4f1;
                color: white;
            }

            .pagination a:hover:not(.active) {
                background-color: #ddd;
            }



    .btn-group {
        padding-right: 4px;
    }

    .tableheading {
        color: #4c6588;
        font-family: roboto;
        padding-left: 1px;
        font-size: 17px;
        padding-top: 5px;
    }

    .topheadline {
        background: white;
        padding: 3px;
        color: #1e2123;
        box-shadow: 1px 1px 11px 1px #cecece;
        font-family: roboto;
        padding-left: 12px;
        font-size: 19px;
        margin-top: 0px;
    }

    .panelheading {
        background: rgb(189, 223, 247);
        color: #22292d;
        font-family: roboto;
        font-size: 15px;
        padding: 5px;
        margin-top: 0px;
        margin-bottom: 0px;
    }

    .panel-primary {
        border: 1px solid #dadada;
        border-radius: 4px;
        box-shadow: 1px 1px 11px 1px #eae4e4;
        background: #ffffff;
    }

    .content-wrapper {
        background: #F6F7FB !important;
    }

    span {
        font-family: roboto;
        font-size: 14px;
    }

    .rowmargintop {
        margin-top: 5px;
    }

    .form-control {
        height: 26px;
        padding: 1px 1px 1px 6px;
    }

    .content-header {
        padding: 0px .5rem;
    }

    .rowmarginbottom {
        margin-bottom: 4px;
    }

    th {
        font-family: roboto;
        font-size: 15px;
        font-weight: 500;
        background: #e6e5e5;
        padding: 4px !important;
        text-align: center;
        background-image: linear-gradient(#bcdcf3, #ffffff, #c6e1f4);
    }

    td {
        font-family: roboto;
        font-size: 14px;
        font-weight: 400;
        padding: 4px !important;
    }

    .table {
        background: #ffffff;
        border-radius: 4px;
        border-collapse: inherit;
        margin-bottom: 3px;
    }

    .btn-warning {
        color: #ffffff;
        background-color: #35a4f1;
        border-color: #35a4f1;
        box-shadow: 0 1px 1px rgba(0,0,0,.075);
        font-family: roboto;
    }
</style>
<style>
    .btn-primary {
        background-color: #35a4f1 !important;
        color: #fff;
        border: 1px solid #35a4f1;
    }

    .file-field input[type=file] {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        width: 100%;
        margin: 0;
        padding: 0;
        cursor: pointer;
        opacity: 0;
    }

    tr.highlighted td {
        background: #35a4f1;
        color: white;
    }
</style>

<style>
    .checkbox, .radio {
        position: relative;
        display: block;
        margin-top: 0px !important;
        margin-bottom: 10px;
    }

    table.dataTable tbody th, table.dataTable tbody td {
        padding: 8px 10px;
        border-right: 1px solid #bddff7;
        border-top: 1px solid #bddff7;
        padding-left: 20px !important;
    }

    .table-bordered > tbody > tr > td {
        border: 0px solid #e1eff9;
        padding: 3px !important;
        border-left: 1px solid #e1eff9;
        border-right: 0px solid #e1eff9;
    }



    table.dataTable tbody tr:hover {
        background-color: #ebf1f6;
        cursor: pointer !important;
    }



    #deptID_wrapper {
        overflow: auto;
        width: 100%;
    }

    .exportExcel {
        padding: 4px !important;
        font-family: roboto !important;
    }

    select {
        border: 1px solid #d9d8d8 !important;
        border-radius: 3px !important;
        padding: 2px;
    }


    table.dataTable.no-footer {
        border-bottom: 1px solid #111;
        border: 1px solid #bddff7 !important;
    }

    .dataTables_wrapper .dataTables_filter input {
        margin-left: 0.5em;
        border: 1px solid #d9d8d8 !important;
        border-radius: 3px !important;
    }

    label:not(.form-check-label):not(.custom-file-label) {
        font-weight: 500 !important;
        font-family: roboto;
    }

    .dataTables_info {
        padding: 4.5px !important;
        border: 2px solid white !important;
        font-family: roboto;
        border-right: 0px solid red !important;
    }

    .dataTables_wrapper .dataTables_paginate {
        display: table;
        font-family: roboto;
        border-left: 0px solid red !important;
        border: 1px solid rgba(0,0,0,.125) !important;
        border-radius: .25rem;
        padding-top: 0em !important;
        margin-top: 5px;
    }



    .table > caption + thead > tr:first-child > td, .table > caption + thead > tr:first-child > th, .table > colgroup + thead > tr:first-child > td, .table > colgroup + thead > tr:first-child > th, .table > thead:first-child > tr:first-child > td, .table > thead:first-child > tr:first-child > th {
        border-top: 0;
    }

    .table > caption + thead > tr:first-child > td, .table > caption + thead > tr:first-child > th, .table > colgroup + thead > tr:first-child > td, .table > colgroup + thead > tr:first-child > th, .table > thead:first-child > tr:first-child > td, .table > thead:first-child > tr:first-child > th {
        border-top: 0;
    }

    table.dataTable thead .sorting_asc {
        background: #bddff7;
    }

    table.dataTable thead .sorting, table.dataTable thead .sorting_asc, table.dataTable thead .sorting_desc, table.dataTable thead .sorting_asc_disabled, table.dataTable thead .sorting_desc_disabled {
        cursor: pointer;
        *cursor: hand;
        background-repeat: no-repeat;
        background-position: center right;
    }

    table.dataTable thead th, table.dataTable thead td {
        padding: 10px 18px;
        border-bottom: 1px solid #111;
    }

    table.dataTable thead th, table.dataTable tfoot th {
        font-weight: bold;
    }

    table.dataTable thead th, table.dataTable thead td {
        padding: 10px 18px;
        border-bottom: 1px solid #fff !important;
    }

    .table > thead > tr > th {
        vertical-align: bottom;
        border-bottom: 2px solid #ddd;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        padding: 8px;
        line-height: 1.42857143;
        vertical-align: top;
        border-top: 1px solid #ddd;
    }

    .table > thead > tr > th {
        vertical-align: bottom;
        border-bottom: 2px solid #ddd;
        background: #bddff7;
        font-size: 15px;
        font-weight: 500 !important;
    }


    .dataTables_wrapper {
        border: 1px solid #d0e6f6;
        padding: 5px;
        text-align: left;
    }

    @@media screen and (max-width: 767px) {

        .dataTables_wrapper {
            width: max-content;
        }
    }

    @@media screen and (max-width: 767px) {

        .dataTables_wrapper .dataTables_filter {
            text-align: left !important;
        }
    }

    @@media screen and (max-width: 767px) {

        .dataTables_wrapper .dataTables_info, .dataTables_wrapper .dataTables_paginate {
            text-align: left !important;
        }
    }

    @@media screen and (max-width: 767px) {

        div.dt-buttons {
            text-align: left !important;
        }
    }

    table .dataTable.no-footer {
        border-bottom: 1px solid #111;
        border: 1px solid #bddff7 !important;
    }

    table.dataTable thead th, table.dataTable thead td {
        padding: 10px 18px;
        border-bottom: 1px solid #fff !important;
    }

    table .dataTable.no-footer {
        border-bottom: 1px solid #111;
        border: 1px solid #bddff7;
    }

    table.dataTable tbody th, table.dataTable tbody td {
        padding: 8px 10px;
        border-right: 1px solid #bddff7;
        border-top: 1px solid #bddff7;
        padding-left: 20px !important;
    }

    .table > tbody + tbody {
        border-top: 2px solid #ddd;
        display: none;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
        box-sizing: border-box;
        display: inline-block;
        min-width: 1.5em;
        padding: 8px 8px 8px 8px !important;
        margin-left: 0px !important;
        text-align: center;
        text-decoration: none !important;
        cursor: pointer;
        *cursor: hand;
        color: #333 !important;
        border: 1px solid transparent;
        border-radius: 0px !important;
        float: left;
        text-decoration: none;
        transition: background-color .3s !important;
        font-size: 14px !important;
        border-radius: 4px !important;
        line-height: 21px !important;
        border-right: 1px solid #dfdfdf !important;
        border-radius: 0px !important;
    }

    .paginate_button current {
        color: #ffffff !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
        background: #35a4f1 !important;
        color: #ffffff !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
        color: #ffffff !important;
    }




    .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 0.3em .9em !important;
    }

    .paginate_button last {
        border-right: 0px solid red !important;
    }
</style>
<style>
    input[type=file] {
        display: block;
        background: #ffffff;
        padding: 0px 2px 0px 0px;
        color: #868f95 !important;
        font-family: roboto;
    }

    .btn-group {
        margin-bottom: 4px;
    }

    .btn {
        padding: 0px;
    }

    .padding0 {
        padding: 0px;
    }

    .btndivcss:hover {
        color: #fff;
        background-color: #03578e;
        border-color: #106dca;
    }

    .btndivcss {
        height: 30px;
        border: 0px solid white;
        padding: 0px 6px 0px 0px !important;
        font-family: roboto;
        border-color: #35a4f1;
        box-shadow: 0 1px 1px rgba(0,0,0,.075);
        color: #ffffff;
        background-color: #35a4f1;
        border-radius: 4px;
    }

    .buttoniconcss {
        background: #106dca;
        padding: 8px;
        border-radius: 4px 0px 0px 4px;
        margin-right: 5px;
    }

    .scrollbar::-webkit-scrollbar {
        width: 6px;
    }

    .scrollbar::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .scrollbar::-webkit-scrollbar-thumb {
        background: #35a4f1;
        border-radius: 23px;
    }

        .scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

    .pagination {
        margin: 0px 0;
    }

    .pagination {
        display: inline-block;
        border-radius: 4px;
    }

        .pagination a {
            color: #35a4f1;
            float: left;
            padding: 1px 8px;
            text-decoration: none;
            transition: background-color .3s;
            font-size: 14px;
            border-radius: 4px;
            line-height: 21px;
        }

            .pagination a.active {
                background-color: #35a4f1;
                color: white;
            }

            .pagination a:hover:not(.active) {
                background-color: #ddd;
            }



    .btn-group {
        padding-right: 4px;
    }

    .tableheading {
        color: #4c6588;
        font-family: roboto;
        padding-left: 1px;
        font-size: 17px;
        padding-top: 5px;
    }

    .topheadline {
        background: white;
        padding: 3px;
        color: #1e2123;
        box-shadow: 1px 1px 11px 1px #cecece;
        font-family: roboto;
        padding-left: 12px;
        font-size: 19px;
        margin-top: 0px;
    }

    .panelheading {
        background: rgb(189, 223, 247);
        color: #22292d;
        font-family: roboto;
        font-size: 15px;
        padding: 5px;
        margin-top: 0px;
        margin-bottom: 0px;
    }

    .panel-primary {
        border: 1px solid #dadada;
        border-radius: 4px;
        box-shadow: 1px 1px 11px 1px #eae4e4;
        background: #ffffff;
    }

    .content-wrapper {
        background: #F6F7FB !important;
    }

    span {
        font-family: roboto;
        font-size: 14px;
    }

    .rowmargintop {
        margin-top: 5px;
    }

    .form-control {
        height: 26px;
        padding: 1px 1px 1px 6px;
    }

    .content-header {
        padding: 0px .5rem;
    }

    .rowmarginbottom {
        margin-bottom: 4px;
    }

    th {
        font-family: roboto;
        font-size: 15px;
        font-weight: 500;
        background: #e6e5e5;
        padding: 4px !important;
        text-align: center;
        background-image: linear-gradient(#bcdcf3, #ffffff, #c6e1f4);
    }

    td {
        font-family: roboto;
        font-size: 14px;
        font-weight: 400;
        padding: 0px !important;
    }

    .table {
        background: #ffffff;
        border-radius: 4px;
        border-collapse: inherit;
        margin-bottom: 3px;
    }

    .btn-warning {
        color: #ffffff;
        background-color: #35a4f1;
        border-color: #35a4f1;
        box-shadow: 0 1px 1px rgba(0,0,0,.075);
        font-family: roboto;
    }
</style>
<style>
    .btn-primary {
        background-color: #35a4f1 !important;
        color: #fff;
        border: 1px solid #35a4f1;
    }

    .file-field input[type=file] {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        width: 100%;
        margin: 0;
        padding: 0;
        cursor: pointer;
        opacity: 0;
    }

    tr.highlighted td {
        background: #35a4f1;
        color: white;
    }
</style>
<style>
    .btn-primary {
        background-color: #35a4f1 !important;
        color: #fff;
        border: 1px solid #35a4f1;
    }

    .file-field input[type=file] {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        width: 100%;
        margin: 0;
        padding: 0;
        cursor: pointer;
        opacity: 0;
    }

    .tab .nav-tabs > li {
        margin-right: 2px;
    }

        .tab .nav-tabs > li > a {
            border: none;
            padding: 6px 10px;
            color: #fff;
            background: #4e6270;
            border-radius: 0;
            font-family: roboto;
            font-size: 15px;
            border-radius: 5px 5px 0px 0px;
        }

            .tab .nav-tabs > li > a > i {
                font-size: 14px;
                margin-right: 10px;
            }

        .tab .nav-tabs > li.active > a,
        .tab .nav-tabs > li.active > a:focus,
        .tab .nav-tabs > li.active > a:hover {
            border: none;
            background: #e74c3c;
            color: #fff;
            transition: background 0.20s linear;
        }

    a {
        color: #195580;
        text-decoration: none;
    }

    .tab .nav-tabs li.active:after {
        content: " ";
        position: absolute;
        bottom: -25px;
        left: 37%;
        border: 15px solid transparent;
        border-top-color: #e74c3c;
        z-index: 999;
    }

    .tab .tab-content {
        background: #fdfdfd;
        line-height: 25px;
        padding: 30px 45px;
        font-family: roboto;
        line-height: 30px;
        border: 2px solid #bddff7;
    }

    @@media only screen and (max-width 480px) {
        .tab > .nav-tabs li {
            width: 100%;
        }

        .tab .nav-tabs > li > a {
            padding: 20px;
            font-family: roboto;
        }

        .tab .nav-tabs > li.active:after {
            border: none;
        }
    }
</style>
<style>
    #ui-id-1 {
        background: #ffffff !important;
        border: 1px solid #cfcfdb;
        border-radius: 4px;
        box-shadow: 1px 1px 11px 1px #eae4e4;
        height: 200px;
        overflow: auto;
        width: 250px;
        font-family: roboto;
        padding-inline-start: 0px;
    }

        #ui-id-1 li {
            cursor: pointer;
            list-style-type: none;
            border-bottom: 1px solid #d3d0d0;
            text-align: left;
            padding: 5px;
            padding-left: 10px;
        }

            #ui-id-1 li:hover {
                cursor: pointer;
                background: #e1f3ff;
            }

    #ui-id-2 {
        background: #ffffff !important;
        border: 1px solid #cfcfdb;
        border-radius: 4px;
        box-shadow: 1px 1px 11px 1px #eae4e4;
        height: 200px;
        overflow: auto;
        width: 250px;
        font-family: roboto;
        padding-inline-start: 0px;
    }

        #ui-id-2 li {
            cursor: pointer;
            list-style-type: none;
            border-bottom: 1px solid #d3d0d0;
            text-align: left;
            padding: 5px;
            padding-left: 10px;
        }

            #ui-id-2 li:hover {
                cursor: pointer;
                background: #e1f3ff;
            }

    #ui-id-3 {
        background: #ffffff !important;
        border: 1px solid #cfcfdb;
        border-radius: 4px;
        box-shadow: 1px 1px 11px 1px #eae4e4;
        min-height: 20px;
        overflow: auto;
        width: 250px;
        font-family: roboto;
        padding-inline-start: 0px;
        max-width: 250px;
        max-height: 200px;
    }

        #ui-id-3 li {
            cursor: pointer;
            list-style-type: none;
            border-bottom: 1px solid #d3d0d0;
            text-align: left;
            padding: 5px;
            padding-left: 10px;
        }

            #ui-id-3 li:hover {
                cursor: pointer;
                background: #e1f3ff;
            }

    .the-legend {
        border-style: none;
        border-width: 0;
        font-size: 14px;
        line-height: 20px;
        margin-bottom: 0;
        width: auto;
        padding: 0 10px;
        border: 1px solid #e0e0e0;
        font-family: roboto;
        background: #bddff7;
    }

    .the-fieldset {
        border: 1px solid #e0e0e0;
        padding: 4px;
        background: #ffffff;
        font-family: roboto;
    }



    table.dataTable tbody th, table.dataTable tbody td {
        padding: 4px 10px !important;
    }
</style>
<style>
    .the-legend {
        border-style: none;
        border-width: 0;
        font-size: 14px;
        line-height: 20px;
        margin-bottom: 0;
        width: auto;
        padding: 0 10px;
        border: 1px solid #e0e0e0;
        font-family: roboto;
        background: #bddff7;
    }

    .the-fieldset {
        border: 1px solid #e0e0e0;
        padding: 4px;
        background: #ffffff;
        font-family: roboto;
        border-bottom: 0px solid red;
    }

    .dataTables_wrapper .dataTables_filter {
        float: right;
        text-align: right;
        display: none;
    }

    table.dataTable tbody th, table.dataTable tbody td {
        padding: 4px 10px !important;
    }
</style>
<style>
    .suggestions {
        border: 1px solid #CCC;
        background-color: #FFF;
        width: 300px;
        z-index: 1;
        position: absolute;
        top: 30px;
        left: 15px;
    }

    .suggest-grid tr.active td {
        background-color: #777 !important;
        color: #FFF;
    }

    .tbl {
        background-color: blue;
        color: white;
    }
</style>

<script>
    
</script>
@* Payment type *@
@if (TempData["Msg"] != null)
{
    <script type="text/javascript">
        @*alert(@Html.Raw(Json.Encode(TempData["msg"])));
        window.onload(true);*@
        // Restor();
    </script>
}
<script>
    function Date1() {
        debugger
        var dtToday = new Date();
        var month = dtToday.getMonth() + 1;
        var day = dtToday.getDate();
        var year = dtToday.getFullYear();
        if (month < 10)
            month = '0' + month.toString();
        if (day < 10)
            day = '0' + day.toString();
        var maxDate = year+ '-' +month+ '-' +day;
        $('#bill_date').attr('min', maxDate);
    }
    Date1();
    $(document).ready(function () {
       
        $("#patient_reg_no_id").focus();

        $("#DoctorSaveDivs").hide();
        var number, name, date, remark,paymenttype = "";
        var chk = true;
        $("#cl").click(function () {
            debugger
            $("#DoctorSaveDivs").hide();
            if ($("#Number").val() != "" || $("#Name").val() != "" || $("#paymentDate").val() != "")
            {
                chk = true;
             }
            if (chk) {
                number = $("#Number").val();
                name = $("#Name").val();
                date = $("#paymentDate").val();
                remark = $("#Remarks").val();
                paymenttype = document.getElementById("payment_type").value;
                chk = false;
            }
        });

        $("#payment_type").change(function () {
            debugger
            var select = document.getElementById("payment_type").value;
            $("#Number").val('');
            $("#Name").val('');
            $("#paymentDate").val('');
            $("#Remarks").val('');
            if (paymenttype == select)
             {
                 $("#Number").val(number);
                 $("#Name").val(name);
                 $("#paymentDate").val(date);
                 $("#Remarks").val(remark);
             }
            switch (select) {
                case 'Cheque':
                    $("#DoctorSaveDivs").show(300);
                    $("#PaymentNo1").text("Cheque No");


                    $("#paymentName1").text("Bank Name");

                    $("#paymentDate1").text("Cheque Date");

                    $("#paymentRemark1").text("Remark");
                    break;


                case 'Debit Card':
                    $("#DoctorSaveDivs").show(300);
                    $("#PaymentNo1").text("Debit Card No");


                    $("#paymentName1").text("Holder Name");

                    $("#paymentDate1").text("Valid UPTO");

                    $("#paymentRemark1").text("Remark");
                    break;



                case 'Credit Card':
                    $("#DoctorSaveDivs").show(300);
                    $("#PaymentNo1").text("Credit Card No");
                    $("#paymentName1").text("Holder Name");
                    $("#paymentDate1").text("Valid UPTO");
                    $("#paymentRemark1").text("Remark");
                    break;

                case 'E-money':
                    $("#DoctorSaveDivs").show(300);
                    $("#PaymentNo1").text("Code");
                    $("#paymentName1").text("Bank Name");
                    $("#paymentDate1").text("Date");
                    $("#paymentRemark1").text("Remark");
                    break;

                case 'EFT':
                    $("#DoctorSaveDivs").show(300);
                    $("#PaymentNo1").text("Code");
                    $("#paymentName1").text("Bank Name");
                    $("#paymentDate1").text("Date");
                    $("#paymentRemark1").text("Remark");
                    break;

                case 'CASH':

                    $("#DoctorSaveDivs").hide(300);
                    break;
            }
        });
    });

</script>

<script>

    function RemoveSvcTable(button) {
        //  alert("In Remove");
        debugger
        //$(this).closest('tr').remove();
        var selValue2 = $('input[name=RadioChargee]:checked').val();
        if (selValue2 == '2' || selValue2 == '3' || selValue2 == '1') {
            $(button).parent().parent().remove();
            var sum = 0;

            var row = $("#datatable-responsive td").closest("tr").length;

            if (row == 0) {
                $("#gross_total").val(0);
                $("#gross_total_id").val(0);
               // $("#total_amount").val(0);
               // $("#total_amount_id,#netpayable_id,#netpayable").val(0);
             //   calculator();

                var prebal = $("#pre_balance").val();


                var name = $("#priPalanceDeposit").text();
                if ($("#priPalanceDeposit").text() == "Pre.Balance") {
                    var tot = parseInt(sum) + parseInt(prebal);
                }
                else {
                    var tot = parseInt(sum) - parseInt(prebal);
                }


                $("#total_amount").val(tot);
                $("#total_amount_id").val(tot);

                if ($('#disc_amount').val() == '') {
                    var net = parseInt(tot) - parseInt(0);
                    $("#netpayable").val(tot);
                    $("#netpayable_id").val(net);
                }
                $("#amtpaid").keyup();
            }
            $(".total").each(function () {
                //var rate = $(this).parent().find('#txt_tbl_rate').val();
                //var qty = $(this).parent().find('#txt_tbl_qty').val();
                //var tot = parseFloat(rate) * parseFloat(qty);
                //var value = $(this).text();
                //$(this).text(tot);

                var rate = $(this).parent().find('#txt_tbl_rate').val();
                var qty = $(this).parent().find('#txt_tbl_qty').val();
                $(this).parent().find('#svc_rate_hid').val(rate);
                $(this).parent().find('#svc_qty_hid').val(qty);

                var tot2 = parseFloat(rate) * parseFloat(qty);
                $(this).text(tot2);

                var value = $(this).text();
                $(this).parent().find('#tot_hid').val(tot2);
                if (!isNaN(tot2) && tot2.length != 0) {
                    sum += parseFloat(tot2);
                }
                $("#gross_total").val(sum);
                $("#gross_total_id").val(sum);
                var prebal = $("#pre_balance").val();


                var name = $("#priPalanceDeposit").text();
                if ($("#priPalanceDeposit").text() == "Pre.Balance") {
                    var tot = parseInt(sum) + parseInt(prebal);
                }
                else {
                    var tot = parseInt(sum) - parseInt(prebal);
                }


                $("#total_amount").val(tot);
                $("#total_amount_id").val(tot);

                if ($('#disc_amount').val() == '') {
                    var net = parseInt(tot) - parseInt(0);
                    $("#netpayable").val(tot);
                    $("#netpayable_id").val(net);
                }
                else {
                    var disc = $('#disc_amount').val();
                    var tot = $("#total_amount").val();

                    var net = parseInt(tot) - parseInt(disc);
                    $("#netpayable").val(net);
                    $("#netpayable_id").val(net);
                }
                CaculateDescount();


            });
        }
        else {
            if ($("#old_bill_no_id") > 0) {

                alert("Delete From IPD Bills..");
            }
            else {
                $(button).parent().parent().remove();
            }
        }
    }


    $(document).ready(function () {


        $("#patient_reg_no_year").change(function () {
            //$("#patient_name").attr('value', '123');
            //$("#patient_ipd_no").val('123');
            // alert($("#patient_reg_no_id").val())
            /*
            var strSelected = "";
            $("#ddl option:selected").each(function () {
                strSelected += $(this)[0].value;
            });
            var url = "/Home/MyAction/" + strSelected;

            $.post(url, function (data) {
                // do something if necessary
            });
            */
        });

        var tot2 = 0;
        $(document).on('keyup', '#txt_tbl_rate', function () {
            var sum = 0;
            debugger
            $(".total").each(function () {
                //var rate = $(this).parent().find('#txt_tbl_rate').val();
                //var qty = $(this).parent().find('#txt_tbl_qty').val();
                //var tot = parseFloat(rate) * parseFloat(qty);
                //var value = $(this).text();
                //$(this).text(tot);
                var sevicedisAmt = $(this).parent().find('#sevicedisAmt').val();
                var rate = $(this).parent().find('#txt_tbl_rate').val();
                var qty = $(this).parent().find('#txt_tbl_qty').val();
                $(this).parent().find('#svc_rate_hid').val(rate);
                $(this).parent().find('#svc_qty_hid').val(qty);

                //var tot2 = parseFloat(rate) * parseFloat(qty) - parseFloat(sevicedisAmt);;
                tot2+=  parseFloat(sevicedisAmt);
                //  $(this).text(tot2);
                $("#disc_amount").val(tot2);
                $(this).text(parseFloat(rate) * parseFloat(qty));
                var value = parseFloat(rate) * parseFloat(qty);
                $(this).parent().find('#tot_hid').val(parseFloat(rate) * parseFloat(qty));
                if (!isNaN(value) && value.length != 0) {
                    sum += parseFloat(value);
                }
                $("#gross_total").val(sum);
                $("#gross_total_id").val(sum);
                var prebal = $("#pre_balance").val();

                var name = $("#priPalanceDeposit").text();

                if ($("#priPalanceDeposit").text() == "Pre.Balance") {
                    var tot = parseInt(sum) + parseInt(prebal);
                }
                else {
                    var tot = parseInt(sum) - parseInt(prebal);
                }


                //    var tot = parseInt(sum) + parseInt(prebal);
                $("#total_amount").val(tot);
                $("#total_amount_id").val(tot);

                if ($('#disc_amount').val() == '') {
                    var net = parseInt(tot) - parseInt(0);
                    $("#netpayable").val(tot);
                    $("#netpayable_id").val(net);
                }
                else {
                    var disc = $('#disc_amount').val();
                    var tot = $("#total_amount").val();

                    var net = parseInt(tot) - parseInt(disc);
                    $("#netpayable").val(net);
                    $("#netpayable_id").val(net);
                }
                var disc = $('#netpayable').val();
                var amtpaid = $("#amtpaid").val();

                var bal = parseInt(disc) - parseInt(amtpaid);
                $("#bal_amount").val(bal);
                $("#bal_amount_id").val(bal);
                $("#amtpaid_id").val(amtpaid);


            });



            $(".total").each(function () {
                debugger
                $(this).parent().find('#txt_tbl_rate').attr('placeholder', 0);
                $(this).parent().find('#Discount_Service').attr('placeholder', 0);
                var rate = $(this).parent().find('#txt_tbl_rate').val();
                if (rate == 0) {
                    $(this).parent().find('#txt_tbl_rate').val('');
                    $(this).html(0);
                }

                var Discount_Service = $(this).parent().find('#Discount_Service').val();
                if (Discount_Service == 0) {
                    $(this).parent().find('#Discount_Service').val('');
                }
            })
        });

        $(document).on('keyup', '#txt_tbl_qty', function () {
    debugger
            calculator();
        })

        $("#NonMedicalExp").keyup(function () {
            NonMedicl();
        })
    })

    function NonMedicl() {
        debugger
        var selValue2 = $('input[name=RadioChargee]:checked').val();
        var Type = $('input[name=RadioCharge]:checked').val();
        var tot = 0;
        if ($("#NonMedicalExp").val() == "") {
            //   calculator();
            $("#NonMedicalExp").val(0)
        }
        if ($("#gross_total_id").val() == "") {
            //   calculator();
            $("#gross_total_id").val(0)
        }
        if (selValue2 == 3 && Type == "TPA") {
            var tot1 = parseInt($("#gross_total_id").val()) + parseInt($("#pre_balance_id").val());
            $("#total_amount").val(tot1);
            $("#total_amount_id").val(tot1);

            tot = tot1 - parseFloat($("#NonMedicalExp").val());
            $("#total_amount").val(tot);
            $("#total_amount_id").val(tot);

            // calculator();
        }




    }
    function calculator() {
        var sum = 0;
        var tot2 = 0;
        if ($("#tax_amount").val() == '' || $("#tax_amount").val() == 'NaN')
        {
            $("#tax_amount").val(0)
        }
        $(".total").each(function () {
            debugger
            var Discount_Service = $(this).parent().find('#Discount_Service').val();

            var sevicedisAmt = $(this).parent().find('#sevicedisAmt').val();
            var rate = $(this).parent().find('#txt_tbl_rate').val();
            var qty = $(this).parent().find('#txt_tbl_qty').val();

            debugger
            if (Discount_Service == "NaN" || Discount_Service == "") {
                $(this).parent().find('#Discount_Service').val(0)
            }
            if (rate == "") {
                $(this).parent().find('#txt_tbl_rate').val(0)
            }
            if (qty == "") {
                $(this).parent().find('#txt_tbl_qty').val(0);
            }
           if (sevicedisAmt == "NaN" || sevicedisAmt == "") {
                $(this).parent().find('#sevicedisAmt').val(0);
            }
            $(this).parent().find('#svc_rate_hid').val(rate);
            $(this).parent().find('#svc_qty_hid').val(qty);
            // var value = $(this).text(parseFloat(rate) * parseFloat(qty));
            //   $(this).parent().find('#tot_hid').val(parseFloat(rate) * parseFloat(qty));
            tot2+=  parseFloat(sevicedisAmt);
            //   $(this).text(tot2);
            if (tot2 > 0) {
                $("#disc_amount").val(tot2);
                $("#disc_amount_id").val(tot2);
            }

            $(this).text(parseFloat(rate) * parseFloat(qty));
            $(this).parent().find('#tot_hid').val(parseFloat(rate) * parseFloat(qty));
            var value = parseFloat(rate) * parseFloat(qty);
            if (!isNaN(value) && value.length != 0) {
                sum += parseFloat(value);
            }

            $("#gross_total").val(sum);
            $("#gross_total_id").val(sum);

            var prebal = $("#pre_balance").val();
            var name = $("#priPalanceDeposit").text();

            if ($("#priPalanceDeposit").text() == "Pre.Balance") {
                var tot = parseInt(sum) + parseInt(prebal);
            }
            else {
                var tot = parseInt(sum) - parseInt(prebal);
            }
            //  var tot = parseInt(sum) + parseInt(prebal);
            $("#total_amount").val(parseFloat(tot) + parseFloat($("#tax_amount").val()));
            $("#total_amount_id").val(parseFloat(tot) + parseFloat($("#tax_amount").val()));
            NonMedicl();
            if ($('#disc_amount').val() == '') {
                var net = parseInt(tot) - parseInt(0);
                $("#netpayable").val(tot);
                $("#netpayable_id").val(net);
            }
            else {
                var disc = $('#disc_amount').val();
                var tot = $("#total_amount").val();

                var net = parseInt(tot) - parseInt(disc);
                $("#netpayable").val(net);
                $("#netpayable_id").val(net);
            }
            var disc = $('#netpayable').val();
            var amtpaid = $("#amtpaid").val();

            if ($("#amtpaid").val() == "") {
                amtpaid = 0;
            }
            var bal = parseInt(disc) - parseInt(amtpaid);
            $("#bal_amount").val(bal);
            $("#bal_amount_id").val(bal);
            $("#amtpaid_id").val(amtpaid);


        });


    }

    $(document).ready(function () {

        var text2 = $("#patient_name").tautocomplete({
            width: "auto",
            columns: ['PatientRegNO', 'PatientName', 'Gender', 'GuardianName', 'MobileNo', 'Address'],
            placeholder: "Patient Name",
            ajax: {
                url: '@Url.Action("GetPatientNameValue", "IPDBill")',
                type: "GET",
                dataType: "json",
                data: { search :"%"}, function () {
                    var x = { test: text2.searchdata()};
                    return x;
                },

                success: function (data) {
                    debugger
                    var filterData = [];
                    var searchData = eval("/" + text2.searchdata() + "/gi");
                    $.each(data, function (i, v) {
                        if (v.PatientName.search(new RegExp(searchData)) != -1) {
                            filterData.push(v);
                        }
                    });
                    return filterData;
                }
            }
        });
     });

            @*if (e.keyCode == 46) {
                if ($("#old_bill_no_id").val() > 0) {
                    var conform = confirm("Do you Want To Delete");
                    if (conform) {
                        debugger
                        var r = myFunction();
                        $.ajax({
                            url: '@Url.Action("Delete", "IPDBill")',
                            type: 'POST',
                            data: { PatientRegNO: $("#patient_reg_no_id").val(), BillNo: $("#old_bill_no_id").val() },
                            success: function (data) {

                                if (data.length > 1) {

                                    alert("Delete Successfully");
                                    // changePatientbind();
                                    Restore();
                                    $("#datatable-responsive td").remove();
                                }
                            }
                        })

                    }

                }
                else {
                    alert("Select Bill No");
                }
            }
        }*@

    $(document).ready(function () {

        $('#patient_name').change(function () {


            PatientDetailFillData();
            debugger
            selValue2 = $('input[name=RadioChargee]:checked').val();
            if (selValue2 == "2") {
                CaculateDescount();
            }
            if (selValue2 == '1') {
                var EmergencyGeneral = "";
                //AutoBindService();
            }
        })
    })

    function AutoBindService() {

        var EmergencyGeneral = "";
        $.ajax({
            url: '@Url.Action("GetServiceAutoBind", "IPDBill")',
            type: "POST",
            dataType: "json",
            data: { BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val(), chk: $('input[name=RadioCharge]:checked').val(), RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), OrganizationID: $("#TPAID").val(), TPA: document.getElementById("TPA").checked },
            success: function (data) {
                debugger
                if (flagfinal != "true") {

                    $(data).each(function (index, billsitem) {

                        debugger
                        RadioCharge = $('input[name=RadioCharge]:checked').val();
                        billsitem.Rate = "";
                        if (RadioCharge == "General" || RadioCharge == "TPA") {

                            billsitem.Rate = Math.round(billsitem.GeneralCharges);
                        }
                        if (RadioCharge == "Emergency") {

                            billsitem.Rate = Math.round(billsitem.EmergencyCharges);
                        }

                        $('#datatable-responsive tbody').append('<tr><td>' + billsitem.servicename + '<input value="' + billsitem.ServiceID + '" type="hidden" id="svc_hid" name="svc_hid" /><input type="hidden" id="svc_nm_hid" name="svc_nm_hid"  value="' + billsitem.servicename + '" /> <input type="hidden" value="' + $("#consultant_dr_hid").val() + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="1" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + billsitem.Rate + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + billsitem.Quantity + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="text" value=' + billsitem.Rate + '></td><td><input id="txt_tbl_qty" class="form-control" type="number" value=' + billsitem.Quantity + '></td><td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"> <option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value=' + 00 + ' class="nr form-control" type="number" id="Discount_Service" name="Discount_Service" /></td><td class="total">' + billsitem.Quantity * billsitem.Rate + '</td><td style="display:none"><input value="' + billsitem.Quantity * billsitem.Rate + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td  style=" display: flex;"><input type="text" name="doctorID" id="doctorID"  placeholder="Doctor ID.."><select class="fstdropdown-select DoctorPrintNamedgv form-control" ></select></td><td> <button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" name="Mode" value="Add"/><input value="' + billsitem.ServiceType + '" type="hidden" id="ServiceType" name="ServiceType" /><input type="hidden" value="' + billsitem.Doctorcharges + '" name="Doctorcharges"/> <input type="hidden" name="UnitID1" value="' + billsitem.UnitID + '"><input type="hidden" name="Authorization" value="0"></td></tr>');
                        // BindDr();
                    })


                }
                calculator();
            }
        })
    }
    var fin_year_id = "";
    $(document).ready(function () {
        //   BindDr();
       // document.cookie = $("#fin_year_id").val();
        fin_year_id = $("#fin_year_id").val();
          $("#fin_year_id").val(fin_year_id);
        $("#NonMedicalExp").prop('disabled', true);
        $("#chkPrivilege").prop("checked", false);
        $('#patient_reg_no_idprint').change(function () {
            debugger
            $("#patientPrintIPDNo").val('');
            $("#patient_ipd_no_id").val('');
            var printReg = $(this).val();
            // fin_year_id = $("#fin_year_id").val();
            $.ajax({
                url: '@Url.Action("GetPatientPrintNo_ToRegNo", "PatientOPD")',
                dataType: "json",
                type: 'GET',
                data: { PrintRegNo: $("#patient_reg_no_idprint").val() ,PatientType:"IPD" },

                success: function (data) {
                    debugger
                    $("input[type=text],input[type=number] ,hidden").val("");
                    $('#patient_reg_no_idprint').val(printReg);
                   // $('#fin_year_id').val(fin_year_id);
                    if (data == "")
                    {
                        alert("Patient RegNo Does Not Exists");
                        return false;
                    }
                    $("#patient_reg_no_id").val(data)
                    PatientDetailFillData();
                }
            })

            debugger
            selValue2 = $('input[name=RadioChargee]:checked').val();

            if (selValue2 == "2") {

            }
            if (selValue2 == '1') {

                //AutoBindService();

            }
        });


        $('#patientPrintIPDNo').change(function () {
            var UserData = { IPDNo: $("#patientPrintIPDNo").val() };
            selValue2 = $('input[name=RadioChargee]:checked').val();
            $.ajax({
                url: '@Url.Action("GetPatientForIPDNoBills", "IPDBill")',
                dataType: "json",
                type: 'POST',
                data: JSON.stringify(UserData),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {

                    $('#patient_ipd_no_id').val(data[0].PatientIPDNo)
                    $('#patient_reg_no_id').val(data[0].PatientRegNO)
                    var $dropdownoldbill = $("#old_bill_no_id");
                    $dropdownoldbill.val("");
                    PatientDetailFillData();


                    if (selValue2 == '1') {
                       // AutoBindService();
                    }
                    calculator();
                    //   CaculateDescount();
                }
            })
            //
        })

        //--------------------BillNo Serach

        $('#patientPrintBillNo').change(function () {
            debugger;
            patientPrintBillNo();
        })
        var BillNo = localStorage.getItem('BillNo');

        if (BillNo > 0) {
            $("#patientPrintBillNo").val(BillNo);
            $("#patientBillNo").val(BillNo);
            var BillType = localStorage.getItem('BillType');
            debugger
            debugger
            if (BillType == "IPDBill") {
                $('input[name=RadioChargee]:checked').val(1);
                $('#1').prop('checked', true);
            }
            if (BillType == "IPDFinalBill") {
                $('input[name=RadioChargee]:checked').val(3);
                $('#3').prop('checked', true);

            }

            debugger

            patientPrintBillNo();
           localStorage.setItem('BillNo', 0);
            //localStorage.clear();
        }
        function patientPrintBillNo()
        {
            debugger;
            var RegNo = "";
            var BillType = $('input[name=RadioChargee]:checked').val();
            if (BillType == "1") {
                BillType = "IPDBill";
            }
            if (BillType == "2") {
                BillType = "Provinal";
            }
            if (BillType == "3") {
                BillType = "IPDFinalBill";
            }
            var UserData = { BillNo: $("#patientPrintBillNo").val(), BillType: BillType };
            $.ajax({
                url: '@Url.Action("SearchPrintBillNo", "IPDBill")',
                dataType: "json",
                type: 'POST',
                data: JSON.stringify(UserData),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    debugger  
                    $('#patientPrintIPDNo').val(data);
                    debugger;
                    var $dropdownoldbill = $("#old_bill_no_id");
                    $dropdownoldbill.val("");
                    PatientDetailFillData();
                    debugger
                    //$("#old_bill_no_id").val($(this).val());

                    //  CaculateDescount();
                }
            })
            //

        }
        //   $("#section2").hide();
        $('input[name=RadioChargee]').change(function () {
            debugger
            var patient_ipd_no_id = $("#patient_ipd_no_id").val();
            var Reg = $("#patient_reg_no_id").val();
            var Regprint = $("#patient_reg_no_idprint").val();
            $("input[type=text],input[type=number] ,hidden").val("");
            $("#patient_reg_no_id").val(Reg);
            $("#patient_reg_no_idprint").val(Regprint);
            $("#tblbill tr").remove();
            $("#patient_ipd_no_id").val(patient_ipd_no_id);
            $("#fin_year_id").val(fin_year_id);
            calculator();
            PatientDetailFillData();

            $.ajax({
                //url: "/OPDBill/GetAllFinancialYear",
                url: '@Url.Action("GetAllFinancialYear", "OPDBill")',
                type: "GET",
                data: {},
                dataType: "json",
                success: function (data) {
                    debugger;

                    $("#fin_year_id").val(data[0].FinancialYear);
                    $("#fin_year_hid").val(data[0].FinancialYearID);

                },
                error: function (data) {
                }
            });
            debugger

        })

    })
    function TPAServiceGroupTableShow() {

        @*if (document.getElementById("TPA").checked == true) {
            if ($('input[name=ServiceInfoChk]:checked').val() == "Service") {

                URL = '@Url.Action("GetServiceNameTPA", "IPDBill")';
                var1 = { prefix: "%", id: "%", chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val(), OrganizationID: $("#TPAID").val() }

            }
            else
            {
                if ($('input[name=ServiceInfoChk]:checked').val() == "Test")
                {
                    URL = '@Url.Action("GetServiceName", "IPDBill")';
                    var1 = { prefix: $("#servicename").val(), id: "%", chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val() }
                }
            }
            $.ajax({
                url: URL,
                dataType: "json",
                type: "POST",
                data: JSON.stringify(var1),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    var Rate = 0;
                    debugger
                    $("#dgvService tr").remove();
                    $("#dgvGroup tr").remove();
                    $(data).each(function (index, d) {
                        debugger
                        if (d.ServiceGroupCode == null) {
                            d.ServiceGroupCode = "";
                        }
                        $("#dgvGroup").append('<tr><td><input type="radio" id="grID"  name="grID" value=' + d.ServiceGroupID + '></td> <td> ' + d.ServiceGroupName + '</td><td style="display:none"> ' + d.ServiceType + '</td><td> ' + d.ServiceGroupCode + '</td></tr>');

                    })
                }
            })
        }*@
    }
    function TPAServiceTableShow() {
        @*$("#divgp").hide();
        var URL = "";
        var var1 = "";

        if (document.getElementById("TPA").checked == true) {
            if ($('input[name=ServiceInfoChk]:checked').val() == "Service") {
                URL = '@Url.Action("GetServiceNameTPA", "IPDBill")';
                var1 = { prefix: "%", id: "%", chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val(), OrganizationID: $("#TPAID").val() }




                $.ajax({
                    url: URL,
                    dataType: "json",
                    type: "POST",
                    data: JSON.stringify(var1),
                    traditional: true,
                    contentType: 'application/json',
                    success: function (data) {

                        var Rate = 0;
                        $("#dgvService tr").remove();

                        $(data).each(function (index, i) {


                            debugger
                            // TestLabDetailInTPA(i.item.Serviceid)
                            var show = i.Serviceid;

                            var show1 = i.value;

                            RadioCharge = $('input[name=RadioCharge]:checked').val();
                            $("#Unit").val(i.Unit);
                            $("#UnitID").val(i.UnitID);
                            if (i.ServceTrue == "True") {
                                $("#quantity").val(i.Quantity);
                                //  $("#quantity").val(
                            }
                            else {

                                $("#quantity").val(1);
                            }

                            if (RadioCharge == "General") {
                                $("#rate").val(i.GeneralCharges);
                                Rate = i.GeneralCharges;
                            }

                            $("#rate").val(i.GeneralCharges);

                            if (RadioCharge == "Emergency") {

                                $("#rate").val(i.EmergencyCharges);
                                Rate = i.EmergencyCharges;
                            }

                            //TPA Charge

                            if (RadioCharge == "TPA") {
                                $("#rate").val(i.GeneralCharges);
                                $("#quantity").val(i.Quantity);
                            }

                            //----------------
                            $("#ServiceID").val(show);
                            $("#servicename1").val(show1)

                            $("#dgvService").append('<tr><td style="display:none">' + 0 + '</td><td><input type="checkbox" id="chk1"  name="" value=' + i.ServiceID + '></td> <td> </td><td> ' + i.servicename + '</td><td> ' + Rate + '</td><td style="display:none"><input type="hidden" value=' + i.UnitID + ' name="UnitID"> </td></tr>')

                        })
                    }
                })
            }
        }*@

    }

    function CheckDischargePatient(PatientRegNO, PatientIPDNO) {
        debugger
        var chek;
        $.ajax({

            url: '@Url.Action("CheckDischargePatient", "IPDBill")',
            type: "GET",
            data: { PatientRegNO: PatientRegNO, PatientIPDNO: PatientIPDNO },
            dataType: "json",
            success: function (data) {
                debugger;
                if (data == false) {
                    alert("IPD Patient Already Discharge.");
                    chek= false;
                }
                if (data == true) {
                    chek= true;
                }
            },

        });
        return chek;
    }

    var flagfinal = "";
    function PatientDetailFillData() {
        debugger
        $.ajax({
            //url: "/OPDBill/GetAllFinancialYear",
            url: '@Url.Action("GetAllFinancialYear", "OPDBill")',
            type: "GET",
            data: {},
            dataType: "json",
            success: function (data) {
                debugger;
                $("#fin_year_id").val(data[0].FinancialYear);
                $("#fin_year_hid").val(data[0].FinancialYearID);
            },
            error: function (data) {
            }
        });



       // $("#fin_year_id").val(fin_year_id);
        //  document.getElementById("payment_type").value = 'CASH';

        var aaa = $("#patient_reg_no_id").val();
        alert(aaa);

        // var changedText = $(this).val();
        var selValue2 = $('input[name=RadioChargee]:checked').val();

        RadioCharge = $('input[name=RadioCharge]:checked').val();
        var UserData = { RegNo: $("#patient_reg_no_id").val(), RB: selValue2, IPDNo: $("#patient_ipd_no_id").val() };

        //var flagfinal = "";
        $.ajax({
            url: '@Url.Action("GetPatientDetailByReg", "IPDBill")',
            dataType: "json",
            type: 'POST',
            data: JSON.stringify(UserData),
            traditional: true,
            contentType: 'application/json',
            success: function (data) {
                debugger
                $('.reset').find(':input').val('0');
                document.getElementById("disc_reason").value = '';
                document.getElementById("payment_type").value = 'CASH';
                if (selValue2 != '3') {
                    if (data[1].flagfinal == "true") {
                        alert("Final Bill Already Exist ");
                        // $(".btndivcss").prop('disabled', true);
                        $("#btnoldbill").prop('disabled', false);
                        flagfinal = "true";
                    }
                    else {
                        $(".btndivcss").prop('disabled', false);
                        flagfinal = "false"
                    }
                }


                $("#patient_reg_no_idprint").val(data[0].PrintRegNO)
                $("#patient_reg_no_id").val(data[0].PatientRegNO)
                $("#patient_name").val(data[0].PatientName);
                $("#patient_ipd_no").val(data[0].PatientIPDNO);
                $("#patient_ipd_no_id").val(data[0].PatientIPDNO);
                $("#patient_ipd_no_id").val(data[0].PatientIPDNO);
                $("#patientPrintIPDNo").val(data[0].PrintIPDNO);
               // $("patient_ipd_no_txt").val(data[0].GuardianName);
                $("#GuardianName").val(data[0].GuardianName);
                $("#DoctorID").val(data[0].DoctorPrintName);
                $("#Doctor").val(data[0].ConsultantDrID);
                //$("#consultant_dr_hid").val(data[0].ConsultantDrID);
                $("#DepartmentName").val(data[0].DepartmentName);
                $("#DepartmentID").val(data[0].DepartmentID);
                $("#WordName").val(data[0].WardName);
                $("#ward_name_hid").val(data[0].WardID);
                $("#RoomNo").val(data[0].RoomName);
                $("#room_no_hid").val(data[0].RoomID);
                $("#RDoctorPrintName").val(data[0].DoctorPrintName1);
                $("#ReferredByDoctorID").val(data[0].ReferredByDoctorID);
                $("#BedNo").val(data[0].BedName);
                $("#bed_no_hid").val(data[0].BedID);
                debugger
                var check = CheckDischargePatient(data[0].PatientRegNO, data[0].PatientIPDNO);
                

                debugger

                ///////////   --      Fill Packege Reg No

                if (data[0].NameOfPackege != "" && data[0].NameOfPackege!= -1) {

                    var UserData = { ServiceID: data[0].NameOfPackege, WardID: $("#ward_name_hid").val() }
                    $.ajax({
                        url: '@Url.Action("GetAllPackageServiceWise", "IPDBill")',
                        dataType: "json",
                        type: 'POST',
                        data: JSON.stringify(UserData),
                        traditional: true,
                        contentType: 'application/json',
                        success: function (data) {
                            debugger
                            var Rate = 0;
                            if (data == "Already This Packege Add") {

                                return false;
                            }
                            $('#datatable-responsive tbody tr').remove();
                            for (var i = 0; i < data.length; i++) {
                                if (RadioCharge == "General") {
                                    $("#rate").val(data[i].GeneralCharges);

                                    Rate = data[i].GeneralCharges;
                                }

                                // $("#rate").val(i.item.GenralCharge);

                                if (RadioCharge == "Emergency") {
                                    Rate = data[i].EmergencyCharges;
                                    $("#rate").val(data[i].EmergencyCharges);
                                }

                                // $("#quantity").val(data[0].Quantity) * $("#rate").val()
                                //   data[0].EmergencyCharges

                                $('#datatable-responsive tbody').append('<tr><td>' + data[i].servicename + " " + $("#DoctorPrintName").val() + " " + ' <input value="' + data[i].ServiceID + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + data[i].servicename + " " + $("#DoctorPrintName").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + $('#DoctorPrintNameID').val() + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + data[i].UnitID + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + Rate + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + data[i].Quantity + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="number" value=' + Rate + '></td><td><input id="txt_tbl_qty" class="form-control" type="number" value=' + parseInt(data[i].Quantity) + '></td> <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value="0" class="nr form-control" type="number" id="Discount_Service" name="Discount_Service" /></td><td class="total">' + data[i].Quantity * Rate + '</td><td style="display:none"><input value="' + data[i].Quantity * Rate + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td><select class="fstdropdown-select DoctorPrintNamedgv form-control"></select></td><td><button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="IPDPackageBills" type="hidden" id="ServiceType" class="finalbill" name="ServiceType" /><input type="hidden" name="UnitID1" value="' + data[i].UnitID + '"> <input type="hidden" name="Authorization" value="0"></td></td></tr>');
                            }
                            calculator();
                        }
                    })
                }
                else {

                }



                // End

                $('#bill_date').attr('min', data[0].AddmissionDate);
                $("#AdmitDate").val(data[0].AddmissionDate);
                $("#AdmitTime").val(data[0].AddmTime);
                debugger
                $('#datatable-responsive tbody td').remove();
                if (data[0].AddmissionType == 'TPA') {

                    $("#TPA").prop('checked', 'checked');
                    $("#TPAName").val(data[0].TPAName);
                    $("#TPAID").val(data[0].TPA_ID);
                    TPAServiceGroupTableShow();
                    // TPAServiceTableShow();
                    //----TPA Wise Service Bind
                    // $("input[name=RadioCharge]").attr('disabled', true);



                    // $("#serviceGorup").hide();

                    $("#NonMedicalExp").prop('disabled', false);
                    if (data[0].PrivalageCard == true) {
                        $("#chkPrivilege").prop('checked', data[0].PrivalageCard);
                        $("#PrivilegeName").text(data[0].PrivalageCardName);
                    }
                }
                else {


                    $("#divgp").show();
                    $("#TPA").prop('checked', false);
                    $("#General").prop('checked', true);

                    $("#TPAName").val('');
                    $("#TPAID").val(0);
                    $("#serviceGorup").show();

                    if (data[0].PrivalageCard == true) {
                        $("#chkPrivilege").prop('checked', data[0].PrivalageCard);
                        $("#PrivilegeName").text(data[0].PrivalageCardName);
                    }
                }

                if (selValue2 == 1 || selValue2 == 3) {
                    debugger
                    AutoBindService();

                }
                var selValue = $('input[name=RadioChargee]:checked').val();
                $("#radio_chargee_id_hid").val(selValue);
                // $("#discount").prop('disabled', true);
                debugger
                $('#responsivefinalsummary1 tr').remove();
                if (selValue == '3') {
                    $.each(data[0].Services, function (i, billsitem) {
                        debugger

                        $('#responsivefinalsummary1').append('<tr ><td>' + billsitem.SvcName + '</td><td>' + billsitem.Rate + '</td><td>' + billsitem.Quantity + '</td>  <td>' + billsitem.DiscountServiceType + '</td> <td>' + billsitem.Discount_Service + '</td>   <td class="">' + parseFloat(billsitem.Quantity) * parseFloat(billsitem.Rate) + '</td><td>' + billsitem.DoctorName + '</td><td> <button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button></tr>');
                        //  $('#datatable-responsive tbody').append('<tr class=".hidd"><td>' + billsitem.SvcName + '<input value="' + billsitem.SvcID + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + billsitem.SvcName + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + billsitem.DoctorID + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="1" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + billsitem.Rate + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + billsitem.Quantity + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="text" value=' + billsitem.Rate + '></td><td><input id="txt_tbl_qty" class="form-control" type="text" value=' + billsitem.Quantity + '></td>  <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"> <option value=' + billsitem.DiscountServiceType + '>' + billsitem.DiscountServiceType + '</option><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value=' + billsitem.Discount_Service + ' class="nr form-control" type="text" id="Discount_Service" name="Discount_Service" /></td>   <td class="total">' + billsitem.Quantity * billsitem.Rate + '</td><td style="display:none"><input value="' + billsitem.Quantity * billsitem.Rate + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td><select class="fstdropdown-select DoctorPrintNamedgv form-control"><select></td><td> <button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input value=' + billsitem.ServiceType + ' type="hidden" id="ServiceType" name="ServiceType" /><input type="hidden" name="Mode" value="Edit"/><input type="hidden" value="' + billsitem.Doctorcharges + '" name="Doctorcharges"/> <input type="hidden" name="UnitID1" value="' + billsitem.UnitID + '"></td></tr>');


                    })
                }
                // BindDr();
                if (selValue == '3' || selValue == '2') {

                    debugger
                    // $("#discount").prop('disabled', false);
                    $.each(data[0].Services, function (i, billsitem) {
                        debugger
                        //    $('#responsivefinalsummary tbody').append('<tr ><td>' + billsitem.SvcName + '</td><td>' + billsitem.Rate + '</td><td>' + billsitem.Quantity + '</td>  <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"> <option value=' + billsitem.DiscountServiceType + '>' + billsitem.DiscountServiceType + '</option><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value=' + billsitem.Discount_Service + ' class="nr form-control" type="text" id="Discount_Service" name="Discount_Service" /></td>   <td class="total">' + billsitem.Quantity * billsitem.Rate + '</td><td style="display:none"><input value="' + billsitem.Quantity * billsitem.Rate + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td><select class="fstdropdown-select DoctorPrintNamedgv form-control"><select></td><td> <button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input value=' + billsitem.ServiceType + ' type="hidden" id="ServiceType" name="ServiceType" /><input type="hidden" name="Mode" value="Edit"/><input type="hidden" value="' + billsitem.Doctorcharges + '" name="Doctorcharges"/> <input type="hidden" name="UnitID1" value="' + billsitem.UnitID + '"></td></tr>');

                        if (selValue == '2') {

                            if (billsitem.SvcName != "") {
                                //provi
                                $('#datatable-responsive tbody').append('<tr class=".hidd"><td>' + billsitem.SvcName + '<input value="' + billsitem.SvcID + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + billsitem.SvcName + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + billsitem.DoctorID + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="1" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + billsitem.Rate + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + billsitem.Quantity + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="text" value=' + billsitem.Rate + '></td><td><input id="txt_tbl_qty" class="form-control" type="text" value=' + billsitem.Quantity + '></td>  <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"> <option value=' + billsitem.DiscountServiceType + '>' + billsitem.DiscountServiceType + '</option><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value=' + billsitem.Discount_Service + ' class="nr form-control" type="text" id="Discount_Service" name="Discount_Service" /></td>   <td class="total">' + billsitem.Quantity * billsitem.Rate + '</td><td style="display:none"><input value="' + billsitem.Quantity * billsitem.Rate + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td style=" display: flex;"><input type="text" name="doctorID" id="doctorID" placeholder="Doctor ID.."><select class="fstdropdown-select DoctorPrintNamedgv form-control"><select></td><td> <button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input value=' + billsitem.ServiceType + ' type="hidden" id="ServiceType" name="ServiceType" /><input type="hidden" name="Mode" value="Edit"/><input type="hidden" value="' + billsitem.Doctorcharges + '" name="Doctorcharges"/> <input type="hidden" name="UnitID1" value="' + billsitem.UnitID + '"><input type="hidden" name="Authorization" value="0"></td></tr>');

                            }


                            // $('#datatable-responsive #tbldel').prop("disabled", true);

                            //   $('#datatable-responsive #DiscountServiceType').prop("disabled", true);
                            //$('#datatable-responsive input[type="text"]').prop("disabled", true);
                            // $(".hidd").prop('readonly', true);
                            // $('.hidd').prop("readonly", true);
                        }
                        if (selValue == '3') {
                            //  $('#datatable-responsive tbody td').remove();

                        }

                    });
                    debugger
                    BindDr();
                    if (selValue == '2') {

                        $("#amtpaid").val(data[0].PaidAmountProvisnal);
                      
                        

                    }

                    var sum = 0;

                    $(".total").each(function () {
                        var sevicedisAmt = $(this).parent().find('#sevicedisAmt').val();
                        var rate = $(this).parent().find('#txt_tbl_rate').val();
                        var qty = $(this).parent().find('#txt_tbl_qty').val();
                        $(this).parent().find('#svc_rate_hid').val(rate);
                        $(this).parent().find('#svc_qty_hid').val(qty);

                        var tot2 = parseFloat(rate) * parseFloat(qty) - parseFloat(sevicedisAmt);;
                        $(this).text(tot2);

                        var value = $(this).text();
                        $(this).parent().find('#tot_hid').val(tot2);
                        if (!isNaN(value) && value.length != 0) {
                            sum += parseFloat(0);
                        }

                        if (selValue == '3') {
                            sum += parseFloat(0);
                            // $("#svc_add_btn").attr('disabled', true);
                            $("#tbldel").attr('readonly', true);
                            $('#datatable-responsive :input').attr('readonly', true);
                            //   $('#datatable-responsive :[input type="button"]').attr('readonly', true);

                        }
                        else {
                            if (selValue == '2') {
                                sum += parseFloat(value);
                                // $("#svc_add_btn").attr('disabled', true);
                                //  $("#tbldel").attr('readonly', true);
                                // $('#datatable-responsive :input').attr('readonly', true);
                                //    $('#datatable-responsive :[input type="button"]').attr('readonly', true);
                            }
                        }
                        $("#gross_total").val(sum);
                        $("#gross_total_id").val(sum);
                        var prebal = $("#pre_balance").val();
                        if (prebal == '') {
                            var tot = parseInt(sum);
                        }
                        else {
                            var tot = parseInt(sum) + parseInt(prebal);
                        }

                        $("#total_amount").val(tot);
                        $("#total_amount_id").val(tot);

                        if ($('#disc_amount').val() == '') {
                            var net = parseInt(tot) - parseInt(0);
                            $("#netpayable").val(tot);
                            $("#netpayable_id").val(net);
                        }
                        else {
                            var disc = $('#disc_amount').val();
                            var tot = $("#total_amount").val();

                            var net = parseInt(tot) - parseInt(disc);
                            $("#netpayable").val(net);
                            $("#netpayable_id").val(net);
                        }

                    });


                }
                else {
                    var balamountidtext = parseInt(0);
                    $("#amtpaid").val('0')
                    $("#bal_amount").val('0')
                    $("#bal_amount_id").val(balamountidtext);

                }

                // $("input[name=RadioChargee]").attr('disabled', true);

                ///////////////////////


                $("#admit_date").val(data[0].AddmDate);
                $("#admit_time").val(data[0].AddmTime);

                $("#amtpaid").val(0);

                $("#pre_balance").val(data[0].PreBalance);


                if (parseFloat(data[0].PreBalance) < 0) {
                    //alert("Deposit");

                    $("#priPalanceDeposit").text("Deposit")

                    $("#priPalanceDeposit").css("color", "blue");

                    var repalce1 = data[0].PreBalance;

                    var pre_balance = $("#pre_balance").val().replace("-", "");
                    $("#pre_balance").val(pre_balance)

                    $("#Deposit").val(repalce1);
                    // $("#pre_balance").attr('value', Deposit);
                }
                else {
                    $("#priPalanceDeposit").text("Pre.Balance");
                    $("#priPalanceDeposit").css("color", "black");
                    $("#Deposit").val("0.00")
                }
                if (selValue == '3') {

                    //alert(data[0].PreBalance);
                    var tot = parseInt(sum) + parseInt(data[0].PreBalance);
                    //  alert('in else sum:' + sum + 'in else prebal:' + data[0].PreBalance + 'in else tot:' + tot);


                    $("#total_amount").val(tot);
                    $("#total_amount_id").val(tot);

                    if ($('#disc_amount').val() == '') {
                        var net = parseInt(tot) - parseInt(0);
                        $("#netpayable").val(tot);
                        $("#netpayable_id").val(net);
                    }
                    else {
                        var disc = $('#disc_amount').val();
                        var tot = $("#total_amount").val();

                        var net = parseInt(tot) - parseInt(disc);
                        $("#netpayable").val(net);
                        $("#netpayable_id").val(net);
                    }

                }

                if (selValue == '2') {

                    $("#amtpaid").val(data[0].PaidAmountProvisnal);

                }
                debugger
                var $dropdownoldbill = $("#old_bill_no_id");
                $dropdownoldbill.val('');
                $dropdownoldbill.text('');
                $("#OldbillView td").remove();
                $("#old_bill_no_id").append('<option value="-1">  OLD BILLS</option>');
                $('#OldbillView tbody tr').remove();
                // var jsondata = $.parseJSON(data[0].Bill);
                $.each(data[0].Bill, function (i, billsitem) {
                    debugger
                    if (i == 0) {
                        $("#old_bill_no_id").append('<option value="-2">Edit All Bill</option>');
                    }
                    // subcat += '<option value="' + item.id + '">' + item.name + '</option>';
                    $dropdownoldbill.append($("<option />").val(billsitem.BillNo).text(billsitem.BillNoDate));
                    if (parseInt($("#patientPrintBillNo").val()) == parseInt(billsitem.PrintBillNo)) {
                        debugger
                        $("#patientBillNo").val(billsitem.BillNo);
                      //  OLdBillSelect();
                        $("#old_bill_no_id").val(billsitem.BillNo);
                    }
                    $("#btndelete").prop('disabled', false);
                    if (selValue2 == 3) {

                        $("#OldbillView").append('<tr data-dismiss="modal"><td>' + $("#patient_reg_no_id").val() + '</td> <td> IPDFinalBill</td> <td> ' + billsitem.BillNoDate + '</td><td> <a href="#" id="print"><i class="fa fa-print fa-1x" aria-hidden="true"></i></a>  </td><td style="display:none">' + billsitem.BillNo + '</td></tr>')

                    }
                    if (selValue2 == 1) {

                        $("#OldbillView").append('<tr data-dismiss="modal"><td>' + $("#patient_reg_no_id").val() + '</td> <td> ' + billsitem.BillType + '</td> <td> ' + billsitem.BillNoDate + '</td><<td> <a id="print" href="#"><i class="fa fa-print fa-1x" aria-hidden="true"></i></a>  </td><td style="display:none">' + billsitem.BillNo + '</td></tr>')
                    }
                    if (selValue2 == 2) {

                        $("#OldbillView").append('<tr data-dismiss="modal"><td>' + $("#patient_reg_no_id").val() + '</td> <td>Provisional</td> <td> ' + billsitem.BillNoDate + '</td><<td> <a id="print" href="#"><i class="fa fa-print fa-1x" aria-hidden="true"></i></a>  </td><td style="display:none">' + billsitem.BillNo + '</td></tr>')
                        CaculateDescount();
                    }
                });

                $("#old_bill_no_id").prop('disabled', false);
                $("#Sectionfinal").hide();
                if (selValue2 == 3) {
                    $("#Sectionfinal").show();

                    // $("#old_bill_no_id").select().index = 1;
                    if (data[0].Bill != "") {
                      //  document.getElementById("old_bill_no_id").selectedIndex = "2";

                      //  $("#old_bill_no_id").prop('disabled', 'disabled');
                        //OLdBillSelect();
                        $("#btnSubmitid").attr('disabled', true);
                        $("#prints").show();
                        $("#datatable-responsive").attr('disabled', true);
                        // alert("Final Bill Already Exist ");
                    }
                    else {
                       // $("#btnSubmitid").attr('disabled', false);
                        $("#prints").hide();
                    }
                    //  $("#old_bill_no_id").prop('disabled', 'disabled');
                }

                if (selValue2 == 2) {

                    //  $("#pre_balance").val(0);
                   
                    calculator();
                    $("#svc_add_btn").attr('disabled', 'disabled');
                    if (data[0].Bill != "") {

                        // document.getElementById("old_bill_no_id").selectedIndex = "1";
                        // $("#btnSubmitid").attr('disabled', true);
                        $("#prints").show();
                    }
                    else {
                        $("#prints").hide();
                        $("#btnSubmitid").attr('disabled', false);

                    }
                }


                /*

            $.each(data.Bill, function () {
                $dropdownoldbill.append($("<option />").val("").text(""));
            });
            */
                debugger
                $("#pre_balance_id").val(data[0].PreBalance);
                if ($("#patientPrintBillNo").val() > 0) {

                    OLdBillSelect();
                }
                if (selValue2 == 2) {
                    $("#total_amount").val(data[0].TotalAmount);
                    $("#total_amount_id").val(data[0].TotalAmount);
                    $("#tax_amount").val(data[0].TaxAmount);
                    $("#netpayable").val(data[0].NetPayableAmount);
                    $("#netpayable_id").val(data[0].NetPayableAmount);

                    $("#bal_amount").val(data[0].BalanceAmount);
                    $("#bal_amount_id").val(data[0].BalanceAmount);
                    $("#disc_amount").val(data[0].DiscountAmount);
                    $("#disc_amount_id").val(data[0].DiscountAmount);
                    $("#disc_amount").keyup();
                    }


            }

        })
        debugger
        //alert("ddd");
        //$("#discount").attr("disabled", "disabled");
        //$("#disc_amount").attr("disabled", "disabled");
        //if (selValue2 == 3) {
        //    document.getElementById("discount").disabled = false;
        //    document.getElementById("disc_amount").disabled = false;


        //}
    }

    function BindDr() {
        debugger


        var var1 = { name: "%" }
        $.ajax({
            url: '@Url.Action("GetDoctorName", "IPDBill")',
            dataType: "json",
            type: "POST",
            data: JSON.stringify(var1),
            traditional: true,
            contentType: 'application/json',
            success: function (data) {
                $(".DoctorPrintNamedgv").append('<option value=' + 0 + '></option>');
                // $(".DoctorPrintNamedgv").append('<option value=' + $("#DoctorPrintNameID").val() + ',' + $("#DoctorPrintName").val() + '>' + $("#DoctorPrintName").val() + '</option>');
                $(data).each(function (index, i) {

                    $(".DoctorPrintNamedgv").append('<option value=' + i.DoctorID + '>' + i.DoctorName + '</option>');
                })
                debugger

                var child = $("#datatable-responsive td").closest("tr").length;
                if ($("#old_bill_no_id").val()!= "-2") {
                    var t = $("#DoctorPrintNameID").val();
                    $(".DoctorPrintNamedgv").val($("#DoctorPrintNameID").val());
                    $("#DoctorPrintNameID").val("0");
                    for (var a = 0; a < child; a++) {
                        var DoctorID = document.getElementById('datatable-responsive').tBodies[0].rows[a].cells[0].children[2].value;
                        if (DoctorID == "undefined")
                        {
                            DoctorID = 0;
                        }
                        // document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[4].innerHTML
                        if ($("#Doctor").val() != DoctorID) {
                            document.getElementById('datatable-responsive').tBodies[0].rows[a].cells[7].children[0].value = DoctorID;
                            document.getElementById('datatable-responsive').tBodies[0].rows[a].cells[7].children[1].value = DoctorID;
                            if (DoctorID == 0) {
                                document.getElementById('datatable-responsive').tBodies[0].rows[a].cells[7].children[0].value = '';
                            }
                        }
                    }
                    // $('#datatable-responsive tbody').
                }
            }
        })


    }
    $(document).ready(function () {

        $("#ServiceGroupName").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '@Url.Action("GetServiceGrp", "IPDBill")',
                    type: "POST",
                    dataType: "json",
                    data: { prefix: request.term },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return {
                                label: item.ServiceGroupName, value: item.ServiceGroupName.replace("   ( Lab )",""), id: item.ServiceGroupID, ServiceType: item.ServiceType
                            };
                        }))
                    }
                })
            },
            minlength: 1,
            select: function (event, i) {
                var show = i.item.id;
                SerGroupID = show;
                debugger
                if (i.item.ServiceType == "Lab")
                {
                    $("#rdTest").prop("checked", 'checked');
                }
                else
                {
                    $("#rdService").prop("checked", 'checked');

                }
                $("#ServiceGroupID").val(show);
                /// alert($("#ServiceGroupID").val())
                $("#servicename").val("");
                $("#ServiceID").val("");
                $("#servicename1").val("");
                $("#rate").val("");
            },


        });

        $("#ServiceCode").change(function () {
            debugger
            $("#quantity").val(0);
            $("#rate").val(0);
            $("#ServiceID").val("");
            $("#servicename1").val("")
            $("#ServiceGroupID").val("");
            $("#ServiceGroupName").val("");
            $("#servicename").val("");
            $("#Unit").val("");
            var var1 = { prefix: $("#servicename").val(), Code: $(this).val(), id: $("#ServiceGroupID").val(), chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val() }
            var URL = "";
            var var1 = "";
            if (document.getElementById("TPA").checked == true) {
                if ($('input[name=ServiceInfoChk]:checked').val() == "Service") {
                    URL = '@Url.Action("GetServiceNameTPA", "IPDBill")';
                    var1 = { prefix: $("#servicename").val(), Code: $(this).val(), id: $("#ServiceGroupID").val(), chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val(), OrganizationID: $("#TPAID").val() }
                }
                else {
                    if ($('input[name=ServiceInfoChk]:checked').val() == "Test") {
                        URL = '@Url.Action("GetServiceName", "IPDBill")';
                        var1 = { prefix: $("#servicename").val(), Code: $(this).val(), id: $("#ServiceGroupID").val(), chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val()}

                    }

                }
            }
            else {
                URL = '@Url.Action("GetServiceName", "IPDBill")';
                var1 = { prefix: $("#servicename").val(),Code: $(this).val(), id: $("#ServiceGroupID").val(), chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val() }
            }

            $.ajax({
                url: URL,
                dataType: "json",
                type: "POST",
                data: JSON.stringify(var1),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    debugger
                    if (data.length > 0) {

                        RadioCharge = $('input[name=RadioCharge]:checked').val();
                        if (data[0].BillCharges == "True") {
                            $("#quantity").val(data[0].Quantity);
                            //  $("#quantity").val(
                        }
                        else {
                            $("#quantity").val(1);
                        }
                        if (RadioCharge == "General") {
                            $("#rate").val(data[0].GeneralCharges);
                        }
                        if (RadioCharge == "Emergency") {
                            $("#rate").val(data[0].EmergencyCharges);
                        }
                        $("#ServiceID").val(data[0].ServiceID);
                        $("#servicename1").val(data[0].ServiceID)
                        $("#ServiceGroupID").val(data[0].ServiceGroupID);
                        $("#ServiceGroupName").val(data[0].ServiceGroupName);
                        $("#servicename").val(data[0].servicename)
                        $("#Unit").val(data[0].Unit);
                    }

                    else {
                        $("#quantity").val(0);
                        $("#rate").val(0);
                        $("#ServiceID").val("");
                        $("#servicename1").val("")
                        $("#ServiceGroupID").val("");
                        $("#ServiceGroupName").val("");
                        $("#servicename").val("");
                        $("#Unit").val("");
                    }
                }
            })
        })
        $("#txtdgvService").autocomplete({
            source: function (request, response) {
                var URL = "";
                var var1 = "";
                debugger
                var row_num = $("#dgvService").closest('tr').length;
                if (row_num == 0)
                {
                    document.getElementById("rdService").checked = true;

                }
                if (document.getElementById("TPA").checked == true) {
                    if ($('input[name=ServiceInfoChk]:checked').val() == "Service") {
                        URL = '@Url.Action("GetServiceNameTPA", "IPDBill")';
                        var1 = { prefix: $("#txtdgvService").val(), id: "%", chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val(), OrganizationID: $("#TPAID").val() }
                    }
                    else
                    {
                        if ($('input[name=ServiceInfoChk]:checked').val() == "Test") {
                            URL = '@Url.Action("GetServiceName", "IPDBill")';
                            var1 = { prefix: $("#txtdgvService").val(), id: $("#ServiceGroupID").val("%"), chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val() }
                        }

                    }
                }
                else {
                    URL = '@Url.Action("GetServiceName", "IPDBill")';
                    var1 = { prefix: $("#txtdgvService").val(), id: "%", chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val() }
                }
                if ($('input[name=ServiceInfoChk]:checked').val()!= "Package")
                $.ajax({
                    url: URL,
                    dataType: "json",
                    type: "POST",
                    data: JSON.stringify(var1),
                    traditional: true,
                    contentType: 'application/json',
                    success: function (data) {
                        if (document.getElementById("TPA").checked == true) {
                        response($.map(data, function (item) {
                            return {
                                label: "(" + item.ServiceGroupName + ") " + item.servicename + "    " + "    Rs  " + item.GeneralCharges, value: item.servicename, Serviceid: item.ServiceID, GenralCharge: item.GeneralCharges, EmergencyCharges: item.EmergencyCharges, ServiceQty: item.Quantity, ServceTrue: item.BillCharges, Unit: item.Unit, UnitID: item.UnitID, ServiceType: item.ServiceType
                            };
                        }));
                        }
                        else
                        {
                            response($.map(data, function (item) {
                                return {
                                    label: item.servicename + "    " + "    Rs  " + item.GeneralCharges, value: item.servicename.replace("   ( Lab )", ""), Serviceid: item.ServiceID, GenralCharge: item.GeneralCharges, EmergencyCharges: item.EmergencyCharges, ServiceQty: item.Quantity, ServceTrue: item.BillCharges, Unit: item.Unit, UnitID: item.UnitID, ServiceType: item.ServiceType
                                };
                            }))
                        }
                    }
                })
            },
            minlength: 1,
            change: function (event, i) {
                debugger
                // TestLabDetailInTPA(i.item.Serviceid)
                
                $("#txtdgvService").focus();
                var show = i.item.Serviceid;

                var show1 = i.item.value;

                RadioCharge = $('input[name=RadioCharge]:checked').val();
                $("#Unit").val(i.item.Unit);
                $("#UnitID").val(i.item.UnitID);
                if (i.item.ServceTrue == "True") {
                    $("#quantity").val(i.item.ServiceQty);
                    //  $("#quantity").val(
                }
                else {
                    $("#quantity").val(1);
                }

                if (RadioCharge == "General") {
                    $("#rate").val(i.item.GenralCharge);
                }

                $("#rate").val(i.item.GenralCharge);

                if (RadioCharge == "Emergency") {

                    $("#rate").val(i.item.EmergencyCharges);
                }

                //TPA Charge

                if (RadioCharge == "TPA") {
                    $("#rate").val(i.item.GenralCharge);
                    $("#quantity").val(i.item.ServiceQty);
                }


                //----------------
                $("#ServiceID").val(show);
                $("#servicename1").val(show1)
                $("#servicename").val($("#txtdgvService").val());

               // ServiceType
                var Text = i.item.ServiceType;





                // tbl Add
                debugger;
                //var chk = $(this).prop("checked");
                //if (chk) {
                  //  var row_num = $(this).closest('tr').index(); //parseInt($(this).parent().index());
                   // var GrpID = document.getElementById('dgvService').rows[row_num].cells[0].innerHTML;
                var rate = $("#rate").val();
                    var servicename =  $("#servicename1").val();
                    var UnitID =  $("#UnitID").val();
                    var ServiceID = i.item.Serviceid;
                  //  var r = document.getElementById("rate").value = rate.trim();

                debugger
              
                var svcnm = servicename;
                var service_name_hid = ServiceID;
               // var service_group = GrpID;
                // var UnitID = $("#UnitID").val(UnitID);

                $("#doctorAmountshow").hide();
                var test = $('input[name=ServiceInfoChk]:checked').val();
                //if (document.getElementById("TPA").checked == false) {
                //    if (test != "on") {
                //        if (service_group == null || service_group == '') {
                //            alert('Please select a ServiceGroup Name');
                //            $("#ServiceGroupName").val("");
                //            $("#servicename").val("");
                //            return false;
                //        }
                //    }
                //}
                if (service_name_hid == '') {
                    alert('Please select a Service Name');
                    $("#servicename").val("");
                    return false;
                }
                else {
                    var cons_dr_hidden =0;

                   // if (cons_dr_hidden == '') {
                    //    cons_dr_hidden = $('#consultant_dr_hid').val(0);
                   // }
                    var newsvcid = $("#service_name_hid").val();
                    var setflag = 'false';
                    var Doctorcharges = $("#drcharges").val(0);
                    $("#quantity").val("1");
                    $(".total").each(function () {
                        debugger
                        var rate = $(this).parent().find('#txt_tbl_rate').val();
                        var qty = $(this).parent().find('#txt_tbl_qty').val();
                        var svcrate = $(this).parent().find('#svc_rate_hid').val();
                        var svcqty = $(this).parent().find('#svc_qty_hid').val();
                        var total_hid = $(this).parent().find('#tot_hid').val();
                        var svcid = $(this).parent().find('#svc_hid').val();
                        var docid = $(this).parent().find('#doc_hid').val();
                        var tot2 = parseFloat(rate) * parseFloat(qty);
                        var srvname = $(this).parent().find('#doc_hid').val();
                        var service_name_hid = $(this).parent().find('#svc_nm_hid').val().trim();

                        if (servicename.trim() == service_name_hid.trim()) {
                            debugger
                            var BEd = servicename.split("--");

                            if (BEd[0].trim() == $("#WordName").val().trim()) {
                                alert("BED CHARGES Alredy Exist");
                                $("#ServiceID").val("0");
                                $("#servicename1").val("");
                                $("#servicename").val("");
                                $("#ServiceGroupID").val("0");
                                $("#ServiceGroupName").val("");
                                $("#rate").val("");
                                $("#DoctorPrintNameID").val("0");
                                $("#DoctorPrintName").val("");
                                $("#quantity").val("1");
                                $("#ServiceCode").val("");
                                $("#Unit").val("");
                                $("#UnitID").val("");
                                service_name_hid = "";
                                return false;

                            }
                            else {

                                $(this).parent().find('#txt_tbl_qty').val(parseFloat($(this).parent().find('#txt_tbl_qty').val()) + (1));
                                $(this).parent().find('input[name=Authorization]').val(1);
                                servicename = 0;
                                billNo = 0;
                                return false;
                            }
                        }
                    });

                    if (setflag == 'false') {




                        var chk = $('input[name=ServiceInfoChk]:checked').val();

                        var ServiceType = "";
                        if (chk == "Service") {

                            ServiceType = "IPD";
                            var selValue2 = $('input[name=RadioChargee]:checked').val();
                            if (selValue2 == "3") {
                                ServiceType = "IPDFinalBill";
                            }
                        }

                        if (chk == "Test" || Text == "Lab") {

                            ServiceType = "IPDLabBills";

                            var selValue2 = $('input[name=RadioChargee]:checked').val();
                            if (selValue2 == "3") {
                                ServiceType = "IPDLabFinalBill";
                            }
                        }

                        if (chk == "Package") {

                            ServiceType = "IPDPackageBills";

                            //     var selValue2 = $('input[name=RadioChargee]:checked').val();
                            //if (selValue2 == "3") {
                            //    ServiceType = "IPDLabFinalBill";
                            //}
                        }
                        debugger
                        if ($("#ServiceID").val() > 0) {
                            if ($("#old_bill_no_id").val() == -2) {

                                // $("#15 tr").remove();

                                debugger
                                var billNo = $("input[name='chkIPDBill']:checked").val();
                                if (billNo > 0) {
                                    if (servicename != 0) {
                                        $('#datatable-responsive > tbody > tr').eq(rowEditAll).after('<tr><td>' + $("#servicename").val() + " " + $("#DoctorPrintName").val() + " " + ' <input value="' + $("#ServiceID").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#servicename").val() + " " + $("#DoctorPrintName").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + $("#Unit").val() + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="number" value=' + $("#rate").val() + '></td><td><input id="txt_tbl_qty" class="form-control" type="number" value=' + parseInt($("#quantity").val()) + '></td> <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value="0" class="nr form-control" type="number" id="Discount_Service" name="Discount_Service" /></td><td class= "total  ' + billNo + '">' + $("#quantity").val() * $("#rate").val() + '</td><td style="display:none"><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/><td style=" display: flex;"><input type="text" name="doctorID" id="doctorID"  placeholder="Doctor ID.."><select class="fstdropdown-select DoctorPrintNamedgv form-control" ></select></td></td><td><button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" class="finalbill" name="ServiceType" /><input type="hidden" name="UnitID1" value="' + UnitID + '"><input type="hidden" id="tblIPDBill" name="tblIPDBill" value=' + billNo + '><input type="hidden" id="Authorization" name="Authorization" value="1"> </td></td>');
                                        BindDr();
                                    }
                                }
                                else {
                                    alert("Select Bill Number..")
                                    return false;
                                }
                                //  alert($('input[name=chkIPDBill]:checked').val());

                            }
                            else {
                                if (servicename != 0) {
                                    if (ServiceType == "IPDPackageBills") {
                                        GetAllPackageServiceWise(ServiceType);

                                    }
                                    else {
                                        $('#datatable-responsive tbody').append('<tr><td>' + $("#txtdgvService").val() + " " + $("#DoctorPrintName").val() + " " + ' <input value="' + $("#ServiceID").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#txtdgvService").val() + " " + $("#DoctorPrintName").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + UnitID + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td><input id="txt_tbl_rate" placeholder="0" class="form-control" type="number" value=' + $("#rate").val() + '></td><td><input id="txt_tbl_qty" class="form-control" type="number" placeholder="0" value=' + parseInt($("#quantity").val()) + '></td> <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value="0" placeholder="0" class="nr form-control" type="number" id="Discount_Service" name="Discount_Service" /></td><td class="total">' + $("#quantity").val() * $("#rate").val() + '</td><td style="display:none"><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td  style="display:flex;"><input type="text" name="doctorID" id="doctorID"  placeholder="Doctor ID.."><select class="fstdropdown-select DoctorPrintNamedgv form-control" ></select></td><td><button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" class="finalbill" name="ServiceType" /><input type="hidden" name="UnitID1" value="' + UnitID + '"> <input type="hidden"  id="Authorization" name="Authorization" value="1"></td></td></tr>');

                                    }
                                    $("#txtdgvService").val('');
                                    BindDr();
                                    //TableDefaltZerovalue();
                                }
                            }
                        }
                        var m = 0;
                        //$(".finalbill").each(function () {
                        //    debugger
                        //    var selValue2 = $('input[name=RadioChargee]:checked').val();

                        //        if (selValue2 == "3") {

                        //            var rate = $(this).parent().find('#txt_tbl_rate').val();
                        //            var qty = $(this).parent().find('#txt_tbl_qty').val();
                        //            var svcrate = $(this).parent().find('#svc_rate_hid').val();
                        //            var svcqty = $(this).parent().find('#svc_qty_hid').val();
                        //            var total_hid = $(this).parent().find('#tot_hid').val();
                        //            var svcid = $(this).parent().find('#svc_hid').val();
                        //            var docid = $(this).parent().find('#doc_hid').val();
                        //            var tot2 = parseFloat(rate) * parseFloat(qty);
                        //        }

                        //});


                        // $('#datatable-responsive tbody').append('<tr><td>' + $("#service_name").val() + ' ' + $("#cons_dr").val() + '<input value="' + $("#service_name_hid").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#service_name").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + $("#unit_hid").val() + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="text" value=' + $("#rate").val() + '></td><td><input id="txt_tbl_qty" class="form-control" type="text" value=' + parseInt($("#quantity").val()) + '></td><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><td class="total">' + $("#quantity").val() * $("#rate").val() + '</td><td><button type="button" id="tbldel" class="btn btn-default" onclick="RemoveSvcTable(this)">Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" name="ServiceType" /></td></td></tr>');
                        $("#ServiceID").val("0");
                        $("#servicename1").val("");
                        $("#servicename").val("");
                        $("#ServiceGroupID").val("0");
                        $("#ServiceGroupName").val("");
                        $("#rate").val("");
                        $("#DoctorPrintNameID").val("0");
                        $("#DoctorPrintName").val("");
                        $("#quantity").val("1");
                        $("#ServiceCode").val("");
                        $("#Unit").val("");
                        $("#UnitID").val("");
                    }

                    var sum = 0;
                    // iterate through each td based on class and add the values
                    $(".total").each(function () {

                        var value = $(this).text();
                        // add only if the value is number
                        if (!isNaN(value) && value.length != 0) {
                            sum += parseFloat(value);
                        }
                    });

                    $("#gross_total").val(sum);
                    $("#gross_total_id").val(sum);
                    var prebal = $("#pre_balance").val();
                    debugger
                    var name = $("#priPalanceDeposit").text();
                    if ($("#priPalanceDeposit").text() == "Pre.Balance") {
                        var tot = parseInt(sum) + parseInt(prebal);
                    }
                    else {
                        var tot = parseInt(sum) - parseInt(prebal);
                    }

                    $("#total_amount").val(tot);
                    $("#total_amount_id").val(tot);

                    if ($('#disc_amount').val() == '') {
                        var net = parseInt(tot) - parseInt(0);
                        $("#netpayable").val(tot);
                        $("#netpayable_id").val(net);
                    }
                    else {
                        var disc = $('#disc_amount').val();
                        var tot = $("#total_amount").val();

                        var net = parseInt(tot) - parseInt(disc);
                        $("#netpayable").val(net);
                        $("#netpayable_id").val(net);
                    }
                    var disc = $('#netpayable').val();
                    var amtpaid = $("#amtpaid").val();

                    var bal = parseInt(disc) - parseInt(amtpaid);
                    $("#bal_amount").val(bal);
                    $("#bal_amount_id").val(bal);
                    $("#amtpaid_id").val(amtpaid);

                    CaculateDescount();



                }





                //---------



















                //   $("#service_name_hid").val(show);
                $("#DoctorPrintName").autocomplete({
                    source: function (request, response) {
                        var var1 = { name: $("#DoctorPrintName").val() }
                        $.ajax({
                            url: '@Url.Action("GetDoctorName", "IPDBill")',
                            dataType: "json",
                            type: "POST",
                            data: JSON.stringify(var1),
                            traditional: true,
                            contentType: 'application/json',
                            success: function (data) {
                                response($.map(data, function (item) {
                                    return {
                                        label: item.DoctorName, value: item.DoctorName, DoctorID: item.DoctorID
                                    };
                                }));
                            }
                        })
                    },
                    minlength: 1,
                    select: function (event, i) {
                        var show = i.item.DoctorID;
                        $("#DoctorPrintNameID").val(show);
                        //$("#DoctorPrintNameID").val(show);

                        if (show > 0) {
                            $("#doctorAmountshow").show();
                        }
                        else {
                            $("#doctorAmountshow").hide();
                        }
                    },
                });
            },
        });



    })

    function TestLabDetailInTPA(ServiceID) {
        debugger
        $.ajax({
            url: '@Url.Action("GetPatientLabBillsForTestMaster", "IPDBill")',
            dataType: "json",
            type: "GET",
            data: { ServiceID: ServiceID, OrganizationID: $("#TPAID").val(), WordID: $("#ward_name_hid").val() },

            success: function (data) {
                debugger
                if (RadioCharge == "General") {
                    $("#rate").val(data.GenralCharge);
                }

                if (RadioCharge == "Emergency") {

                    $("#rate").val(data.EmergencyCharges);
                }
            }
        })
        return false;
    }

    $(document).ready(function () {
        $("input[type=text],input[type=number] ,hidden").val("");
        var RadioCharge = "";

        var Charges = "";
        $(".radio").click(function () {

            RadioCharge = $('input[name=RadioCharge]:checked').val();
        })

        $("input[name=ServiceInfoChk]").click(function () {
            $("#ServiceID").val("0");
            $("#servicename1").val("");
            $("#servicename").val("");
            $("#ServiceGroupID").val("0");
            $("#ServiceGroupName").val("");
            $("#rate").val("");
            $("#DoctorPrintNameID").val("0");
            $("#DoctorPrintName").val("");
            $("#quantity").val("1");
            $("#ServiceCode").val("");
            if ($(this).val() == "Test" || $(this).val() == "Package") {
                $("#serviceGorup").hide();
                $("#ServiceGroupID").val(0)

            }
            else {
                $("#serviceGorup").show();
            }
            if ($('input[name=RadioCharge]:checked').val() == "TPA"  ) {
                $("#serviceGorup").hide();
            }

        })
        //   RadioCharge = $('input[name=RadioCharge]:checked').val();
        $("#priPalanceDeposit").click(function () {


            var a = $("#patient_ipd_no_id").text().trim();
            if ($("#priPalanceDeposit").text().trim() != "Pre. Balance" && $("#priPalanceDeposit").text().trim() != "Pre.Balance") {

                var IPDNo = $("#patient_ipd_no_id").val().trim() + "," + "IPD";
                window.open('@Url.Action("PaymentAndDeposit", "PaymentAndDeposit")?IPDNo=' + IPDNo);
                @*if ('@TempData["Reg"]' != "") {


                        window.location.href = '@Url.Action("PaymentAndDeposit", "PaymentAndDeposit",new{Reg=TempData["Reg"]})'
                    }*@
            }

        })




    var chk = false;
    function myFunction() {
        debugger

        debugger
        if (chk == "True") {
            var con = confirm("Send For Authorization Confirmation");
            if (con) {
                var person = prompt("Reason For Authorization");
                if (person) {
                    $("#txtinput").val(person);
                    $("#ForAuthorization").val(1);
                    return true;
                }
                else {
                    $("#ForAuthorization").val(0);
                    $("#txtinput").val('');
                    return false;
                }
            }
            else {
                return false;
            }
        }
        else {
            return true;
        }

    }


        $('#form').on('submit', function (e) {
            debugger

            var r = myFunction();
            if (r) {
                return true;
            }
            else {
                return false;
            }
        })
        $("#old_bill_no_id").change(function () {
            debugger
         //   btn btn-app
            $("#save").removeClass('Edit');
            if ($(this).val() > 0) {
                $("#save").addClass('Edit');
                $.ajax({
                    //url: "/OPDBill/GetServiceGrp",
                    url: '@Url.Action("chkAurthorise", "OPDBill")',
                    type: "POST",
                    dataType: "json",
                    data: { prefix:$(this).val() },
                    success: function (data) {
                        debugger
                        // alert(data[0]);
                        $('.Edit').prop('title', '');
                        if (data[0] == "True") {
                            chk = false;
                            $('.Edit').prop("disabled", true);
                            alert("Previous Amount Not Authorized..");
                            $('.Edit').prop('title', 'Previous Amount Not Authorized');

                        }
                        if (data[1] == "True") {
                            chk = false;
                        }

                    }
                })
            }
            else {
                chk = false;
            }
        })
        //var len=0
        //$("#GuardianName").change(function () {
        //    debugger
        //    alert("sdf")
        //    len = $(this).val().length;
        //    var value = $(this).val();
        //    for(var a=0; a<len;a++)
        //    {
        //        var sample = [];
        //        sample.push($(this).val());
        //    }
        //})


        //var chk = false;
        //function myFunction() {
        //    debugger

        //    debugger
        //    if (chk == "True") {
        //        var con = confirm("Send For Authorization Confirmation");
        //        if (con) {
        //            var person = prompt("Reason For Authorization");
        //            if (person) {
        //                $("#txtinput").val(person);
        //                $("#ForAuthorization").val(1);
        //                return true;
        //            }
        //            else {
        //                $("#ForAuthorization").val(0);
        //                $("#txtinput").val('');
        //                return false;
        //            }
        //        }
        //        else {
        //            return false;
        //        }
        //    }
        //    else {
        //        return true;
        //    }

        //}

        $("#btndelete").click(function () {

            var conform = confirm("Do you Want To Delete");
            if (conform) {
                debugger
                 var r = myFunction();
                $.ajax({
                    url: '@Url.Action("Delete", "IPDBill")',
                    type: 'POST',
                    data: { PatientRegNO: $("#patient_reg_no_id").val(), BillNo: $("#old_bill_no_id").val(), txtinput :$("#txtinput").val()},
                    success: function (data) {

                        if (data.length > 1) {
                            alert("Delete Successfully");

                            // changePatientbind();
                            Restore();
                            $("#datatable-responsive td").remove();
                        }
                    }
                })


            }
        });



        $('#old_bill_no_id').change(function () {
            debugger
            if ($(this).val() == "-2") {
                $("#tblbill tr").remove();
                OLDBillEditToAll(0);
                // AutoBindService();
                BindDr();
                $("#pre_balance_id").val(0);
                $("#pre_balance").val(0);
                $("#Deposit").val(0);
                $("#bal_amount").val(0);
                $("#bal_amount_id").val(0);
            }
            else {
                OLdBillSelect();

            }
        })
        debugger

        var rowEditAll = 0;
        $('form').on('submit', function (e) {
            debugger
            var row = $("#datatable-responsive td").closest("tr").length;
            if (row == 0)
            {
                var RadioCharge = $('input[name=RadioChargee]:checked').val();
                if (RadioCharge!="3")
                {
                    alert("Please Add Services");
                    return false;
                }
            }
            if($("#disc_amount_id").val() > 0 )
            {
                if ($("#disc_reason").val() =="")
                {
                    var RadioCharge = $('input[name=RadioChargee]:checked').val();
                    if (RadioCharge != "2") {
                        alert("Discount Reason Cannot be empty");
                        return false;
                    }
                }
            }
            $('input,select,textarea').prop("disabled", false);
        })
        var rowEditAll = 0;
        $("#datatable-responsive").on('change', '#chkIPDBill', function (e) {
            debugger
            // var aaaa =$("#datatable-responsive tr").not("thead tr").index();
            var aaaa = $(this).closest('tr').not("tr th").index();
            var $tr = $(this).closest('th');
            rowEditAll = $(this).closest('tr').index(); //parseInt($tr.index()) + parseInt(1);

            var BillNo = $(this).val();


            OLDBillEditToAll($(this).val());
            debugger

            $(".total,.total1").removeClass("total").addClass("total1");
            //$(".total").removeClass("total").addClass("total1");

            $("." + $(this).val()).each(function () {
                debugger
                var aa = $(this).attr('class').replace("total1", "");
                if (BillNo == aa.trim())
                {
                    debugger
                    $(this).removeClass("total1").addClass("total");
                    //$(this).parent().find('input').prop("disabled", false);
                }
            })
            debugger
            $(".total1").each(function () {
                //  $(this).parent().find('input').prop("disabled", "disabled");
                debugger

                $(this).parent().find('#txt_tbl_rate').prop("disabled", "disabled");
                $(this).parent().find('#txt_tbl_qty').prop("disabled", "disabled");
                $(this).parent().find('#DiscountServiceType').prop("disabled", "disabled");
                $(this).parent().find('#Discount_Service').prop("disabled", "disabled");
                $(this).parent().find('#tbldel').prop("disabled", "disabled");

                // $("input").prop('disabled', true);
            })


            $(".total").each(function () {
                //    //  $(this).parent().find('input').prop("disabled", "disabled");
                //    debugger
                debugger
                //  $(this).find('input,select,textarea').attr("readonly", true);
                //grid
                var row = $(this).closest('tr').index();
                var DoctorID = document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[0].children[2].value;

                // document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[4].innerHTML

                document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[7].children[0].value = DoctorID;

                $(this).parent().find('#txt_tbl_rate').prop("disabled", false);
                $(this).parent().find('#txt_tbl_qty').prop("disabled", false);
                $(this).parent().find('#DiscountServiceType').prop("disabled", false);
                $(this).parent().find('#Discount_Service').prop("disabled", false);
                $(this).parent().find('#tbldel').prop("disabled", false);
                var DoctorID = $(this).parent().find('#doc_hid').val();
                $(this).parent().find('#DoctorPrintNamedgv').val(DoctorID);

            })

        })


        $("#svc_add_btn").on('click', function () {
            debugger
            //$("#drtable").css('display', 'none');
            if (flagfinal == "true" && $("#old_bill_no_id").val() == "-1")
            {
                alert("Final Bill Already Generated Select Old Bill No");
                $("#ServiceID").val("0");
                $("#servicename1").val("");
                $("#servicename").val("");
                $("#ServiceGroupID").val("0");
                $("#ServiceGroupName").val("");
                $("#rate").val("");
                $("#DoctorPrintNameID").val("0");
                $("#DoctorPrintName").val("");
                $("#quantity").val("1");
                $("#ServiceCode").val("");
                $("#Unit").val("");
                $("#UnitID").val("");
                service_name_hid = "";
                return false;

            }
            var svcnm = $("#servicename").val();
            var service_name_hid = $("#ServiceID").val();
            var service_group = $("#ServiceGroupID").val();
            var UnitID = $("#UnitID").val();

            $("#doctorAmountshow").hide();
            var test = $('input[name=ServiceInfoChk]:checked').val();
            if (document.getElementById("TPA").checked == false) {
                if (test != "on") {
                    if (service_group == null || service_group == '') {
                        alert('Please select a ServiceGroup Name');
                        $("#ServiceGroupName").val("");
                        $("#servicename").val("");
                        return false;
                    }
                }
            }
            if (service_name_hid == '') {
                alert('Please select a Service Name');
                $("#servicename").val("");
                return false;
            }
            else {

                var cons_dr_hidden = $('#DoctorPrintNameID').val();

                if ($('#DoctorPrintName').val() == '') {

                    cons_dr_hidden = $('#consultant_dr_hid').val();
                }
                var newsvcid = $("#service_name_hid").val();
                var setflag = 'false';
                var Doctorcharges = $("#drcharges").val();

                $(".total").each(function () {
                    debugger
                    var rate = $(this).parent().find('#txt_tbl_rate').val();
                    var qty = $(this).parent().find('#txt_tbl_qty').val();
                    var svcrate = $(this).parent().find('#svc_rate_hid').val();
                    var svcqty = $(this).parent().find('#svc_qty_hid').val();
                    var total_hid = $(this).parent().find('#tot_hid').val();
                    var svcid = $(this).parent().find('#svc_hid').val();
                    var docid = $(this).parent().find('#doc_hid').val();
                    var tot2 = parseFloat(rate) * parseFloat(qty);
                    var srvname = $(this).parent().find('#doc_hid').val();
                    var service_name_hid = $(this).parent().find('#svc_nm_hid').val().trim();

                    if ($("#servicename").val().trim() == service_name_hid.trim()) {
                        debugger
                        var BEd = $("#servicename").val().split("--");

                        if (BEd[0].trim() == $("#WordName").val().trim()) {
                            alert("BED CHARGES Alredy Exist");
                            $("#ServiceID").val("0");
                            $("#servicename1").val("");
                            $("#servicename").val("");
                            $("#ServiceGroupID").val("0");
                            $("#ServiceGroupName").val("");
                            $("#rate").val("");
                            $("#DoctorPrintNameID").val("0");
                            $("#DoctorPrintName").val("");
                            $("#quantity").val("1");
                            $("#ServiceCode").val("");
                            $("#Unit").val("");
                            $("#UnitID").val("");
                            service_name_hid = "";
                            return false;

                        }
                        else {

                            $(this).parent().find('#txt_tbl_qty').val(parseFloat($(this).parent().find('#txt_tbl_qty').val()) + (1));
                            service_name_hid = 0;
                            return false;
                        }
                    }
                });

                if (setflag == 'false') {




                    var chk = $('input[name=ServiceInfoChk]:checked').val();

                    var ServiceType = "";
                    if (chk == "Service") {

                        ServiceType = "IPD";
                        var selValue2 = $('input[name=RadioChargee]:checked').val();
                        if (selValue2 == "3") {
                            ServiceType = "IPDFinalBill";
                        }
                    }

                    if (chk == "Test") {

                        ServiceType = "IPDLabBills";

                        var selValue2 = $('input[name=RadioChargee]:checked').val();
                        if (selValue2 == "3") {
                            ServiceType = "IPDLabFinalBill";
                        }
                    }

                    if (chk == "Package") {

                        ServiceType = "IPDPackageBills";


                        //     var selValue2 = $('input[name=RadioChargee]:checked').val();
                        //if (selValue2 == "3") {
                        //    ServiceType = "IPDLabFinalBill";
                        //}
                    }
                    debugger
                    if ($("#ServiceID").val() > 0) {
                        if ($("#old_bill_no_id").val() == -2) {

                            // $("#15 tr").remove();

                            debugger
                            var billNo = $("input[name='chkIPDBill']:checked").val();
                            if (billNo > 0)
                            {
                                $('#datatable-responsive > tbody > tr').eq(rowEditAll).after('<tr><td>' + $("#servicename").val() + " " + $("#DoctorPrintName").val() + " " + ' <input value="' + $("#ServiceID").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#servicename").val() + " " + $("#DoctorPrintName").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="text" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + $("#Unit").val() + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="number" value=' + $("#rate").val() + '></td><td><input id="txt_tbl_qty" class="form-control" type="number" value=' + parseInt($("#quantity").val()) + '></td> <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value="0" class="nr form-control" type="number" id="Discount_Service" name="Discount_Service" /></td><td class= "total  ' + billNo + '">' + $("#quantity").val() * $("#rate").val() + '</td><td style="display:none"><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td><select class="fstdropdown-select fstdropdown-select DoctorPrintNamedgv form-control"></select> </td><td><button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" class="finalbill" name="ServiceType" /><input type="hidden" name="UnitID1" value="' + UnitID + '"><input type="hidden" id="tblIPDBill" name="tblIPDBill" value=' + billNo + '> </td></td>');
                                //    BindDr();
                            }
                            else
                            {
                                alert("Select Bill Number..")
                                return false;
                            }
                            //  alert($('input[name=chkIPDBill]:checked').val());

                        }
                        else {
                            if (ServiceType == "IPDPackageBills") {
                                GetAllPackageServiceWise(ServiceType);
                            }
                            else
                            {
                                $('#datatable-responsive tbody').append('<tr><td>' + $("#servicename").val() + " " + $("#DoctorPrintName").val() + " " + ' <input value="' + $("#ServiceID").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#servicename").val() + " " + $("#DoctorPrintName").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="text" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + $("#Unit").val() + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="number" value=' + $("#rate").val() + '></td><td><input id="txt_tbl_qty" class="form-control" type="number" value=' + parseInt($("#quantity").val()) + '></td> <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value="0" class="nr form-control" type="number" id="Discount_Service" name="Discount_Service" /></td><td class="total">' + $("#quantity").val() * $("#rate").val() + '</td><td style="display:none"><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td><select class="fstdropdown-select DoctorPrintNamedgv form-control"></select></td><td><button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" class="finalbill" name="ServiceType" /><input type="hidden" name="UnitID1" value="' + UnitID + '"> </td></td></tr>');

                            }

                            BindDr();

                            debugger
                            $(".DoctorPrintNamedgv").val($("#DoctorPrintNameID").val());

                        }

                    }
                    var m = 0;
                    //$(".finalbill").each(function () {
                    //    debugger
                    //    var selValue2 = $('input[name=RadioChargee]:checked').val();

                    //        if (selValue2 == "3") {

                    //            var rate = $(this).parent().find('#txt_tbl_rate').val();
                    //            var qty = $(this).parent().find('#txt_tbl_qty').val();
                    //            var svcrate = $(this).parent().find('#svc_rate_hid').val();
                    //            var svcqty = $(this).parent().find('#svc_qty_hid').val();
                    //            var total_hid = $(this).parent().find('#tot_hid').val();
                    //            var svcid = $(this).parent().find('#svc_hid').val();
                    //            var docid = $(this).parent().find('#doc_hid').val();
                    //            var tot2 = parseFloat(rate) * parseFloat(qty);
                    //        }

                    //});


                    // $('#datatable-responsive tbody').append('<tr><td>' + $("#service_name").val() + ' ' + $("#cons_dr").val() + '<input value="' + $("#service_name_hid").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#service_name").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + $("#unit_hid").val() + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="text" value=' + $("#rate").val() + '></td><td><input id="txt_tbl_qty" class="form-control" type="text" value=' + parseInt($("#quantity").val()) + '></td><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><td class="total">' + $("#quantity").val() * $("#rate").val() + '</td><td><button type="button" id="tbldel" class="btn btn-default" onclick="RemoveSvcTable(this)">Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" name="ServiceType" /></td></td></tr>');
                    $("#ServiceID").val("0");
                    $("#servicename1").val("");
                    $("#servicename").val("");
                    $("#ServiceGroupID").val("0");
                    $("#ServiceGroupName").val("");
                    $("#rate").val("");
                    // $("#DoctorPrintNameID").val("0");
                    $("#DoctorPrintName").val("");
                    $("#quantity").val("1");
                    $("#ServiceCode").val("");
                    $("#Unit").val("");
                    $("#UnitID").val("");
                }

                var sum = 0;
                // iterate through each td based on class and add the values
                $(".total").each(function () {

                    var value = $(this).text();
                    // add only if the value is number
                    if (!isNaN(value) && value.length != 0) {
                        sum += parseFloat(value);
                    }
                });

                $("#gross_total").val(sum);
                $("#gross_total_id").val(sum);
                var prebal = $("#pre_balance").val();
                debugger
                var name = $("#priPalanceDeposit").text();
                if ($("#priPalanceDeposit").text() == "Pre.Balance") {
                    var tot = parseInt(sum) + parseInt(prebal);
                }
                else {
                    var tot = parseInt(sum) - parseInt(prebal);
                }

                $("#total_amount").val(tot);
                $("#total_amount_id").val(tot);

                if ($('#disc_amount').val() == '') {
                    var net = parseInt(tot) - parseInt(0);
                    $("#netpayable").val(tot);
                    $("#netpayable_id").val(net);
                }
                else {
                    var disc = $('#disc_amount').val();
                    var tot = $("#total_amount").val();

                    var net = parseInt(tot) - parseInt(disc);
                    $("#netpayable").val(net);
                    $("#netpayable_id").val(net);
                }
                var disc = $('#netpayable').val();
                var amtpaid = $("#amtpaid").val();

                var bal = parseInt(disc) - parseInt(amtpaid);
                $("#bal_amount").val(bal);
                $("#bal_amount_id").val(bal);
                $("#amtpaid_id").val(amtpaid);

                CaculateDescount();

                if ($("#old_bill_no_id").val() == -2) {
                    var UserData = { BillNo: $("input[name='chkIPDBill']:checked").val(), gross_total: $("#gross_total_id").val(), pre_balance_id: $("#pre_balance_id").val(), NonMedicalExp: $("#NonMedicalExp").val(), total_amount: $("#total_amount").val(), disc_perc_id: $("#disc_perc_id").val(), disc_amount_id: $("#disc_amount_id").val(), netpayable_id: $("#netpayable_id").val(), amtpaid_id: $("#amtpaid_id").val(), bal_amount_id: $("#bal_amount_id").val() }
                    //  alert(JSON.stringify(UserData));
                    $.ajax({
                        url: '@Url.Action("GetPatientBillsForIPDNo", "IPDBill")',
                        type: 'POST',
                        data: JSON.stringify(UserData),
                        traditional: true,
                        contentType: 'application/json',
                        success: function (data) {


                        }
                    })
                }
            }

        });

        function GetAllPackageServiceWise( ServiceType) {

            //govind
            alert("govind");
            var UserData = {  ServiceID :$("#ServiceID").val(),WardID: $("#ward_name_hid").val()}
            $.ajax({
                url: '@Url.Action("GetAllPackageServiceWise", "IPDBill")',
                dataType: "json",
                type: 'POST',
                data: JSON.stringify(UserData),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    debugger
                    if (data == "Already This Packege Add")
                    {
                        alert(data);
                        return false;
                    }
                    for (var i = 0; i < data.length; i++) {
                        if (RadioCharge == "General") {
                            $("#rate").val(data[0].GenralCharge);
                        }

                        // $("#rate").val(i.item.GenralCharge);

                        if (RadioCharge == "Emergency") {

                            $("#rate").val(data[0].EmergencyCharges);
                        }

                        // $("#quantity").val(data[0].Quantity) * $("#rate").val()
                        //   data[0].EmergencyCharges

                        $('#datatable-responsive tbody').append('<tr><td>' + data[i].servicename + " " + $("#DoctorPrintName").val() + " " + ' <input value="' + data[i].ServiceID + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + data[i].servicename + " " + $("#DoctorPrintName").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="text" value="' + $('#DoctorPrintNameID').val() + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + $("#Unit").val() + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + data[i].Quantity + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="number" value=' + $("#rate").val() + '></td><td><input id="txt_tbl_qty" class="form-control" type="number" value=' + parseInt(data[i].Quantity) + '></td> <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value="0" class="nr form-control" type="number" id="Discount_Service" name="Discount_Service" /></td><td class="total">' + data[i].Quantity * $("#rate").val() + '</td><td style="display:none"><input value="' + data[i].Quantity * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td><select class="fstdropdown-select DoctorPrintNamedgv form-control"></select></td><td><button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" class="finalbill" name="ServiceType" /><input type="hidden" name="UnitID1" value="' + UnitID + '"> <input type="hidden" name="Authorization" value="1"></td></td></tr>');
                    }

                    $("#ServiceID").val("0");
                    $("#servicename1").val("");
                    $("#servicename").val("");
                    $("#ServiceGroupID").val("0");
                    $("#ServiceGroupName").val("");
                    $("#rate").val("");
                    // $("#DoctorPrintNameID").val("0");
                    $("#DoctorPrintName").val("");
                    $("#quantity").val("1");
                    $("#ServiceCode").val("");
                    $("#Unit").val("");
                    $("#UnitID").val("");
                }
            })
        }


        $("#OldbillView").delegate('td', 'click', function () {
            var row_num = parseInt($(this).parent().index());
            debugger
            //   var a = Qty;

            // var rate = document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[1].innerHTML;
            var BillNo = document.getElementById('OldbillView').tBodies[0].rows[row_num].cells[4].innerHTML;

            var BillNo = document.getElementById('OldbillView').tBodies[0].rows[row_num].cells[4].innerHTML;
            var BillType = document.getElementById('OldbillView').tBodies[0].rows[row_num].cells[1].innerHTML;
            var chkReport = document.getElementsByName("radioReports");

            var i = 0;
            for (i = 0; i < chkReport.length; i++) {
                if (chkReport[i].checked == true) {
                    chkReport = i + 1;
                }
            }

            //  $("#old_bill_no_id").val(BillNo)

            //$("#myModal").hide();
            //  OLdBillSelect();

            var UserData = { IPDNo: $("#patient_ipd_no_id").val(), BillType: BillType, BillNo: BillNo, RegNo: $("#patient_reg_no_id").val(), chkReport: chkReport }
            $.ajax({
                url: '@Url.Action("OldBillReport", "IPDBill")',
                dataType: "json",
                type: 'POST',
                data: JSON.stringify(UserData),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    debugger
                    if (BillType == " IPDBill") {
                        window.open('@Url.Action("RptPatientIPDBill", "IPDBill")');
                    }
                    if (BillType == " IPDFinalBill") {
                        window.open('@Url.Action("RptPatientIPDFinalBillsSummaryNew", "PatientReport")');
                    }

                    if (BillType == "Provisional") {
                        window.open('@Url.Action("RptPatientIPDProvisionalBills", "PatientReport")');
                    }
                }
            });
        })
        @*$("#old_bill_no_id").val(BillNo)

            //$("#myModal").hide();
            OLdBillSelect();
            $.ajax({
                url: '@Url.Action("OldBillReport", "IPDBill")',
                dataType: "json",
                type: 'POST',
                data: JSON.stringify(UserData),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {

                }
            });*@


        $("#OldbillView").on('clic1k', '#print', function (e) {
            debugger
            var row_num = e.rowIndex;

            //var row_num = $("#OldbillView td").closest("tr").parent().index();

            //   var a = Qty;

            // var rate = document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[1].innerHTML;
            var BillNo = document.getElementById('OldbillView').tBodies[0].rows[row_num].cells[4].innerHTML;
            var BillType = document.getElementById('OldbillView').tBodies[0].rows[row_num].cells[1].innerHTML;


            //  $("#old_bill_no_id").val(BillNo)

            //$("#myModal").hide();
            //  OLdBillSelect();

            var UserData = { IPDNo: $("patient_ipd_no").val(), BillType: BillType, BillNo: BillNo, RegNo: $("#patient_reg_no_id").val() }
            $.ajax({
                url: '@Url.Action("OldBillReport", "IPDBill")',
                dataType: "json",
                type: 'POST',
                data: JSON.stringify(UserData),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    window.location.href = '@Url.Action("RptPatientIPDBill", "IPDBill")';
                }
            });
        })


    });

    function OLDBillEditToAll(BillNo)
    {
        var changedText = $("#old_bill_no_id").val();
        debugger

        var selValue2 = $('input[name=RadioChargee]:checked').val();
        // if (selValue2 != 3) {
        // alert(changedText);
        if (changedText !== -2) {
            var UserData = { PatientIPDNo: $("#patient_ipd_no_id").val(), BillNo: BillNo }

            $.ajax({
                url: '@Url.Action("GetBillDetailByEditToAllIPDNo", "IPDBill")',
                dataType: "json",
                type: 'POST',
                data: JSON.stringify(UserData),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    //$("#fin_year_id").text(data[0].FinancialYear);

                    //var btnval = $("#btnSubmitid").val();
                    debugger
                    $("#btnSubmitid").val("Modify");
                    if (BillNo != 0) {
                        $("#pre_balance").val(data[0].PreBalanceAmount);
                        $("#pre_balance_id").val(data[0].PreBalanceAmount);
                        // $('#datatable-responsive tbody').append('<tr><td>' + $("#service_name").val() + '<input value="' + $("#service_name_hid").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#service_name").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + $("#unit_hid").val() + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td>' + $("#rate").val() + '</td><td>' + $("#quantity").val() + '</td><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><td class="total">' + $("#quantity").val() * $("#rate").val() + '</td></tr>');



                        //$("#pre_balance").attr('value', data[0].PreBalanceAmount);
                        debugger
                        var aaa = data[0].PreBalanceAmount;
                        if (parseFloat(data[0].PreBalanceAmount) < 0) {
                            //alert("Deposit");

                            $("#priPalanceDeposit").text("Deposit")

                            $("#priPalanceDeposit").css("color", "blue");

                            var pre_balance = $("#pre_balance").val().replace("-", "");
                            $("#pre_balance").val(pre_balance)

                            $("#Deposit").val(pre_balance);
                            // $("#pre_balance").attr('value', Deposit);
                        }
                        else {
                            $("#priPalanceDeposit").text("Pre.Balance");
                            $("#priPalanceDeposit").css("color", "black");
                            $("#Deposit").text("0.00")
                        }

                    }

                    //  $('#datatable-responsive tbody tr').remove();
                    var row = 0;
                    debugger
                    $.each(data[0].Services, function (i, billsitem) {
                        if (billsitem != null) {
                            var chk = $('input[name=ServiceInfoChk]:checked').val();
                            debugger
                            var ServiceType = "";
                            if (chk == "Test") {
                                ServiceType = "IPDLabBills";
                            }
                            else {
                                ServiceType = "IPD";
                            }
                            // subcat += '<option value="' + item.id + '">' + item.name + '</option>';
                            //$dropdownoldbill.append($("<option />").val(billsitem.BillNo).text(billsitem.BillNoDate));
                            //   if ($("#old_bill_no_id").val())
                            if (billsitem.BillNoChangeHeder == "ChangeRow") {

                                $('#datatable-responsive tbody').append('<tr><td style="display:none"><input value="' +0 + '" type="hidden" id="svc_hid" name="svc_hid1" /></td><th class=' + row + ' style="text-align: center; color:#35a4f1;" colspan="7"> <input type="radio" class="Billno" value=' + billsitem.BillNo + ' id="chkIPDBill" name="chkIPDBill" required="">     Bill No-' + billsitem.PBillNo + '   BillDate-' + billsitem.BillDate + '</th></tr>');
                                row++;
                                // $('#datatable-responsive').append('<tbody class="scrollbar' + billsitem.BillNo + '"></tbody>')

                                // $('#datatable-responsive tbody').removeClass("scrollbar");
                                // $('#datatable-responsive tbody').addClass(billsitem.BillNo);
                            }
                            if (billsitem.SvcID > 0) {
                                $('#datatable-responsive tbody').append('<tr class="read" ><td>' + billsitem.SvcName + '<input value="' + billsitem.SvcID + '" type="hidden" id="svc_hid" name="svc_hid" /><input type="hidden" id="svc_nm_hid" name="svc_nm_hid"  value="' + billsitem.SvcName + '" /> <input type="hidden" value="' + billsitem.DoctorID + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="1" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + billsitem.Rate + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + billsitem.Quantity + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="text" value=' + billsitem.Rate + '></td><td><input id="txt_tbl_qty" class="form-control" type="text" value=' + billsitem.Quantity + '></td><td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"> <option value=' + billsitem.DiscountServiceType + '>' + billsitem.DiscountServiceType + '</option><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value=' + billsitem.Discount_Service + ' class="nr form-control" type="text" id="Discount_Service" name="Discount_Service" /></td><td class=' + billsitem.BillNo + '>' + billsitem.Quantity * billsitem.Rate + '</td><td style="display:none"><input value="' + billsitem.Quantity * billsitem.Rate + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td style=" display: flex;"><input type="text" name="doctorID" id="doctorID" placeholder="Doctor ID.."><select class="fstdropdown-select DoctorPrintNamedgv form-control"></select></td></td><td> <button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" name="Mode" value="Add"/><input value="' + billsitem.ServiceType + '" type="hidden" id="ServiceType" name="ServiceType" /><input type="hidden" value="' + billsitem.Doctorcharges + '" name="Doctorcharges"/> <input type="hidden" name="UnitID1" value="' + billsitem.UnitID + '"><input type="hidden" id="tblIPDBill" name="tblIPDBill" value=' + billsitem.BillNo + '><input type="hidden" name="Authorization" value="0"></td></tr id="name">');
                                // $(".scrollbar tr").remove();
                                // $(".16 tr").remove();


                                // $("").val();
                                //govind
                                row++;
                            }
                        }
                    });
                    BindDr();

                    if (BillNo == 0) {
                        $("td").each(function () {

                            //    $(this).find('input,select,textarea').attr("readonly", true);
                            $(this).parent().find('#txt_tbl_rate').prop("disabled", "disabled");
                            $(this).parent().find('#txt_tbl_qty').prop("disabled", "disabled");
                            $(this).parent().find('#DiscountServiceType').prop("disabled", "disabled");
                            $(this).parent().find('#Discount_Service').prop("disabled", "disabled");
                            $(this).parent().find('#tbldel').prop("disabled", "disabled");




                        })
                        CaculateDescount();
                        // return false;
                        $("#gross_total").val("0.00");
                        $("#gross_total_id").val("0.00");
                        $("#disc_perc_id").val("0.00");
                        $("#disc_amount_id").val("0.00");
                        $("#disc_amount").val("0.00");

                        $("#total_amount_id").val("0.00");
                        $("#total_amount").val("0.00");

                        $("#amtpaid_id").val("0.00");
                        $("#amtpaid").val("0.00");

                        $("#netpayable_id").val("0.00");
                        $("#netpayable").val("0.00");
                    }
                    debugger

                    if (BillNo > 0) {
                        $("#datepicker").val(data[0].BillDateStr);
                        $("#datepicker1").val(data[0].BillTimeStr);
                        $("#gross_total").val(data[0].GrossAmount);
                        $("#gross_total_id").val(data[0].GrossAmount);
                        $("#total_amount").val(data[0].TotalAmount);
                        $("#total_amount_id").val(data[0].TotalAmount);
                        $("#netpayable").val(data[0].NetPayableAmount);
                        $("#netpayable_id").val(data[0].NetPayableAmount);
                        $('#disc_amount').val(data[0].DiscountAmount);
                        $('#disc_amount_id').val(data[0].DiscountAmount);
                        $('#discount').val(data[0].DiscountPercent);
                        $('#disc_perc_id').val(data[0].DiscountPercent);
                        $("#amtpaid").val(data[0].PaidAmount);
                        $("#amtpaid_id").val(data[0].PaidAmount);
                        //$("#amtpaid_id").val(amtpaid);
                        $("#bal_amount").val(data[0].BalanceAmount);
                        $("#bal_amount_id").val(data[0].BalanceAmount);
                        $("#payment_type").val(data[0].PaymentType);
                        $("#Number").val(data[0].Number);
                        $("#Name").val(data[0].Name);
                        CaculateDescount();
                        calculator();
                        //-----------------------------
                        //---------------------------
                        debugger
                        var selValue2 = $('input[name=RadioChargee]:checked').val();
                        var Type = $('input[name=RadioCharge]:checked').val();
                        $("#NonMedicalExp").val(0);
                        if (selValue2 == 3 && Type == "TPA") {
                            $("#NonMedicalExp").val(data[0].NonMedicalExp);
                        }

                        // $("#paymentDate").val(Date.parse(data[0].Date).toString('dd-MMM-yyyy'));
                        $("#Remarks").val(data[0].Remarks);
                    }
                },
                error: function (xhr, status, error) {
                    alert("Error: " + error);
                }

            });
            //}
        }
    }
    function OLdBillSelect() {
        debugger
        var changedText = $("#old_bill_no_id").val();
        if ($("#patientPrintBillNo").val() > 0) {
            // $("#old_bill_no_id").val($("#patientPrintBillNo").val());
            //changedText = $("#patientBillNo").val();
            //$("#patientPrintBillNo")

        }

        var printbill = $("#old_bill_no_id").text().split('--');
        var selValue2 = $('input[name=RadioChargee]:checked').val();
        // if (selValue2 != 3) {
        // alert(changedText);
        if (changedText != -1) {
            var UserData = { BillNo: changedText, chk: selValue2 }

            $.ajax({
                url: '@Url.Action("GetBillDetailByBillNo", "IPDBill")',
                dataType: "json",
                type: 'POST',
                data: JSON.stringify(UserData),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    //$("#fin_year_id").text(data[0].FinancialYear);

                    //var btnval = $("#btnSubmitid").val();
                    debugger
                    $("#btnSubmitid").val("Modify");
                    $("#disc_reason").val(data[0].DiscountReason);
                    $("#DiscountReasonID").val(data[0].DiscountReasonID);
                    $("#pre_balance").val(data[0].PreBalanceAmount);
                    $("#pre_balance_id").val(data[0].PreBalanceAmount);
                    $("#patientPrintBillNo").val(data[0].PrintBillNo);
                    // $('#datatable-responsive tbody').append('<tr><td>' + $("#service_name").val() + '<input value="' + $("#service_name_hid").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#service_name").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + $("#unit_hid").val() + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td>' + $("#rate").val() + '</td><td>' + $("#quantity").val() + '</td><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><td class="total">' + $("#quantity").val() * $("#rate").val() + '</td></tr>');

                    //$("#pre_balance").attr('value', data[0].PreBalanceAmount);
                    debugger
                    var aaa = data[0].PreBalanceAmount;
                    if (parseFloat(data[0].PreBalanceAmount) < 0) {
                        //alert("Deposit");

                        $("#priPalanceDeposit").text("Deposit")

                        $("#priPalanceDeposit").css("color", "blue");

                        var pre_balance = $("#pre_balance").val().replace("-", "");
                        $("#pre_balance").val(pre_balance)

                        $("#Deposit").val(pre_balance);
                        // $("#pre_balance").attr('value', Deposit);
                    }
                    else {
                        $("#priPalanceDeposit").text("Pre.Balance");
                        $("#priPalanceDeposit").css("color", "black");
                        $("#Deposit").text("0.00")
                    }

                    $('#datatable-responsive tbody tr').remove();
                    $.each(data[0].Services, function (i, billsitem) {

                        var chk = $('input[name=ServiceInfoChk]:checked').val();
                        debugger
                        var ServiceType = "";
                        if (chk == "Test") {
                            ServiceType = "IPDLabBills";
                        }
                        else {
                            ServiceType = "IPD";
                        }
                        // subcat += '<option value="' + item.id + '">' + item.name + '</option>';
                        //$dropdownoldbill.append($("<option />").val(billsitem.BillNo).text(billsitem.BillNoDate));
                        $('#datatable-responsive tbody').append('<tr><td>' + billsitem.SvcName + '<input value="' + billsitem.SvcID + '" type="hidden" id="svc_hid" name="svc_hid" /><input type="hidden" id="svc_nm_hid" name="svc_nm_hid"  value="' + billsitem.SvcName + '" /> <input type="hidden" value="' + billsitem.DoctorID + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="1" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + billsitem.Rate + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + billsitem.Quantity + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="text" value=' + billsitem.Rate + '></td><td><input id="txt_tbl_qty" class="form-control" type="text" value=' + billsitem.Quantity + '></td><td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"> <option value=' + billsitem.DiscountServiceType + '>' + billsitem.DiscountServiceType + '</option><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value="' + billsitem.Discount_Service + '" class="nr form-control" type="text" id="Discount_Service" name="Discount_Service" /></td><td class="total">' + billsitem.Quantity * billsitem.Rate + '</td><td style="display:none"><input value="' + billsitem.Quantity * billsitem.Rate + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td style=" display: flex;"><input type="text" name="doctorID" id="doctorID" placeholder="Doctor ID.."><select class="fstdropdown-select DoctorPrintNamedgv form-control"></select></td><td> <button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" name="Mode" value="Add"/><input value="' + billsitem.ServiceType + '" type="hidden" id="ServiceType" name="ServiceType" /><input type="hidden" value="' + billsitem.Doctorcharges + '" name="Doctorcharges"/> <input type="hidden" name="UnitID1" value="' + billsitem.UnitID + '"><input type="hidden" name="Authorization" value="0"></td></tr>');

                        //$(".DoctorPrintNamedgv").val(billsitem.DoctorID);
                    });

                    // grid work
                    BindDr();
                    debugger
                    // // document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[4].innerHTML = Total;


                    CaculateDescount();
                    $("#bill_date").val(data[0].BillDateStr);
                     $("#bill_time").val(data[0].BillTimeStr);

                    $("#surcharge").val(data[0].TaxPercent);
                    $("#tax_amount").val(data[0].TaxAmount);

                    $("#gross_total").val(data[0].GrossAmount);
                    $("#gross_total_id").val(data[0].GrossAmount);
                    $("#total_amount").val(data[0].TotalAmount);
                    $("#total_amount_id").val(data[0].TotalAmount);
                    $("#netpayable").val(data[0].NetPayableAmount);
                    $("#netpayable_id").val(data[0].NetPayableAmount);
                    $('#disc_amount').val(data[0].DiscountAmount);
                    $('#disc_amount_id').val(data[0].DiscountAmount);
                    $('#discount').val(data[0].DiscountPercent);
                    $('#disc_perc_id').val(data[0].DiscountPercent);
                    $("#amtpaid").val(data[0].PaidAmount);
                    $("#amtpaid_id").val(data[0].PaidAmount);
                    //$("#amtpaid_id").val(amtpaid);
                    $("#bal_amount").val(data[0].BalanceAmount);
                    $("#bal_amount_id").val(data[0].BalanceAmount);
                    $("#payment_type").val(data[0].PaymentType);
                    $("#Number").val(data[0].Number);
                    $("#Name").val(data[0].Name);
                    debugger
                    var selValue2 = $('input[name=RadioChargee]:checked').val();
                    var Type = $('input[name=RadioCharge]:checked').val();
                    $("#NonMedicalExp").val(0);
                    if (selValue2 == 3 && Type == "TPA") {
                        $("#NonMedicalExp").val(data[0].NonMedicalExp);
                    }

                    $("#paymentDate").val(Date.parse(data[0].Date).toString('dd-MMM-yyyy'));
                    $("#Remarks").val(data[0].Remarks);
                },
                error: function (xhr, status, error) {
                    alert("Error: " + error);
                }

            });
            //}
        }
        else {
            //  Restore();

            $('#datatable-responsive tbody tr').remove();
            $("#gross_total").val("0.00");
            $("#gross_total_id").val("0.00");
            $("#disc_perc_id").val("0.00");
            $("#disc_amount_id").val("0.00");
            $("#disc_amount").val("0.00");

            $("#total_amount_id").val("0.00");
            $("#total_amount").val("0.00");

            $("#amtpaid_id").val("0.00");
            $("#amtpaid").val("0.00");

            $("#netpayable_id").val("0.00");
            $("#netpayable").val("0.00");


           // PatientDetailFillData();
            debugger;
            //var show = $("#PreBalance").val();
            //if (show < 0) {
            //    $("#PreBalance").val(show);
            //}
        }
    }

    function Restore() {

        $("#pre_balance").val("");
        $("#patient_reg_no_id").val("");
        $("#old_bill_no_id").val("");
        $("#patient_name").val("");
        $("#patient_ipd_no").val("");
        $("#patient_ipd_no_id").val("");

        $("#Doctor").val("");
        $("#DoctorID").val("");


        $("#GuardianName").val("");
        $("#WordName").val("");
        $("#ward_name_hid").val("");

        $("#DepartmentName").val("");
        $("#DepartmentID").val("");


        $("#RoomNo").val("");
        $("#room_no_hid").val("");

        $("#BedNo").val("");
        $("#bed_no_hid").val("");


        $("#guardian_name").text("");
        $("#consultant_dr").text("");
        $("#ward_name").text("");
        $("#room_no").val("");
        $("#bed_no").text("");
        $("#gross_total").val("");
        $("#surcharge").val("");
        $("#tax_amount").val("");
        $("#total_amount").val("");
        $("#discount").val("");
        $("#disc_amount").val("");
        $("#disc_reason").val("");
        $("#netpayable").val("");
        $("#amtpaid").val("");
        $("#bal_amount").val("");
        $("#sanction_amount").val("");
        $("#department").val("");
        $("#room_no").text("");
        $("#bed_no").text("");
        $("#pre_balance").val("");
        $("#datatable-responsive td").remove();
        $("#old_bill_no_id").val("");
        $("#old_bill_no_id").text("");
        $("#old_bill_no_id").append('<option value="-1">SELECT OLD BILLS</option>');
        $("#old_bill_no_id").append('<option value="-2">Edit All Bill</option>');
        $("#OldbillView td").remove();
    }

    $(document).ready(function () {
        debugger;
        $("#disc_reason").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '@Url.Action("GetDiscountReason", "OPDBill")',
                    type: "GET",
                    dataType: "Json",
                    data: { prefix: request.term },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return {
                                label: item.DiscountReason, value: item.DiscountReason, id: item.DiscountReasonID
                            };
                        }))
                    }
                })
            },
            minlength: 1,
            change: function (event, i) {
                debugger;
                var show = i.item.id;
                $("#DiscountReasonID").val(show);
            },
        });
    });

    function DiscountAmount() {
        debugger
        var disc = $('#disc_amount').val();
        var tot = $("#total_amount").val();
        if (disc == "")
        {
            disc = 0;
        }
        if (tot == "") {
            tot = 0;
        }
        $('#disc_amount_id').val(disc);
        var discperc = (parseFloat(disc) / (parseFloat(tot.replace("-", "")) / 100).toFixed(2)).toFixed(2);
        $('#discount').val(discperc);
        $('#disc_perc_id').val(discperc);
        var net = parseInt(tot) - parseInt(disc);
        $("#netpayable").val(net);
        $("#netpayable_id").val(net);
        var disc = $('#netpayable').val();
        var amtpaid = $("#amtpaid").val();
        var bal = parseInt(disc) - parseInt(amtpaid);
        $("#bal_amount").val(bal);
        $("#bal_amount_id").val(bal);
        $("#amtpaid_id").val(amtpaid);
        $(".total").each(function () {
            debugger
            $(this).parent().find('#txt_tbl_rate').attr('placeholder', 0);
            $(this).parent().find('#Discount_Service').attr('placeholder', 0);
            var rate = $(this).parent().find('#txt_tbl_rate').val();
            if (rate == 0) {
                $(this).parent().find('#txt_tbl_rate').val('');
                $(this).html(0);
            }

            var Discount_Service = $(this).parent().find('#Discount_Service').val();
            if (Discount_Service == 0) {
                $(this).parent().find('#Discount_Service').val('');
            }
        })
    }
    $(document).ready(function () {
        $("#datatable-responsive").delegate('td', 'change', function () {
            debugger
            //CaculateDescount();
            // var row_num = parseInt($(this).parent().index());

            // //   var a = Qty;

            // // var rate = document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[1].innerHTML;

            // // document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[4].innerHTML = Total;

            // var child = $("#datatable-responsive td").closest("tr").length;

            // var gross = 0;
            // var Discount_ServiceTotal = 0;
            // var DiscountPercent = 0;
            // var TotalPer = 0;
            // for (var row = 0; row < child; row++) {

            //         if (document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[3].children[0].value == "%") {
            //             DiscountPercent = parseFloat(document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[4].children[0].value);
            //             if (DiscountPercent <= 100) {
            //                 var Amount = parseFloat(document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[5].innerHTML);
            //                 TotalPer = TotalPer + ((Amount * DiscountPercent) / 100);

            //                 $('#disc_amount_id').val(TotalPer.toFixed(2));
            //                 $("#disc_amount").val(TotalPer.toFixed(2));

            //             }
            //             else {
            //                 alert("Discount Not Less " + DiscountPercent);
            //                 return false;
            //             }
            //         }
            //         else {
            //             TotalPer = TotalPer + parseFloat(document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[4].children[0].value);
            //             $("#disc_amount").val(TotalPer);
            //             $('#disc_amount_id').val(TotalPer);
            //         }

            // }

            ////  DiscountAmount();
            // var disc = $('#disc_amount').val();
            // var tot = $("#gross_total").val();
            // $('#disc_amount_id').val(disc);
            // var discperc = (parseFloat(disc) / (parseFloat(tot) / 100));
            // $('#discount').val(discperc.toFixed(2));
            // $('#disc_perc_id').val(discperc.toFixed(2));
            // var net = parseInt(tot) - parseInt(disc);
            // $("#netpayable").val(net);
            // $("#netpayable_id").val(net);

            // calculator();
            // $(".form-control").val().toFixed(2);
        });





        $("#datatable-responsive").delegate('td', 'keyup', function () {
            debugger
            var row_num = parseInt($(this).parent().index());
            var rate = $(this).parent().find('#txt_tbl_rate').val();
         var qty = $(this).parent().find('#txt_tbl_qty').val();
         var dis = $(this).parent().find('#Discount_Service').val();
         if (rate == 0)
         {

         }

         CaculateDescount();

            DiscountAmount();
            if ($("#old_bill_no_id").val() == -2) {
                var UserData = {BillNo:$("input[name='chkIPDBill']:checked").val(), gross_total: $("#gross_total_id").val(), pre_balance_id: $("#pre_balance_id").val(), NonMedicalExp: $("#NonMedicalExp").val(), total_amount: $("#total_amount").val(), disc_perc_id: $("#disc_perc_id").val(), disc_amount_id: $("#disc_amount_id").val(), netpayable_id: $("#netpayable_id").val(), amtpaid_id: $("#amtpaid_id").val(), bal_amount_id: $("#bal_amount_id").val() }
                //  alert(JSON.stringify(UserData));
                $.ajax({
                    url: '@Url.Action("GetPatientBillsForIPDNo", "IPDBill")',
                    type: 'POST',
                    data: JSON.stringify(UserData),
                    traditional: true,
                    contentType: 'application/json',
                    success: function (data) {


                    }
                })
            }
        })

        $(".total").each(function () {
            debugger
            $(this).parent().find('#txt_tbl_rate').attr('placeholder', 0);
            $(this).parent().find('#Discount_Service').attr('placeholder', 0);
            var rate = $(this).parent().find('#txt_tbl_rate').val();
            if (rate == 0) {
                $(this).parent().find('#txt_tbl_rate').val('');
                $(this).html(0);
            }

            var Discount_Service = $(this).parent().find('#Discount_Service').val();
            if (Discount_Service == 0) {
                $(this).parent().find('#Discount_Service').val('');
            }
        })

        //   var a = Qty;

        // var rate = document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[1].innerHTML;

        // document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[4].innerHTML = Total;


        $('#disc_amount').keyup(function () {
            //if ($(this).val() == "") {
            //    $(this).val(0)
            //}
            if ($("#DiscountReasonID").val() > 0)
            {
                DiscountAmount();
            }
            else
            {
               // alert("Discount Reason Cannot be empty");
                DiscountAmount();
            }

        });


        $('#discount').keyup(function () {
            debugger
            if ($(this).val() == "" || $(this).val()>100)
            {
                if ($(this).val() > 100)
                {
                    alert("Discount Percent Can not Be Greater Than 100")
                    $(this).val(0);
                }
                $(this).val(0);

            }

                var discperc = $('#discount').val();
                var tot = $("#total_amount").val();
                var oneperc = (parseFloat(tot) / 100).toFixed(2);
                var disamt = (parseFloat(oneperc) * (parseFloat(discperc)).toFixed(2));
                $('#disc_amount').val(disamt);
                $('#disc_amount_id').val(disamt);
                $('#discount').val(discperc);
                $('#disc_perc_id').val(discperc);
                var net = parseFloat(tot) - parseFloat(disamt);
                $("#netpayable").val(net).toFixed(2);
                $("#netpayable_id").val(net).toFixed(2);
                var disc = $('#netpayable').val();
                var amtpaid = $("#amtpaid").val();
                var bal = parseInt(disc) - parseInt(amtpaid);
                $("#bal_amount").val(bal);
                $("#bal_amount_id").val(bal).toFixed(2);
                $("#amtpaid_id").val(amtpaid).toFixed(2);

        });


        $('#amtpaid').keyup(function () {

            debugger
            var PaidAmount = $("#amtpaid").val().replace("-", "");

            $("#amtpaid").val(PaidAmount);

            // $("#PaidAmount").val(PaidAmount)
            var PreBalance = $("#PreBalance").val();


            var disc = $('#netpayable').val();
            var amtpaid = $("#amtpaid").val();

            var bal = parseInt(disc) - parseInt(amtpaid);


            $("#bal_amount").val(bal);
            $("#bal_amount_id").val(bal);
            $("#amtpaid_id").val(amtpaid);

        });
    });

    $(document).ready(function () {

        $.ajax({
            //url: "/OPDBill/GetAllFinancialYear",
            url: '@Url.Action("GetAllFinancialYear", "OPDBill")',
            type: "GET",
            data: {},
            dataType: "json",
            success: function (data) {
                debugger;

                $("#fin_year_id").val(data[0].FinancialYear);
                $("#fin_year_hid").val(data[0].FinancialYearID);

            },
            error: function (data) {
            }
        });

        $("#reset").click(function () {
            Restore();

        })
        $("#btnclose").click(function () {

            $("#myModal1").hide(100);
        })

        $("#btnPriBalance1").click(function () {
            BalancetranferPre();
        })

        function BalancetranferPre()
        {
            debugger
            if ($("#patient_reg_no_id").val() > 0) {
                $("#myModal1").show(100);
                var UserData = { PatientRegNo: $("#patient_reg_no_id").val() }
                var DrAmount = 0;
                var CrAmount = 0;
                var TotalAmount = 0;
                $.ajax({
                    url: '@Url.Action("GetBalanceAmountRegistration", "IPDBill")',
                    dataType: "json",
                    type: 'POST',
                    data: JSON.stringify(UserData),
                    traditional: true,
                    contentType: 'application/json',
                    success: function (data) {
                        $("#OldBalanceView  tbody tr").remove();
                        $("#OldBalanceView  tbody th").remove();
                        $(data).each(function (index, billsitem) {
                            $("#namepatient").text(billsitem.PatientName);
                            $("#nameUHID").text(billsitem.PatientRegNo);
                            $("#OldBalanceView").append('<tr><td>' + billsitem.OPDIPDNO + '</td><td>' + billsitem.BillType + '</td><td>' + billsitem.Date + '</td><td>' + billsitem.BalanceAmount + '</td><td><i id="paidamtdgv" class="fa fa-credit-card"></i></td></tr>')
                            DrAmount += parseFloat(billsitem.DrAmount);
                            CrAmount += parseFloat(billsitem.CrAmount);
                            TotalAmount += parseFloat(billsitem.BalanceAmount);
                        })

                        if (TotalAmount >= 0) {
                            $("#OldBalanceView").append('<tr><th colspan="3"><strong> Bal Amt. </strong></th><th>  <strong>' + TotalAmount + '</strong></th></tr>')
                        }
                        else {
                            $("#OldBalanceView").append('<tr><th colspan="2"><strong> Deposit Amt. </strong></th><th><strong><a href="#" id="settle">Bal Transfer</a></strong></th><th><strong>  ' + TotalAmount + '</strong></th></tr>')
                        }

                    }
                })
            }
        }

        //Settle Work
        var row = 0;
        $("#OldBalanceView").on('click', '#settle', function () {
            debugger
            //$("#OldBalanceView").append('<tr><th><strong> Select IPDNo. </strong></th><th><a href="#" id="PreBalanceAmount">0 </a></th><th><strong><select class="form-control input-sm" id="OPDIPDNO"></select></strong></th><th><a href="#" id="">Transfer </a></th></tr>')

            if (row == 0) {
                $("#OldBalanceView").append('<tr><th><strong>Select IPDNo. Amt</strong></th><th><a href="#" id="PreBalanceAmount">0 </a><br><input type="text" value="0" id="txtamtransfer"/><th><strong>From IPD No.  <select class="form-control input-sm" id="OPDIPDNO"></select></strong></th></th><th><strong>To IPD<select class="form-control input-sm" id="OPDIPDNOTO"></select></strong></th><th><a href="#" id="Transfer">Transfer </a></th></tr>')

                row++;
                var PregNo = { PatientRegNO: $("#patient_reg_no_id").val() }
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetRefoundIPDOPDID1", "PreBalanceAmount")',
                    data: JSON.stringify(PregNo),
                    contentType: "application/json; charset=utf-8",
                    success: function (SearchList2) {
                        var value = "";
                        $("#OPDIPDNO").text("");
                        $("#OPDIPDNO").val("");
                        $("#OPDIPDNOFrom").text("");
                        $("#OPDIPDNOFrom").val("");
                        debugger

                        $("#OPDIPDNOTO").append('<option value="0">---Select---</option>');
                        $("#OPDIPDNO").append('<option value="0">---Select---</option>');
                        for (var i = 0; i < SearchList2.length; i++) {

                            //$("#OPDIPDNO").val(optionhtml);
                            $("#OPDIPDNO").append('<option value="' + SearchList2[i].OPDIPDNO + '">' + SearchList2[i].PrintOPDIPDNo + '</option>');
                            $("#OPDIPDNOTO").append('<option value="' + SearchList2[i].OPDIPDNO + '">' + SearchList2[i].PrintOPDIPDNo + '</option>');


                        }


                    },
                });
            }
            
            $("#close1").click(function () {
                debugger
                row = 0;
            }
            )
            $("#Transfer").click(function () {
                debugger
                row = 0;
                if (parseFloat($("#PreBalanceAmount").text())> parseFloat($("#txtamtransfer").val()))
                {
                    alert("Amount Can Not be Greater then Refund Amount " + $("#txtamtransfer").val());
                    return false;
                }

                if (parseFloat($("#PreBalanceAmount").text()) < 0) {
                    if ($("#OPDIPDNO").val()!= $("#OPDIPDNOTO").val()) {
                        var UserData = { Reg: $("#patient_reg_no_id").val(), OPDIPDNOFrom: $("#OPDIPDNO").val(), OPDIPDNOTO: $("#OPDIPDNOTO").val(), RefundAmt: $("#txtamtransfer").val() ,OPDIPDNOTOpPrint: $("#OPDIPDNOTO").text()}
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("IURefoundAmount", "IPDBill")',
                            data: JSON.stringify(UserData),
                            contentType: "application/json; charset=utf-8",
                            success: function (search) {
                                if (search == "Done") {
                                    alert("Transfer Balance Done..");
                                    BalancetranferPre();
                                    $("#patientPrintIPDNo").change();
                                    
                                }
                                else {
                                    alert("Try Again..");
                                }
                            }
                        })
                    }
                    else
                    {
                        alert("FromOPDIPDNo And ToOPDIPDNo Not same ..");
                    }

                }
            })
            $("#OPDIPDNO").change(function () {
                debugger
                var OPDIPDNo = $(this).val();
                if (OPDIPDNo!= 0) {

                    var UserData = { OPDIPDNo: OPDIPDNo }
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("GetRefoundAmountOPDIPD", "PreBalanceAmount")',
                        data: JSON.stringify(UserData),
                        contentType: "application/json; charset=utf-8",
                        success: function (search) {
                            debugger;
                            // $("#presentor tr").remove();
                            $("#PreBalanceAmount").text(search[0].BalanceAmount);
                            if (parseFloat(search[0].BalanceAmount) < 0) {
                            }
                        }
                    })
                }
                else
                {
                    $("#PreBalanceAmount").text(0);
                }
            })

        })

        //End
        $("#OldBalanceView").on('dblclick', '#paidamtdgv', function () {
            debugger
            var row = $(this).closest('tr').index();

            //  var BillType_OPDIPDNo = document.getElementById('OldBalanceView').tBodies[0].rows[row].cells[0].innerHTML.replace("/", ",");


            //  localStorage.setItem('BillType_OPDIPDNo', BillType_OPDIPDNo);

            localStorage.setItem('IPDOPDRegNo', $("#patient_reg_no_id").val());
            window.open('@Url.Action("PreBalanceAmount", "PreBalanceAmount")');

            @*var BillType_OPDIPDNo = document.getElementById('OldBalanceView').tBodies[0].rows[row].cells[0].innerHTML.replace("/",",");
            localStorage.setItem('BillType_OPDIPDNo', BillType_OPDIPDNo);
            window.open('@Url.Action("PreBalanceAmount", "PreBalanceAmount")');*@

        })
        $("#surcharge").keyup(function () {
            if ($(this).val() == "") {
                $(this).val(0)
            }
            debugger
            var Surcharge = parseFloat($("#gross_total").val()) * parseFloat($("#surcharge").val()) / 100;
            $("#tax_amount").val(Surcharge);

            calculator();

        })

    })
    function CaculateDescount() {
        var child = $("#datatable-responsive td").closest("tr").length;
        debugger
        var gross = 0;
        var Discount_ServiceTotal = 0;
        var DiscountPercent = 0;
        var TotalPer = 0;
        var rate = 0;
        var qty = 0;
        for (var row = 0; row < child; row++) {
            TotalPer = 0;
            if (parseFloat(document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[0].children[0].value) != 0) {
                var a = $(this).parent().find('#txt_tbl_rate').val();
                rate = document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[1].children[0].value;
                if (rate== '' || rate==  'undefined')
                {
                    rate = 0;
               }
                qty = parseFloat(document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[2].children[0].value);
                DiscountPercent = parseFloat(document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[4].children[0].value);
                if (document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[4].children[0].value == "")
                {
                    document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[4].children[0].value = 0;
                    DiscountPercent = 0;
                }
                if (document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[3].children[0].value == "%") {

                    if (DiscountPercent <= 100 || DiscountPercent == 0) {
                        var Gross = parseFloat(rate) * parseFloat(qty);
                        TotalPer = TotalPer + ((Gross * DiscountPercent) / 100);
                        //  document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[5].innerHTML = Gross - TotalPer;
                        //    $('#disc_amount_id').val(TotalPer.toFixed(2));
                        document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[6].children[1].value = TotalPer.toFixed(2);
                        //$("#sevicedisAmt").val(TotalPer.toFixed(2));
                    }
                    else {
                        alert("Discount Not Less " + DiscountPercent);
                        document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[4].children[0].value = 0;
                        return false;
                    }
                }
                else {
                    var gross = parseFloat(rate) * parseFloat(qty); //- parseFloat(DiscountPercent);
                    if (parseFloat(DiscountPercent) <= gross)
                    {
                        document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[6].children[1].value = DiscountPercent;
                    }
                    else
                    {
                        document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[4].children[0].value = 0;
                        alert("Discount Amount Not Less " + DiscountPercent);
                        return false;
                    }
                    // document.getElementById('datatable-responsive').tBodies[0].rows[row].cells[5].innerHTML = gross.toFixed(2);
                }
            }
        }
        debugger
        calculator();
        var sevicedisAmt = 0;
        $(".total").each(function () {
            debugger
            sevicedisAmt+= parseFloat($(this).parent().find('#sevicedisAmt').val());
             $("#disc_amount").val(sevicedisAmt);
             $("#disc_amount_id").val(sevicedisAmt);


            $(this).parent().find('#txt_tbl_rate').attr('placeholder', 0);
            $(this).parent().find('#Discount_Service').attr('placeholder', 0);
            var rate = $(this).parent().find('#txt_tbl_rate').val();
            if (rate == 0) {
                $(this).parent().find('#txt_tbl_rate').val('');
                $(this).html(0);
            }

            var Discount_Service = $(this).parent().find('#Discount_Service').val();
            if (Discount_Service == 0) {
                $(this).parent().find('#Discount_Service').val('');
            }
        })
       // TableDefaltZerovalue();
        //  DiscountAmount();
        //var disc = $('#disc_amount').val();
        //var tot = $("#gross_total").val();
        //$('#disc_amount_id').val(disc);
        //var discperc = (parseFloat(disc) / (parseFloat(tot) / 100));
        //$('#discount').val(discperc.toFixed(2));
        //$('#disc_perc_id').val(discperc.toFixed(2));
        //var net = parseInt(tot) - parseInt(disc);
        //$("#netpayable").val(net);
        //$("#netpayable_id").val(net);


        // $(".form-control").val().toFixed(2);
    }

    $(document).ready(function(){

        $("#txtdgvGroup").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#dgvGroup tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
        $("#txtdgvService").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#dgvService tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });

        $('input[name=ServiceInfoChk]').change(function () {
            debugger
            var chk = $('input[name=ServiceInfoChk]:checked').val();
            if (chk == "Package")
            {
                $("#divgp").hide();
               var GrpName = chk;
                URL = '@Url.Action("GetServiceName", "IPDBill")';
                var1 = { prefix: "%", id: $(this).val(), chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val() }

                $.ajax({
                    url: URL,
                    dataType: "json",
                    type: "POST",
                    data: JSON.stringify(var1),
                    traditional: true,
                    contentType: 'application/json',
                    success: function (data) {
                        var Rate = 0;
                        $("#dgvService tr").remove();

                        $(data).each(function (index, i) {


                            debugger
                            // TestLabDetailInTPA(i.item.Serviceid)
                            var show = i.Serviceid;

                            var show1 = i.value;

                            RadioCharge = $('input[name=RadioCharge]:checked').val();
                            $("#Unit").val(i.Unit);
                            $("#UnitID").val(i.UnitID);
                            if (i.ServceTrue == "True") {
                                $("#quantity").val(i.Quantity);
                                //  $("#quantity").val(
                            }
                            else {

                                $("#quantity").val(1);
                            }

                            if (RadioCharge == "General") {
                                $("#rate").val(i.GeneralCharges);
                                Rate = i.GeneralCharges;
                            }

                            $("#rate").val(i.GeneralCharges);

                            if (RadioCharge == "Emergency") {

                                $("#rate").val(i.EmergencyCharges);
                                Rate = i.EmergencyCharges;
                            }

                            //TPA Charge

                            if (RadioCharge == "TPA") {
                                $("#rate").val(i.GeneralCharges);
                                $("#quantity").val(i.Quantity);
                            }

                            //----------------
                            $("#ServiceID").val(show);
                            $("#servicename1").val(show1)

                            $("#dgvService").append('<tr><td style="display:none">' + i.ServiceGroupID + '</td><td><input type="checkbox" id="chk1"  name="" value=' + i.ServiceID + '></td> <td> ' + i.ServiceGroupName + '</td><td> ' + i.servicename + '</td><td>' + i.ServiceHSNCode + '</td><td> ' + Rate + '</td><td style="display:none"><input type="hidden" value=' + i.UnitID + ' name="UnitID"> </td></tr>')

                        })
                    }
                })



            }
            else
            {
                $("#dgvService tr").remove();
                //  GetServiceGrp();
                if (document.getElementById("TPA").checked == true) {
                    //TPAServiceTableShow();

                    TPAServiceGroupTableShow();
                    $("#divgp").show();
                }
                else {
                    $("#divgp").show();
                }
            }

        })
    });

    $(function () {

        var d = new Date(),
            h = d.getHours(),
            m = d.getMinutes();
        if (h < 10) h = '0' + h;
        if (m < 10) m = '0' + m;
        $('input[type="time"][value="now"]').each(function () {
            $(this).attr({ 'value': h + ':' + m });

        });

        // grid work service Add


        GetServiceGrp();

        function GetServiceGrp() {
            $.ajax({
                url: '@Url.Action("GetServiceGrp", "IPDBill")',
                type: "POST",
                dataType: "json",
                data: { prefix: "%", Type:"OPD"},
                success: function (data) {
                    RadioCharge = $('input[name=RadioCharge]:checked').val();
                    if (RadioCharge != "Package") {
                        $("#dgvGroup tr").remove();
                        $(data).each(function (index, d) {
                            debugger
                            if (d.ServiceGroupCode == null)
                            {
                                d.ServiceGroupCode = "";
                            }
                            $("#dgvGroup").append('<tr><td><input type="radio" id="grID"  name="grID" value=' + d.ServiceGroupID + '></td> <td> ' + d.ServiceGroupName + '</td><td style="display:none"> ' + d.ServiceType + '</td><td> ' + d.ServiceGroupCode + '</td></tr>');

                        });
                    }
                    else {
                        $("#dgvGroup tr").remove();
                    }
                }

            })

        }
        $("#dgvGroup").on('click', '#grID', function () {
            debugger

            if ($("#patient_name").val() != "" && $("#patient_reg_no_id").val() != "") {
                var URL = "";
                var var1 = "";
                var row_num = $(this).closest('tr').index();

                var GrpName = document.getElementById('dgvGroup').rows[row_num].cells[1].innerHTML;
                var lab = document.getElementById('dgvGroup').rows[row_num].cells[2].innerHTML;

                if (lab == " Lab") {
                    $("#rdTest").prop("checked", 'checked');
                }
                else {
                    $("#rdService").prop("checked", 'checked');
                }
                if (document.getElementById("TPA").checked == true) {
                    if ($('input[name=ServiceInfoChk]:checked').val() == "Service") {
                        URL = '@Url.Action("GetServiceNameTPA", "IPDBill")';
                        var1 = { prefix: "%", id: $(this).val(), chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val(), OrganizationID: $("#TPAID").val() }
                    }
                    else {
                        if ($('input[name=ServiceInfoChk]:checked').val() == "Test") {
                            URL = '@Url.Action("GetServiceName", "IPDBill")';
                            var1 = { prefix: "%", id: $(this).val(), chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val() }
                        }
                    }
                }
                else {
                    URL = '@Url.Action("GetServiceName", "IPDBill")';
                    var1 = { prefix: "%", id: $(this).val(), chk: $('input[name=ServiceInfoChk]:checked').val(), Charges: RadioCharge, RegNo: $("#patient_reg_no_id").val(), IPDNo: $("#patient_ipd_no_id").val(), BillDate: $("#bill_date").val(), RegDate: $("#AdmitDate").val(), WordID: $("#ward_name_hid").val() }
                }
                //govind
                $.ajax({
                    url: URL,
                    dataType: "json",
                    type: "POST",
                    data: JSON.stringify(var1),
                    traditional: true,
                    contentType: 'application/json',
                    success: function (data) {
                        var Rate = 0;
                        $("#dgvService tr").remove();
                        $(data).each(function (index, i) {
                            debugger

                            // TestLabDetailInTPA(i.item.Serviceid)
                            var show = i.Serviceid;

                            var show1 = i.value;
                            RadioCharge = $('input[name=RadioCharge]:checked').val();
                            $("#Unit").val(i.Unit);
                            $("#UnitID").val(i.UnitID);
                            if (i.ServceTrue == "True") {
                                $("#quantity").val(i.Quantity);
                                //  $("#quantity").val(
                            }
                            else {

                                $("#quantity").val(1);
                            }

                            if (RadioCharge == "General") {
                                $("#rate").val(i.GeneralCharges);
                                Rate = i.GeneralCharges;
                            }

                            $("#rate").val(i.GeneralCharges);

                            if (RadioCharge == "Emergency") {

                                $("#rate").val(i.EmergencyCharges);
                                Rate = i.EmergencyCharges;
                            }

                            //TPA Charge

                            if (RadioCharge == "TPA") {
                                $("#rate").val(i.GeneralCharges);
                                $("#quantity").val(i.Quantity);
                            }

                            if (Rate == "")
                            {
                                Rate = 00;
                            }
                            //----------------
                            $("#ServiceID").val(show);
                            $("#servicename1").val(show1)

                            $("#dgvService").append('<tr><td style="display:none">' + i.ServiceGroupID + '</td><td><input type="checkbox" id="chk1"  name="" value=' + i.ServiceID + '></td> <td> ' + GrpName + '</td><td> ' + i.servicename + '</td><td>'+i.ServiceHSNCode+'</td><td> ' +  $("#rate").val() + '</td><td style="display:none"><input type="hidden" value=' + i.UnitID + ' name="UnitID"> </td></tr>')

                        })
                    }
                })
            }
            else
            {
                alert("Enter PatientReg No..")
            }
            })


        function GetAllPackageServiceWise(ServiceType) {

            alert("govind1", +ServiceType);
            var UserData = { ServiceID: $("#ServiceID").val() ,WardID: $("#ward_name_hid").val()}
            $.ajax({
                url: '@Url.Action("GetAllPackageServiceWise", "IPDBill")',
                dataType: "json",
                type: 'POST',
                data: JSON.stringify(UserData),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    debugger
                    if (data == "Already This Packege Add") {
                        alert(data);
                        return false;
                    }
                    var Rate = 0;
                    for (var i = 0; i < data.length; i++) {
                        if (RadioCharge == "General") {
                            Rate = data[i].GeneralCharges;
                        }

                        // $("#rate").val(i.item.GenralCharge);

                        if (RadioCharge == "Emergency") {
                            Rate = data[i].EmergencyCharges;
                            $("#rate").val(data[i].EmergencyCharges);
                        }

                        // $("#quantity").val(data[0].Quantity) * $("#rate").val()
                        //   data[0].EmergencyCharges

                        $('#datatable-responsive tbody').append('<tr><td>' + data[i].servicename + " " + $("#DoctorPrintName").val() + " " + ' <input value="' + data[i].ServiceID + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + data[i].servicename + " " + $("#DoctorPrintName").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + $('#DoctorPrintNameID').val() + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + data[i].UnitID + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + Rate + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + data[i].Quantity + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="number" value=' + Rate + '></td><td><input id="txt_tbl_qty" class="form-control" type="number" value=' + parseInt(data[i].Quantity) + '></td> <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value="0" class="nr form-control" type="number" id="Discount_Service" name="Discount_Service" /></td><td class="total">' + data[i].Quantity * Rate + '</td><td style="display:none"><input value="' + data[i].Quantity * Rate + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td style=" display: flex;"><input type="text" name="doctorID" id="doctorID" placeholder="Doctor ID.."><select class="fstdropdown-select DoctorPrintNamedgv form-control"></select></td><td><button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" class="finalbill" name="ServiceType" /><input type="hidden" name="UnitID1" value="' + data[i].UnitID + '"> <input type="hidden" name="Authorization" value="0"></td></td></tr>');
                    }
                    calculator();
                    $("#ServiceID").val("0");
                    $("#servicename1").val("");
                    $("#servicename").val("");
                    $("#ServiceGroupID").val("0");
                    $("#ServiceGroupName").val("");
                    $("#rate").val("");
                    // $("#DoctorPrintNameID").val("0");
                    $("#DoctorPrintName").val("");
                    $("#quantity").val("1");
                    $("#ServiceCode").val("");
                    $("#Unit").val("");
                    $("#UnitID").val("");
                }
            })
        }
        var rowEditAll = 0;
        $("#datatable-responsive").on('change', '#chkIPDBill', function (e) {
            debugger
            // var aaaa =$("#datatable-responsive tr").not("thead tr").index();
            //var aaaa = $(this).closest('tr').not("tr th").index();
            //var $tr = $(this).closest('th');
            rowEditAll = $(this).closest('tr').index(); //parseInt($tr.index()) + parseInt(1);
        })

        function TableDefaltZerovalue()
        {
            $(".total").each(function () {
                debugger
                var rate = $(this).parent().find('#txt_tbl_rate').val();
                if(rate==0)
                {
                    $(this).parent().find('#txt_tbl_rate').val('');
                }

                var Discount_Service = $(this).parent().find('#Discount_Service').val();
                if (Discount_Service == 0) {
                    $(this).parent().find('#Discount_Service').val('');
                }
            })
            }


        $("#dgvService").on('change', '#chk1', function () {

            debugger;
            var chk=$(this).prop("checked");
            if (chk) {
                var row_num = $(this).closest('tr').index(); //parseInt($(this).parent().index());
                var GrpID = document.getElementById('dgvService').rows[row_num].cells[0].innerHTML;
                var rate = document.getElementById('dgvService').rows[row_num].cells[5].innerHTML;
                var servicename = document.getElementById('dgvService').rows[row_num].cells[3].innerHTML;
                var UnitID = document.getElementById('dgvService').rows[row_num].cells[6].children[0].value;
                var ServiceID = $(this).val();
                var r = document.getElementById("rate").value = rate.trim();

                debugger
                if (flagfinal == "true" && $("#old_bill_no_id").val() == "-1") {
                    alert("Final Bill Already Generated Select Old Bill No");
                    $("#ServiceID").val("0");
                    $("#servicename1").val("");
                    $("#servicename").val("");
                    $("#ServiceGroupID").val("0");
                    $("#ServiceGroupName").val("");
                    $("#rate").val("");
                    $("#DoctorPrintNameID").val("0");
                    $("#DoctorPrintName").val("");
                    $("#quantity").val("1");
                    $("#ServiceCode").val("");
                    $("#Unit").val("");
                    $("#UnitID").val("");
                    service_name_hid = "";
                    return false;

                }
                document.getElementById('quantity').value = 1;
                var svcnm = document.getElementById('servicename').value=servicename;
                var service_name_hid = document.getElementById('ServiceID').value = ServiceID;
                var service_group = $("#ServiceGroupID").val(GrpID);
               // var UnitID = $("#UnitID").val(UnitID);

                $("#doctorAmountshow").hide();
                var test = $('input[name=ServiceInfoChk]:checked').val();
                if (document.getElementById("TPA").checked == false) {
                    if (test != "on") {
                        if (service_group == null || service_group == '') {
                            alert('Please select a ServiceGroup Name');
                            $("#ServiceGroupName").val("");
                            $("#servicename").val("");
                            return false;
                        }
                    }
                }
                if (service_name_hid == '') {
                    alert('Please select a Service Name');
                    $("#servicename").val("");
                    return false;
                }
                else {
                    var cons_dr_hidden = $('#DoctorPrintNameID').val();

                    if (cons_dr_hidden == '') {
                        cons_dr_hidden = $('#consultant_dr_hid').val();
                    }
                    var newsvcid = $("#service_name_hid").val();
                    var setflag = 'false';
                    var Doctorcharges = $("#drcharges").val();

                    $(".total").each(function () {
                        debugger
                        var rate = $(this).parent().find('#txt_tbl_rate').val();
                        var qty = $(this).parent().find('#txt_tbl_qty').val();
                        if (qty == "")
                        {
                            qty = 1;
                        }
                        var svcrate = $(this).parent().find('#svc_rate_hid').val();
                        var svcqty = $(this).parent().find('#svc_qty_hid').val();
                        var total_hid = $(this).parent().find('#tot_hid').val();
                        var svcid = $(this).parent().find('#svc_hid').val();
                        var docid = $(this).parent().find('#doc_hid').val();
                        var tot2 = parseFloat(rate) * parseFloat(qty);
                        var srvname = $(this).parent().find('#doc_hid').val();
                        var service_name_hid = $(this).parent().find('#svc_nm_hid').val().trim();

                        if (servicename.trim() == service_name_hid.trim()) {
                            debugger
                            var BEd = servicename.split("--");

                            if (BEd[0].trim() == $("#WordName").val().trim()) {
                                alert("BED CHARGES Alredy Exist");
                                $("#ServiceID").val("0");
                                $("#servicename1").val("");
                                $("#servicename").val("");
                                $("#ServiceGroupID").val("0");
                                $("#ServiceGroupName").val("");
                                $("#rate").val("");
                                $("#DoctorPrintNameID").val("0");
                                $("#DoctorPrintName").val("");
                                $("#quantity").val("1");
                                $("#ServiceCode").val("");
                                $("#Unit").val("");
                                $("#UnitID").val("");
                                service_name_hid = "";
                                return false;

                            }
                            else {

                                $(this).parent().find('#txt_tbl_qty').val(parseFloat($(this).parent().find('#txt_tbl_qty').val()) + (1));
                                $(this).parent().find('input[name=Authorization]').val(1);
                                servicename = 0;
                                billNo = 0;
                                return false;
                            }
                        }
                    });

                    if (setflag == 'false') {




                        var chk = $('input[name=ServiceInfoChk]:checked').val();

                        var ServiceType = "";
                        if (chk == "Service") {

                            ServiceType = "IPD";
                            var selValue2 = $('input[name=RadioChargee]:checked').val();
                            if (selValue2 == "3") {
                                ServiceType = "IPDFinalBill";
                            }
                        }

                        if (chk == "Test") {

                            ServiceType = "IPDLabBills";

                            var selValue2 = $('input[name=RadioChargee]:checked').val();
                            if (selValue2 == "3") {
                                ServiceType = "IPDLabFinalBill";
                            }
                        }

                        if (chk == "Package") {

                            ServiceType = "IPDPackageBills";

                            //     var selValue2 = $('input[name=RadioChargee]:checked').val();
                            //if (selValue2 == "3") {
                            //    ServiceType = "IPDLabFinalBill";
                            //}
                        }
                        debugger
                        if ($("#ServiceID").val() > 0) {
                            if ($("#old_bill_no_id").val() == -2) {

                                // $("#15 tr").remove();

                                debugger
                                var billNo = $("input[name='chkIPDBill']:checked").val();
                                if (billNo > 0) {
                                    if (servicename != 0) {
                                        $('#datatable-responsive > tbody > tr').eq(rowEditAll).after('<tr><td>' + $("#servicename").val() + " " + $("#DoctorPrintName").val() + " " + ' <input value="' + $("#ServiceID").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#servicename").val() + " " + $("#DoctorPrintName").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + $("#Unit").val() + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="number" value=' + $("#rate").val() + '></td><td><input id="txt_tbl_qty" class="form-control" type="number" value=' + parseInt($("#quantity").val()) + '></td> <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value="0" class="nr form-control" type="number" id="Discount_Service" name="Discount_Service" /></td><td class= "total  ' + billNo + '">' + $("#quantity").val() * $("#rate").val() + '</td><td style="display:none"><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/><td style=" display: flex;"><input type="text" name="doctorID" id="doctorID"  placeholder="Doctor ID.."><select class="fstdropdown-select DoctorPrintNamedgv form-control" ></select></td></td><td><button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" class="finalbill" name="ServiceType" /><input type="hidden" name="UnitID1" value="' + UnitID + '"><input type="hidden" id="tblIPDBill" name="tblIPDBill" value=' + billNo + '><input type="hidden" id="Authorization" name="Authorization" value="1"> </td></td>');
                                        BindDr();
                                    }
                                }
                                else {
                                    alert("Select Bill Number..")
                                    return false;
                                }
                                //  alert($('input[name=chkIPDBill]:checked').val());

                            }
                            else {
                                if (servicename != 0) {
                                    if (ServiceType == "IPDPackageBills")
                                    {
                                        GetAllPackageServiceWise(ServiceType);

                                    }
                                    else
                                    {
                                        $('#datatable-responsive tbody').append('<tr><td>' + $("#servicename").val() + " " + $("#DoctorPrintName").val() + " " + ' <input value="' + $("#ServiceID").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#servicename").val() + " " + $("#DoctorPrintName").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + UnitID + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td><input id="txt_tbl_rate" placeholder="0" class="form-control" type="number" value=' + $("#rate").val() + '></td><td><input id="txt_tbl_qty" class="form-control" type="number" placeholder="0" value=' + parseInt($("#quantity").val()) + '></td> <td><select name="DiscountServiceType" id="DiscountServiceType" class="nr form-control"><option value="Rs">Rs</option><option value="%">%</option></select></td> <td><input value="0" placeholder="0" class="nr form-control" type="number" id="Discount_Service" name="Discount_Service" /></td><td class="total">' + $("#quantity").val() * $("#rate").val() + '</td><td style="display:none"><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><input value="' + 0 + '" type="hidden" id="sevicedisAmt" name="sevicedisAmt"/></td><td  style=" display: flex;"><input type="text" name="doctorID" id="doctorID"  placeholder="Doctor ID.."><select class="fstdropdown-select DoctorPrintNamedgv form-control" ></select></td><td><button type="button" id="tbldel" class="btndivcss" onclick="RemoveSvcTable(this)"><span class="fa fa-trash buttoniconcss"></span>Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" class="finalbill" name="ServiceType" /><input type="hidden" name="UnitID1" value="' + UnitID + '"> <input type="hidden"  id="Authorization" name="Authorization" value="1"></td></td></tr>');
                                        
                                    }
                                    BindDr();
                                    TableDefaltZerovalue();
                                    
                                }
                            }
                        }
                        var m = 0;
                        //$(".finalbill").each(function () {
                        //    debugger
                        //    var selValue2 = $('input[name=RadioChargee]:checked').val();

                        //        if (selValue2 == "3") {

                        //            var rate = $(this).parent().find('#txt_tbl_rate').val();
                        //            var qty = $(this).parent().find('#txt_tbl_qty').val();
                        //            var svcrate = $(this).parent().find('#svc_rate_hid').val();
                        //            var svcqty = $(this).parent().find('#svc_qty_hid').val();
                        //            var total_hid = $(this).parent().find('#tot_hid').val();
                        //            var svcid = $(this).parent().find('#svc_hid').val();
                        //            var docid = $(this).parent().find('#doc_hid').val();
                        //            var tot2 = parseFloat(rate) * parseFloat(qty);
                        //        }

                        //});


                        // $('#datatable-responsive tbody').append('<tr><td>' + $("#service_name").val() + ' ' + $("#cons_dr").val() + '<input value="' + $("#service_name_hid").val() + '" type="hidden" id="svc_hid" name="svc_hid" /><input value="' + $("#service_name").val() + '" type="hidden" id="svc_nm_hid" name="svc_nm_hid" /> <input type="hidden" value="' + cons_dr_hidden + '" id="doc_hid" name="doc_hid" /><input type="hidden" value="' + $("#unit_hid").val() + '" id="unithid" name="unithid" /><input type="hidden" name="svc_rate_hid" id="svc_rate_hid" value="' + $("#rate").val() + '"/><input type="hidden" name="svc_qty_hid" id="svc_qty_hid" value="' + $("#quantity").val() + '"/></td><td><input id="txt_tbl_rate" class="form-control" type="text" value=' + $("#rate").val() + '></td><td><input id="txt_tbl_qty" class="form-control" type="text" value=' + parseInt($("#quantity").val()) + '></td><input value="' + $("#quantity").val() * $("#rate").val() + '" type="hidden" id="tot_hid" name="tot_hid"/><td class="total">' + $("#quantity").val() * $("#rate").val() + '</td><td><button type="button" id="tbldel" class="btn btn-default" onclick="RemoveSvcTable(this)">Delete</button><input type="hidden" value="Add" name="Mode"/><td><input value="' + ServiceType + '" type="hidden" id="ServiceType" name="ServiceType" /></td></td></tr>');
                        $("#ServiceID").val("0");
                        $("#servicename1").val("");
                        $("#servicename").val("");
                        $("#ServiceGroupID").val("0");
                        $("#ServiceGroupName").val("");
                        $("#rate").val("");
                        $("#DoctorPrintNameID").val("0");
                        $("#DoctorPrintName").val("");
                        $("#quantity").val("1");
                        $("#ServiceCode").val("");
                        $("#Unit").val("");
                        $("#UnitID").val("");
                    }

                    var sum = 0;
                    // iterate through each td based on class and add the values
                    $(".total").each(function () {

                        var value = $(this).text();
                        // add only if the value is number
                        if (!isNaN(value) && value.length != 0) {
                            sum += parseFloat(value);
                        }
                    });

                    $("#gross_total").val(sum);
                    $("#gross_total_id").val(sum);
                    var prebal = $("#pre_balance").val();
                    debugger
                    var name = $("#priPalanceDeposit").text();
                    if ($("#priPalanceDeposit").text() == "Pre.Balance") {
                        var tot = parseInt(sum) + parseInt(prebal);
                    }
                    else {
                        var tot = parseInt(sum) - parseInt(prebal);
                    }

                    $("#total_amount").val(tot);
                    $("#total_amount_id").val(tot);

                    if ($('#disc_amount').val() == '') {
                        var net = parseInt(tot) - parseInt(0);
                        $("#netpayable").val(tot);
                        $("#netpayable_id").val(net);
                    }
                    else {
                        var disc = $('#disc_amount').val();
                        var tot = $("#total_amount").val();

                        var net = parseInt(tot) - parseInt(disc);
                        $("#netpayable").val(net);
                        $("#netpayable_id").val(net);
                    }
                    var disc = $('#netpayable').val();
                    var amtpaid = $("#amtpaid").val();

                    var bal = parseInt(disc) - parseInt(amtpaid);
                    $("#bal_amount").val(bal);
                    $("#bal_amount_id").val(bal);
                    $("#amtpaid_id").val(amtpaid);
                  
                    if ($('#datatable-responsive tbody').length > 0) {
                        CaculateDescount();
                    }
                    if ($("#old_bill_no_id").val() == -2) {
                        var UserData = { BillNo: $("input[name='chkIPDBill']:checked").val(), gross_total: $("#gross_total_id").val(), pre_balance_id: $("#pre_balance_id").val(), NonMedicalExp: $("#NonMedicalExp").val(), total_amount: $("#total_amount").val(), disc_perc_id: $("#disc_perc_id").val(), disc_amount_id: $("#disc_amount_id").val(), netpayable_id: $("#netpayable_id").val(), amtpaid_id: $("#amtpaid_id").val(), bal_amount_id: $("#bal_amount_id").val() }
                        //  alert(JSON.stringify(UserData));
                        $.ajax({
                            url: '@Url.Action("GetPatientBillsForIPDNo", "IPDBill")',
                            type: 'POST',
                            data: JSON.stringify(UserData),
                            traditional: true,
                            contentType: 'application/json',
                            success: function (data) {


                            }
                        })
                    }
                }
            }
        });


        function BindDr() {
            debugger


            var var1 = { name:"%" }
            $.ajax({
                url: '@Url.Action("GetDoctorName", "IPDBill")',
                dataType: "json",
                type: "POST",
                data: JSON.stringify(var1),
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    $(".DoctorPrintNamedgv").append('<option value=' +0+ '></option>');

                    $(data).each(function (index, i) {

                        $(".DoctorPrintNamedgv").append('<option value=' + i.DoctorID + '>' + i.DoctorName + '</option>');

                    })
                }
            })


        }

        $("#datatable-responsive").on('change', '.DoctorPrintNamedgv', function () {
            // $("#DoctorPrintName").val()
            debugger
            var row_num = $(this).closest('tr').index(); //parseInt($(this).parent().index());
            //var GrpID = document.getElementById(this).rows[row_num].cells[0].innerHTML;
            // tbldr
            if (document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[7].children[1].value >= 0)
              {
                document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[7].children[0].value = document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[7].children[1].value;
               }
            var DoctorID_Name = document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[7].children[1].value;// = "govind";
            //document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[0].children[1].text = DoctorID_Name[1];
            document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[0].children[2].value = DoctorID_Name;
            document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[7].children[0].value = DoctorID_Name;


        })
        $("#datatable-responsive").on('change', '#doctorID', function () {
            // $("#DoctorPrintName").val()
            debugger
            var row_num = $(this).closest('tr').index(); //parseInt($(this).parent().index());
            //var GrpID = document.getElementById(this).rows[row_num].cells[0].innerHTML;
            // tbldr
            if (document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[7].children[0].value >= 0) {
                document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[7].children[1].value = document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[7].children[0].value;
            }
            var DoctorID_Name = document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[7].children[1].value;// = "govind";
            //document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[0].children[1].text = DoctorID_Name[1];
            document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[0].children[2].value = DoctorID_Name;
            document.getElementById('datatable-responsive').tBodies[0].rows[row_num].cells[7].children[0].value = DoctorID_Name;


        })
        $("input[name=radioReports]").change(function () {
            debugger
            if ($(this).val().trim() == "Split") {

                var chksplit = $(this).is(":checked");
                // var row_num = $("#OldbillView tbody tr").length();

                var row_num = $("#OldbillView td").closest("tr").length - 1;
                var BillNo = document.getElementById("OldbillView").tBodies[0].rows[row_num].cells[4].innerHTML;
                if ($('input[name=RadioChargee]:checked').val() == 3 || $('input[name=RadioChargee]:checked').val() == 2) {
                    if (BillNo <= 0) {
                        alert("Select Bill No");
                        return false;
                    }

                    if (chksplit == true) {
                        $.ajax({
                            url: '@Url.Action("BindGroupOfReport", "IPDBill")',
                            dataType: "json",
                            type: "GET",
                            data: { chk: $('input[name=RadioChargee]:checked').val(), Reg: $("#patient_reg_no_id").val(), patientPrintIPDNo: $("#patientPrintIPDNo").val(), BillNo: BillNo, srviceGroupID: "" },
                            traditional: true,
                            contentType: 'application/json',
                            success: function (data) {
                                $('#dgvsplit tbody tr').remove();
                                $(data).each(function (index, i) {
                                    $('#dgvsplit tbody').append('<tr><td><input class="chksplit1" type="checkbox" value=' + i.ServiceGroupID + ' > </td><td>' + i.SvcName + '</td><td>' + i.sevicedisAmt + '</td></td></tr>');
                                })
                            }
                        })
                        $("#splitModal").show();

                    }
                    else {
                        $("#splitModal").hide();
                    }
                }
                else {
                    alert("Select Provisnal Bill And Final Bill");
                    $(this).prop("checked", false);
                    return false;
                }
            }
            else
    {
                $("#splitModal").hide();
}
        })
        $("#btnsplit").click(function () {
            debugger
            var srviceGroupID = "";

            $(".chksplit1").each(function () {
                debugger
                var chksplit = $(this).is(":checked");
                if (chksplit == true) {
                    srviceGroupID+= $(this).val()+",";
                }
            })

            var BillNo = document.getElementById("OldbillView").tBodies[0].rows[0].cells[4].innerHTML;
            $.ajax({
                url: '@Url.Action("btnGroupReport_Click", "IPDBill")',
                dataType: "json",
                type: "GET",
                data: { chk: $('input[name=RadioChargee]:checked').val(), PatientRegNO: $("#patient_reg_no_id").val(), PatientIPDOPDNO: $("#patientPrintIPDNo").val(), ServiceGroupID: srviceGroupID, BillNo: BillNo },
                traditional: true,
                contentType: 'application/json',
                success: function (data) {
                    $("#chksplit").attr('checked', false);
                 window.open('@Url.Action("RptSplit", "IPDBill")');
                }
            })
        })
        $("#btnclose1").click(function () {
            $("#splitModal").hide();
            $('input[name=chksplit]').prop('checked', false);
        })
    });
    $(document).ready(function () {
        $('input[name=chkServicesAdd]').click(function () {

            if ($(this).val() == "serviesselect")
            {
                $("#serviessearch").hide();
                $("#selectServes").show();
            }
            if ($(this).val() == "serviesSearch") {
                $("#serviessearch").show();
                $("#selectServes").hide();
            }
        })

        $("#patient_name").click(function () {

            $('#patientNameTable').slideDown();
           
           
        })

        $.ajax({
            url: '@Url.Action("GetIPDPatient", "IPDBill")',
            contentType: "application/json; charset=utf-8",
            type: "GET",
            dataType: "json",
            data: { prefix: "%", outside: false },
            success: function (result) {
                debugger
                $.each(result, function (i, obj) {
                    $("#patientNameTable").append('<tr><td>' + obj.PrintRegNO + '</td><td style="display:none">' + obj.patientregNo + '</td><td>' + obj.patientname + '</td><td>' + obj.address + '</td><td>' + obj.contactno + '</td></tr>')

                });
                debugger
            }
        });

        $("#patientNameTable").delegate('td', 'click', function () {
            debugger;

            var row = $(this).parent().index();
            var Print = document.getElementById('patientNameTable').tBodies[0].rows[row].cells[0].innerHTML;
            $("#patient_reg_no_idprint").val(Print);
            $("#patientPrintIPDNo").val('');
            $("#patient_ipd_no_id").val('');
            $("#patient_reg_no_idprint").change();
            $('#patientNameTable').slideUp();

        });

        $("#patient_name").on("keyup", function () {
            debugger
            var value = $(this).val().toLowerCase();
            $("#patientNameTable tbody tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    })
</script>
<!-- ico font -->
@*</head>*@

<body class="hold-transition skin-blue sidebar-mini">

    <div id="splitModal" style="display:none" class="" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content" style="width:fit-content">
                <div class="modal-header">
                    <h4 class="modal-title">Service Groups</h4>
                    <button type="button" id="btnclose1" class="close">X</button>
                </div>
                <div class="modal-body">
                    <div class="col-lg-12 padding0">
                        <div class="col-lg-12 row rowmarginbottom padding0">
                        </div>
                    </div>
                    <div class="col-md-12 padding0 rowmargintop">
                        <div class="table-responsive">
                            <table id="dgvsplit" class="table table-bordered hover display table-hover" role="grid" style="width: 100%;font-size: 15px;">
                                <thead style="background-color: #bddff7;">
                                    <tr>
                                        <th>Chk </th>
                                        <th>Service Group Name </th>
                                        <th>Total Amt</th>
                                    </tr>
                                </thead>
                                <tbody class="scrollbar"></tbody>
                            </table>
                            <input type="button" value="OK" id="btnsplit" class="btn-success" />
                        </div>
                        <div class="float-left"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="wrapper">
        <div class="content-wrapper">
            <form id="form" action="" method="post">
                <section class="content-header">
                    <div class="container-fluid">
                        <div class="row mb-2">
                            <div class="col-sm-6">
                                <h1>IPD Billing</h1>
                            </div>
                            <div class="col-sm-6">
                                <ol class="breadcrumb float-sm-right">
                                    <li class="breadcrumb-item"><a href="@Url.Action("Dashboard","Home")">Home</a></li>
                                    <li class="breadcrumb-item"><a href="@Url.Action("Patient", "Application")">Patient</a></li>
                                    <li class="breadcrumb-item active">IPD Billing</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="content">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                <div class="card card-primary panel-primary">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 padding0 panelheading">
                                        <div class="col-lg-4 col-md-12 col-sm-12 col-xs-12">
                                            <h2 class="panelheading">IPD Billing</h2>
                                        </div>
                                        <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12" style="text-align: end;">
                                            <h2 class="panelheading">Balance Amount</h2>
                                        </div>
                                        <div class="col-lg-2 col-md-12 col-sm-12 col-xs-12">
                                            <button type="button" class="btndivcss pull-right" data-toggle="modal" data-target="#myModal1" id="btnPriBalance1" style="font-size: 15px;">
                                                <span class="fa fa-rupee"></span> Total Amount
                                            </button>
                                            <!-- Balance Amount Modal -->
                                            <div id="myModal1" class="modal fade" role="dialog">
                                                <div class="modal-dialog modal-lg">
                                                    <!-- Modal content-->
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Bills Details</h4>
                                                            <button type="button" class="close" id="close1" data-dismiss="modal">&times;</button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                                    <h5><strong>UHID No.:<span id="nameUHID"></span></strong></h5>
                                                                </div>
                                                                <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
                                                                    <h5><strong>Patient Name:-</strong></h5>
                                                                </div>
                                                                <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
                                                                    <h5 id="namepatient"></h5>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                                <div class="table-responsive">
                                                                    <table id="OldBalanceView" class="table table-bordered hover display table-hover" role="grid" style="width: 100%;font-size: 15px;">
                                                                        <thead style="background-color: #bddff7;">
                                                                            <tr>
                                                                                <th>OPD/IPD NO-Bill Type </th>
                                                                                <th>Bill Type </th>
                                                                                <th>Admission Date</th>
                                                                                <th>Balance Amount</th>
                                                                                <th>Action</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody class="scrollbar"></tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body pane-body">
                                        <div class="row">
                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                <!--Bill Type-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>Bill Type</label>
                                                    </div>
                                                    <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label">
                                                                @*<input type="radio" class="iradio_flat-green" value="IPD Bills" id="" name="RadioChargee" checked="checked"><div class="rad">IPD Bills &nbsp;</div>*@
                                                                <input type="radio" class="form-check-input" value="1" id="1" name="RadioChargee" checked="checked">IPD Bills
                                                                @*@Html.RadioButton("RadioChargee", 1, true, htmlAttributes: new { @class = "iradio_flat-green" })<div class="rad">IPD Bills &nbsp;</div>*@
                                                            </label>
                                                        </div>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label">
                                                                @*<input type="radio" class="iradio_flat-green" value="Provisional" id="" name="RadioChargee"> <div class="rad">Provisional &nbsp;</div>*@
                                                                <input type="radio" class="form-check-input" value="2" id="2" name="RadioChargee">Provisional
                                                                @*@Html.RadioButton("RadioChargee", 2, false, htmlAttributes: new { @class = "iradio_flat-green" })<div class="rad">Provisional &nbsp;</div>*@
                                                            </label>
                                                        </div>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label">
                                                                @*<input type="radio" class="iradio_flat-green" value="Final" id="" name="RadioChargee"> <div class="rad">Final &nbsp;</div>*@
                                                                <input type="radio" class="form-check-input" id="3" value="3" name="RadioChargee" />Final
                                                                @*@Html.RadioButton("RadioChargee", 3, false, htmlAttributes: new { @class = "iradio_flat-green" })<div class="rad">Final &nbsp;</div>*@
                                                            </label>
                                                        </div>
                                                        <input type="hidden" name="radio_chargee_hid" id="radio_chargee_id_hid" value="1" />
                                                    </div>
                                                </div>
                                                <!--Old Bill Number-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>Old Bill No.</label>
                                                    </div>
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 cpb-10">
                                                        <select class="form-control" name="old_bill_no" id="old_bill_no_id">
                                                            <option value="-1">SELECT OLD BILLS</option>
                                                            <option value="-2">Edit All Bill</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <button type="button" data-toggle="modal" data-target="#myModal" class="btndivcss pull-right" id="btnoldbill" style="height: 25px; width: 100%;">
                                                            <span class="fa fa-tasks buttoniconcss"></span> Old Bill Receipt
                                                        </button>
                                                        <!-- Old Bill Receipt Modal -->
                                                        <div id="myModal" class="modal fade" role="dialog">
                                                            <div class="modal-dialog">
                                                                <!-- Modal content-->
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h4 class="modal-title">Bills Details</h4>
                                                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                                            <div class="table-responsive">
                                                                                <table id="OldbillView" class="table table-bordered hover display table-hover" role="grid" style="width: 100%">
                                                                                    <thead style="background-color: #bddff7;">
                                                                                        <tr>
                                                                                            <th>Reg No</th>
                                                                                            <th>Bill Type</th>
                                                                                            <th>Bill No. & Date</th>
                                                                                            <th>Action</th>
                                                                                        </tr>
                                                                                    </thead>
                                                                                    <tbody class="scrollbar"></tbody>
                                                                                </table>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12" style="display: none;">
                                                    <div class="form-check-inline">
                                                        <label class="form-check-label">
                                                            <input type="checkbox" class="form-check-input" value="">NOC. Form
                                                        </label>
                                                    </div>
                                                    <div class="form-check-inline">
                                                        <label class="form-check-label">
                                                            <input type="checkbox" class="form-check-input" value="">Send SMS
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                <!--UHID Number-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>UHID No.</label>
                                                    </div>
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 cpb-10">
                                                        <input type="text" readonly id="fin_year_id" name="fin_year" class="form-control" />
                                                        <input type="hidden" id="fin_year_hid" name="fin_year_id_hid" class="form-control">
                                                    </div>
                                                    <div class="hidden col-lg-2 col-md-4 col-sm-12 col-xs-12">
                                                        <input type="number"  placeholder="Enter Reg" id="patient_reg_no_id" name="patient_reg_no_txt" class="form-control">
                                                    </div>
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <input type="number" placeholder="Enter RegPrint" id="patient_reg_no_idprint" name="patient_reg_no_idprint" class="form-control">
                                                    </div>
                                                </div>
                                                <!--IPD Number-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>IPD No.</label>
                                                    </div>
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 cpb-10">
                                                        <input type="number" id="patientPrintIPDNo" placeholder="Search IPD No" name="patientPrintIPDNo" class="form-control">
                                                    </div>
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <input type="hidden" id="patientBillNo" placeholder="BillNo." name="patientBillNo" class="form-control">
                                                        <input type="number" id="patientPrintBillNo" placeholder="BillNo." name="patientPrintBillNo" class="form-control">
                                                        <input type="hidden" name="patient_ipd_no_id" id="patient_ipd_no_id" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                <!--Admit Date-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div   class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>Admit D/T</label>
                                                    </div>
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 cpb-10">
                                                        <input type="date" value="@DateTime.Now.ToString("yyyy-MM-dd")" max="9999-12-31" id="AdmitDate" name="AdmitDate" class="form-control">
                                                        
                                                    </div>
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <input type="time" value="now" name="AdmitTime" id="AdmitTime" class="form-control">
                                                    </div>
                                                </div>
                                                <!--Bill Date-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>Bill D/T</label>
                                                    </div>
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 cpb-10">
                                                        <input type="date" required="" value="@DateTime.Now.ToString("yyyy-MM-dd")" max="9999-12-31" min="@DateTime.Now.ToString("yyyy-MM-dd")" id="bill_date" name="bill_date" class="form-control">
                                                    </div>
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <input type="time" value='now' name="bill_time" id="bill_time" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                <!--Patient Name-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>Patient Name</label>
                                                    </div>
                                                    <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                                                        <input type="text" id="patient_name" name="patient_name" class="form-control typeahead" required
                                                               style="border-left-color: red;border-left-width: thick;"
                                                               oninvalid="this.setCustomValidity('Please Enter Patient Name')"
                                                               oninput="this.setCustomValidity('')">
                                                        <div class="patientTableDiv table-responsive" style="position: absolute;z-index: 100;max-height: 250px;overflow: scroll;background-color: #ffffff;border: 0;box-shadow: 10px 10px 10px -6px #797979;">
                                                            <table id="patientNameTable" class="table table-bordered display table-hover table-head-fixed" style="width: 100%; display:none;">
                                                                <thead>
                                                                    <tr>
                                                                        <th style="background-color: #bddff7;">UHID No.</th>
                                                                        <th style="display:none">Print Reg No.</th>
                                                                        <th style="background-color: #bddff7;">Pt.Name</th>
                                                                        <th style="background-color: #bddff7;">Address</th>
                                                                        <th style="background-color: #bddff7;">Mobile No.</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody></tbody>
                                                            </table>
                                                        </div>
                                                            @*<table class="table table-condensed table-striped suggest-grid  table table-bordered table-striped">
                                                         <thead>
                                                             <tr><th>Patient Name</th>
                                                                 <th>Reg No</th></tr>
                                                         </thead>
                                                               <tbody id="tblpatient1">
                                                            </tbody>
                                                        </table>*@
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--Guardian Name-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>Guardian Name</label>
                                                    </div>
                                                    <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                                                        <input type="text" id="GuardianName" name="GuardianName" class="form-control" readonly>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                <!--Consultant Doctor-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>Cons. Doctor</label>
                                                    </div>
                                                    <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                                                        <input type="hidden" id="Doctor" value="0" name="Doctor" class="form-control">
                                                        <input type="text" id="DoctorID" readonly name="DoctorID" class="form-control">
                                                    </div>
                                                </div>
                                                <!--Department-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>Department</label>
                                                    </div>
                                                    <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                                                        <input type="hidden" id="DepartmentID"  name="DepartmentID" class="form-control">
                                                        <input type="text" id="DepartmentName" readonly name="DepartmentName" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                <!--Reffered By-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>Reffered By</label>
                                                    </div>
                                                    <div class="col-lg-4 col-md-8 col-sm-12 col-xs-12">
                                                        <input type="text" id="RDoctorPrintName" readonly name="RDoctorPrintName" class="form-control ui-autocomplete-input" autocomplete="off">
                                                        <input type="hidden" id="ReferredByDoctorID" name="ReferredByDoctorID" class="form-control">
                                                    </div>
                                                    <div class="col-lg-1 col-md-4 col-sm-12 col-xs-12 padding0" style="text-align: end;">
                                                        <label>Ward</label>
                                                    </div>
                                                    <div class="col-lg-3 col-md-8 col-sm-12 col-xs-12">
                                                        <input type="text" id="WordName" readonly name="WordName" class="form-control">
                                                        <input type="hidden" id="ward_name_hid" name="ward_name_hid" class="form-control">
                                                    </div>
                                                </div>
                                                <!--Room and Beb Number-->
                                                <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                        <label>Room No.</label>
                                                    </div>
                                                    <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                                                        <input type="text" name="RoomNo" readonly id="RoomNo" class="form-control">
                                                        <input type="hidden" name="room_no_hid" id="room_no_hid" class="form-control">
                                                    </div>
                                                    <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12" style="text-align: right;">
                                                        <label>Bed No.</label>
                                                    </div>
                                                    <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                                                        <input type="text" id="BedNo" readonly name="BedNo" class="form-control">
                                                        <input type="hidden" name="bed_no_hid" id="bed_no_hid" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
                                <div class="card card-primary panel-primary">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 padding0 panelheading">
                                        <div class="col-lg-4 col-md-12 col-sm-12 col-xs-12">
                                            <div class="form-check-inline">
                                                <label class="form-check-label lableFont">
                                                    <input type="radio" class="form-check-input" value="General" id="General" name="RadioCharge" checked="checked">General
                                                </label>
                                            </div>
                                            <div class="form-check-inline">
                                                <label class="form-check-label lableFont">
                                                    <input type="radio" class="form-check-input" value="Emergency" id="Emergency" name="RadioCharge">Emergency
                                                </label>
                                            </div>
                                            <div class="form-check-inline">
                                                <label class="form-check-label lableFont">
                                                    <input type="radio" class="form-check-input" disabled id="TPA" value="TPA" name="RadioCharge" />TPA
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-lg-5 col-md-12 col-sm-12 col-xs-12">
                                            <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                <label class="lableFont">TPA Name</label>
                                            </div>
                                            <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12 cpb-10">
                                                <input type="text" readonly name="TPAName" id="TPAName" class="form-control">
                                                <input type="hidden" name="TPAID" id="TPAID" class="form-control">
                                            </div>
                                        </div>
                                        <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
                                            <div class="form-check-inline ">
                                                <label class="form-check-label lableFont">
                                                    <input type="checkbox" id="chkPrivilege" disabled value="" class="form-check-input">Privilege Card
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body accent-blue" style="overflow: scroll; white-space: nowrap;">
                                        <div class="form-check-inline">
                                            <label class="form-check-label">
                                                <input type="radio" class="form-check-input" id="1" value="1" name="radioReports" checked="checked" />Summerized
                                            </label>
                                        </div>
                                        <div class="form-check-inline">
                                            <label class="form-check-label">
                                                <input type="radio" class="form-check-input" id="2" value="2" name="radioReports" />Consolidated
                                            </label>
                                        </div>
                                        <div class="form-check-inline">
                                            <label class="form-check-label">
                                                <input type="radio" class="form-check-input" id="3" value="3" name="radioReports" />Detailed
                                            </label>
                                        </div>
                                        <div class="form-check-inline">
                                            <label class="form-check-label">
                                                <input type="radio" class="form-check-input" id="4" value="4" name="radioReports" />Detailed + Final Diagnosis
                                            </label>
                                        </div>
                                        <div class="form-check-inline">
                                            <label class="form-check-label">
                                                <input type="radio" class="form-check-input" id="5" value="5" name="radioReports" />Bill + Phamacy
                                            </label>
                                        </div>
                                        <div class="form-check-inline">
                                            <label class="form-check-label">
                                                <input type="radio" class="form-check-input" id="6" name="radioReports" value="6" />Bill + Phamacy Details
                                            </label>
                                        </div>
                                        <input type="hidden" name="radioReports_hid" id="radioReports_id_hid" value="1" />
                                    </div>
                                </div>
                                <div class="card card-primary">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="background: #bddff7;">
                                        <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12 padding0">
                                            <h2 class="panelheading">Service Info</h2>
                                        </div>
                                        <div class="hidden col-lg-3 col-md-4 col-sm-12 col-xs-12" style="padding-top: 5px;">
                                            <div class="form-check-inline">
                                                <span class="form-check-label">
                                                    <input type="radio" class="form-check-input" value="serviesselect" id="chkserviessearch" name="ServiceInfoChk" checked="checked">Service
                                                </span>
                                            </div>
                                            <div class="form-check-inline">
                                                <span class="form-check-label">
                                                    <input type="radio" class="form-check-input" value="Package" name="ServiceInfoChk" checked/>Package
                                                </span>
                                            </div>
                                            <div class="form-check-inline" style="display: none;">


                                                <span class="form-check-label">
                                                    <input type="radio" class="form-check-input" value="serviesSearch" id="chkservieselect" name="chkServicesAdd" />Search Service
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-4 col-sm-12 col-xs-12" style="padding-top: 5px; ">
                                            <div class="form-check-inline">
                                                <span class="form-check-label">
                                                    <input type="radio" class="form-check-input" checked value="Service" id="rdService" name="ServiceInfoChk" />Service
                                                </span>
                                            </div>
                                            <div class="form-check-inline">
                                                <span class="form-check-label">
                                                    <input type="radio" class="form-check-input" value="Test" id="rdTest" disabled name="ServiceInfoChk">Test
                                                </span>
                                            </div>
                                            <div class="form-check-inline">
                                                <span class="form-check-label">
                                                    <input type="radio" class="form-check-input" value="Package" name="ServiceInfoChk" />Package
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body pane-body" style="padding-left: 0px !important; padding-right: 0px !important;">
                                        <div class="row">
                                            <div style="display:none" id="serviessearch">
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 padding0">
                                                    <!--Service Group-->
                                                    <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12" id="serviceGorup">
                                                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                            <label>Service Group</label>
                                                        </div>
                                                        <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12 ">
                                                            <input type="hidden" value="" id="ServiceGroupID" name="ServiceGroupID">
                                                            <input type="text" value="" id="ServiceGroupName" name="ServiceGroupName" class="form-control" placeholder="Service Group Name">
                                                        </div>
                                                    </div>
                                                    <!--Service-->
                                                    <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                            <label>Service</label>
                                                        </div>
                                                        <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12 ">
                                                            <input type="hidden" value="" id="ServiceID" name="ServiceID">
                                                            <input type="hidden" id="servicename1" name="servicename1">
                                                            <input type="text" value="" id="servicename" name="servicename" class="form-control" placeholder="Service Name">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 padding0">
                                                    <!--HSN Code-->
                                                    <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                            <label>HSN Code</label>
                                                        </div>
                                                        <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                                                            <input type="text" value="" id="ServiceCode" name="ServiceCode" class="form-control" placeholder="HSN Code">
                                                        </div>
                                                    </div>
                                                    <!--Units-->
                                                    <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                            <label>Unit</label>
                                                        </div>
                                                        <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12 ">
                                                            <input type="hidden" id="UnitID" name="UnitID">
                                                            <input readonly="readonly" type="text" value="" id="Unit" name="Unit" class="form-control" placeholder="Unit">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 padding0">
                                                    <!--Rate and Quantity-->
                                                    <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                            <label>Rate</label>
                                                        </div>
                                                        <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12 ">
                                                            <input type="number" value="00" id="rate" name="rate" class="form-control" placeholder="Rate">
                                                        </div>
                                                        <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
                                                            <label>Qty.</label>
                                                        </div>
                                                        <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
                                                            <input type="number" value="1" id="quantity" name="quantity" class="form-control" placeholder="Qty">
                                                        </div>
                                                    </div>
                                                    <!--Consultant Doctor-->
                                                    <div class="form-group col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                                            <label>Consultant Dr.</label>
                                                        </div>
                                                        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                            <input type="hidden" id="DoctorPrintNameID" name="DoctorPrintNameID">
                                                            <input type="text" value="" id="DoctorPrintName" name="DoctorPrintName" class="form-control" placeholder="Consultant Doctor">
                                                        </div>
                                                        <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
                                                            <button type="button" id="svc_add_btn" title="add" class="btndivcss" style="height: 25px;">Add</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="selectServes">
                                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="table-bordered" id="divgp">
                                                        <div class="card-body">
                                                            <input type="text" class="form-control" id="txtdgvGroup" placeholder="Search Service Group..." style="margin-bottom: 10px;">
                                                            <div class="table-responsive" style="max-height: 350px; overflow-y: scroll;">
                                                                <table class="table table-bordered hover display table-hover table-head-fixed" role="grid" style="width: 100%; font-size: 12px;">
                                                                    <thead>
                                                                        <tr>
                                                                            <th style="background-color: #bddff7;"><span class="fa fa-check"></th>
                                                                            <th style="background-color: #bddff7;">Service Group</th>
                                                                            <th style="background-color: #bddff7;">HSN Code</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody id="dgvGroup" class="scrollbar"></tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                                    <div class="table-bordered" id="divsr">
                                                        <div class="card-body">
                                                            <input type="text" class="form-control" id="txtdgvService" placeholder="Search Services..." style="margin-bottom: 10px;">
                                                            <div class="table-responsive" style="max-height: 350px; overflow-y: scroll;">
                                                                <table class="table table-bordered hover display table-hover table-head-fixed" role="grid" style="width: 100%; font-size: 12px;">
                                                                    <thead>
                                                                        <tr>
                                                                            <th style="background-color: #bddff7;"><span class="fa fa-check"></span></th>
                                                                            <th style="background-color: #bddff7;">Group</th>
                                                                            <th style="background-color: #bddff7;">Service Name</th>
                                                                            
                                                                            <th style="background-color: #bddff7;">HSN Code</th>
                                                                            <th style="background-color: #bddff7;">Rate</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody id="dgvService" class="scrollbar"></tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
                                <div class="card card-primary panel-primary">
                                    <h2 class="panelheading">Bill Details</h2>
                                    <div class="form-horizontal">
                                        <div class="card-body panel-body">
                                            <div class="row">
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Gross Total</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="" type="text" class="form-control" name="gross_total" id="gross_total" disabled placeholder="0.00">
                                                        <input type="hidden" name="gross_total_name" id="gross_total_id">
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Surcharge</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="0" type="number" class="form-control" name="surcharge" id="surcharge" placeholder="0.00">
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Tax Amt.</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="0" type="text" class="form-control" name="tax_amount" id="tax_amount" placeholder="0.00">
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label id="priPalanceDeposit">Pre. Balance</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="" type="text" class="form-control" name="pre_balance" id="pre_balance" disabled placeholder="0.00">
                                                        <input type="hidden" name="pre_balance_name" id="pre_balance_id">
                                                        <input type="hidden" name="Deposit" id="Deposit" value="0.00">
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Non Medical</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="" type="number" class="form-control" name="NonMedicalExp" id="NonMedicalExp" placeholder="0.00">
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Total Amt.</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="" type="text" class="form-control" name="total_amount" id="total_amount" disabled placeholder="0.00">
                                                        <input type="hidden" name="total_amount_name" id="total_amount_id">
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Discount%</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="0" type="text" class="form-control" name="discount" id="discount" placeholder="0.00">
                                                        <input type="hidden" name="disc_perc_name" id="disc_perc_id">
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Disc. Amt.</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="0" type="text" class="form-control" name="disc_amount" id="disc_amount" placeholder="0.00">
                                                        <input type="hidden" name="disc_amount_name" id="disc_amount_id">
                                                    </div>
                                                </div>
                                                <div class="col-lg-12  col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Disc.Reason</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="" type="text" class="form-control" name="disc_reason" id="disc_reason">
                                                        <input value="" type="hidden" class="form-control" name="DiscountReasonID" id="DiscountReasonID">
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Net Pay</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input type="hidden" name="netpayable_name" id="netpayable_id">
                                                        <input value="" type="number" class="form-control" name="netpayable" id="netpayable" disabled placeholder="0.00" readonly>
                                                    </div>
                                                </div>
                                                <div class="col-lg-12col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Amt. Paid</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input type="hidden" id="amtpaid_id" name="amtpaid_name">
                                                        <input value="" type="number" class="form-control" id="amtpaid" name="amtpaid" placeholder="0.00" required>
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Bal Amt.</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="" type="text" class="form-control" id="bal_amount" name="bal_amount" disabled placeholder="0.00">
                                                        <input type="hidden" id="bal_amount_id" name="bal_amount_name">
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Pay Type.</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <select class="form-control" name="payment_type" id="payment_type">
                                                            <option value="CASH">CASH</option>
                                                            <option value="Credit Card">Credit Card</option>
                                                            <option value="Debit Card">Dedit Card</option>
                                                            <option value="E-money">E-money</option>
                                                            <option value="EFT">EFT</option>
                                                        </select>
                                                    </div>
                                                    <div class="modal" id="DoctorSaveDivs">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <!-- Modal body -->
                                                                <div class="modal-body">
                                                                    <div class="form-group">
                                                                        <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                                                                            <label id="PaymentNo1">Cheque No</label>
                                                                        </div>
                                                                        <div class="col-lg-8 col-md-6 col-sm-12 col-xs-12">
                                                                            <input type="number" class="form-control" id="Number" name="Number">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                                                                            <span id="paymentName1">Bank Name</span>
                                                                        </div>
                                                                        <div class="col-lg-8 col-md-6 col-sm-12 col-xs-12">
                                                                            <input type="text" class="form-control" id="Name" name="Name">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                                                                            <span id="paymentDate1">Cheque Date</span>
                                                                        </div>
                                                                        <div class="col-lg-8 col-md-6 col-sm-12 col-xs-12">
                                                                            <input type="date" value="@DateTime.Now.ToString("yyyy-MM-dd")" max="9999-12-31" class="form-control" id="paymentDate" name="paymentDate">
                                                                            @* <input type="date"  value="@DateTime.Now.ToString("yyyy-MM-dd")" class="form-control" id="paymentDate" name="paymentDate">*@
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                                                                            <span id="paymentRemark1">Remark</span>
                                                                        </div>
                                                                        <div class="col-lg-8 col-md-6 col-sm-12 col-xs-12">
                                                                            <input type="text" class="form-control" id="Remarks" name="Remarks">
                                                                        </div>
                                                                    </div>
                                                                    <button type="button" id="cl" class="btn btn-danger pull-right" data-dismiss="modal" style="font-size: 15px;">
                                                                        Close
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-bottom: 12px;">
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <label>Sancation Amt.</label>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                                                        <input value="" type="number" class="form-control" id="sanction_amount" name="sanction_amount" placeholder="0.00">
                                                    </div>
                                                </div>
                                                @*<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                <button type="submit" id="btnSubmitid" class="btndivcss" style="width: 100%;">Next > IPD Discharge</button>
                                            </div>*@
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: center;">
                                <div class="btn-group dropdown-split-warning">
                                    <button type="submit" class="btn btn-app" id="save">
                                        <i class="fa fa-save"></i>Save
                                    </button>
                                </div>
                                <div class="btn-group dropdown-split-warning">
                                    <button type="submit" class="btn btn-app" id="btndelete">
                                        <i class="fa fa-trash"></i>Delete
                                    </button>
                                </div>
                                <div class="btn-group dropdown-split-warning">
                                    <a class="btn btn-app" onclick="location.reload();">
                                        <i class="fa fa-refresh"></i>Clear
                                    </a>
                                </div>
                                <div class="btn-group dropdown-split-warning">
                                    <a class="btn btn-app" onclick="window.location.href='@Url.Action("Patient", "Application")'">
                                        <i class="fa fa-sign-out"></i>Exit
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                <div class="card card-primary card-tabs">
                                    <div class="card-header p-0 pt-1">
                                        <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
                                            <li class="pt-2 px-3"></li>
                                            <li class="nav-item">
                                                <a class="nav-link active" id="addressDetail-tab" data-toggle="pill" href="#addressDetail" role="tab" aria-controls="addressDetail" aria-selected="true">
                                                    Patient IPD Bill
                                                </a>
                                            </li>
                                            <li class="nav-item" id="Sectionfinal" style="display:none">
                                                <a class="nav-link" id="patientIPDBillswithSummarry-tab" data-toggle="pill" href="#patientIPDBillswithSummarry" role="tab" aria-controls="patientIPDBillswithSummarry" aria-selected="true">
                                                    PatientIPD Bills with Summarry
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="card-body">
                                        <div class="tab-content" id="custom-tabs-two-tabContent">
                                            <!-- Patient IPD Bill -->
                                            <div class="tab-pane fade show active" id="patientIPDBill" role="tabpanel" aria-labelledby="patientIPDBill-tab">
                                                <div class="table-responsive" style="max-height: 350px; overflow-y: scroll;">
                                                    <table id="datatable-responsive" class="table table-bordered hover display table-hover" role="grid" style="width: 100%; font-size: 13px;">
                                                        <thead style="background-color: #bddff7;">
                                                            <tr>
                                                                <th style="width: 30%;">Service Name</th>
                                                                <th style="width: 10%;">Rate</th>
                                                                <th style="width: 5%;">Qty.</th>
                                                                <th style="width: 5%;">Disc.</th>
                                                                <th style="width: 6%;">Amount</th>
                                                                <th style="width: 10%;">Total Amount</th>
                                                                @*<th style="width: 5%;">Dr. Id</th>*@
                                                                <th id="drtable" style="width: 20%;"> Dr.Id & Name</th>
                                                                <th style="width: 5%;">Action</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="tblbill" class="scrollbar"></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <!-- PatientIPD Bills with Summarry -->
                                            <div class="tab-pane fade" id="patientIPDBillswithSummarry" role="tabpanel" aria-labelledby="patientIPDBillswithSummarry-tab">
                                                <div class="table-responsive" style="max-height: 350px; overflow-y: scroll;">
                                                    <table id="responsivefinalsummary" class="table table-bordered hover display dataTable table-hover" role="grid" style="width: 100%">
                                                        <thead style="background-color: #bddff7;">
                                                            <tr>
                                                                <th style="width: 30%;">Service Name</th>
                                                                <th style="width: 10%;">Rate</th>
                                                                <th style="width: 5%;">Qty.</th>
                                                                <th style="width: 5%;">Disc.</th>
                                                                <th style="width: 6%;">Amount</th>
                                                                <th style="width: 10%;">Total Amount</th>
                                                                <th style="width: 5%;">Dr. Id</th>
                                                                <th id="" style="width: 20%;">Consultant Doctor</th>
                                                                <th style="width: 5%;">Action</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="responsivefinalsummary1" class="scrollbar"></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <input type="hidden" value="" name="txtinput" id="txtinput" />
                <input type="hidden" value="0" name="ForAuthorization" id="ForAuthorization" />
            </form>
        </div>
    </div>
</body>


<script>
    var chk = false;
    //function myFunction() {
    //    debugger

    //    debugger
    //    if (chk == "True") {
    //        var con = confirm("Send For Authorization Confirmation");
    //        if (con) {
    //            var person = prompt("Reason For Authorization");
    //            if (person) {
    //                $("#txtinput").val(person);
    //                $("#ForAuthorization").val(1);
    //                return true;
    //            }
    //            else {
    //                $("#ForAuthorization").val(0);
    //                $("#txtinput").val('');
    //                return false;
    //            }
    //        }
    //        else {
    //            return false;
    //        }
    //    }
    //    else {
    //        return true;
    //    }

    //}

    $(document).ready(function () {
        @*$('#form').on('submit', function (e) {
            debugger

            var r = myFunction();
            if (r) {
                return true;
            }
            else {
                return false;
            }
        })

        $("#old_bill_no_id").change(function () {
            debugger
            if ($(this).val() > 0) {
                $.ajax({
                    //url: "/OPDBill/GetServiceGrp",
                    url: '@Url.Action("chkAurthorise", "OPDBill")',
                    type: "POST",
                    dataType: "json",
                    data: { prefix: "" },
                    success: function (data) {
                        debugger
                        // alert(data[0]);
                        chk = data[0];
                        if (data[1] == "True") {
                            chk = false;
                        }

                    }
                })
            }
            else {
                chk = false;
            }
        })*@
    })
</script>


